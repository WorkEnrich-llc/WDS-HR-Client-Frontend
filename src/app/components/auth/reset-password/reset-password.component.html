<!-- email step -->
@if (currentStep===1) {
<div>
  <div class="card-top">
    <div class="row align-items-center g-3">
      <div class="col-8">
        <h2>Forgot your Password?</h2>
        <p>Please enter your email. We’ll send you an email to reset your password.</p>
      </div>
      <div class="col-4">
        <img src="./images/logo_with_slog.png" alt="WDS logo">
      </div>
    </div>
  </div>
  <div class="card-bottom">
    <div class="verify">
      <div class="row align-items-center g-4">
        <form [formGroup]="emailForm" class="col-md-6">
          <div class="w-100 d-flex flex-column gap-2">
            <div class="input">
              <label for="email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <g fill="none" stroke-width="1.5">
                    <path
                      d="M2 12c0-3.771 0-5.657 1.172-6.828S6.229 4 10 4h4c3.771 0 5.657 0 6.828 1.172S22 8.229 22 12s0 5.657-1.172 6.828S17.771 20 14 20h-4c-3.771 0-5.657 0-6.828-1.172S2 15.771 2 12Z" />
                    <path stroke-linecap="round"
                      d="m6 8l2.159 1.8c1.837 1.53 2.755 2.295 3.841 2.295s2.005-.765 3.841-2.296L18 8" />
                  </g>
                </svg> Email</label>
              <div class="d-flex align-items-center gap-4">
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                  <input formControlName="email" type="email" id="email" class="form-control" placeholder="Input Here"
                    [ngClass]="{
    'error-input': emailForm.get('email')?.touched && emailForm.get('email')?.invalid,
    'success-input': emailForm.get('email')?.touched && emailForm.get('email')?.valid
  }">

                </div>
              </div>
              @if (emailForm.get('email')?.touched && emailForm.get('email')?.errors?.['required']) {
              <p class="error-msg">
                Email is required.
              </p>
              }
              @if (emailForm.get('email')?.touched && emailForm.get('email')?.errors?.['email']) {
              <p class="error-msg">
                Please enter a valid email address.
              </p>
              }
              @if (emailForm.get('email')?.touched && emailForm.get('email')?.errors?.['emailNotRegistered']) {
              <p class="error-msg">
                {{ emailMsg }}
              </p>
              }
              <!-- <p class="success-msg"
                      *ngIf="emailForm.get('email')?.touched && emailForm.get('email')?.valid && emailMsg === 'Email is registered'">
                      {{ emailMsg }}
                    </p> -->
            </div>
            @if (errMsg) {
            <div class="alert alert-danger" role="alert">
              {{errMsg}}
            </div>
            }
            <div class="d-flex align-items-stretch gap-2">
              <button class="btn btn-lg btn-primary w-100 my-3" [disabled]="emailForm.invalid || isLoading"
                (click)="sendOtp()">
                @if (isLoading) {
                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                }
                @if (!isLoading) {
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="1.5" d="M4 12h16m0 0l-6-6m6 6l-6 6" />
                </svg>
                }
                <span>Reset Password</span>
              </button>
            </div>
          </div>
        </form>
        <div class="d-none d-md-block col-md-6 text-center">
          <img src="./images/verify.svg" alt="WDS logo" class="img-fluid">
        </div>
      </div>
    </div>
  </div>
</div>
}

<!-- verify step -->
@if (currentStep===2) {
<div>
  <div class="card-top">
    <div class="row align-items-center g-3">
      <div class="col-8">
        <h2>Forgot your Password?</h2>
        <p>Please enter your email. We’ll send you an email to reset your password.</p>
      </div>
      <div class="col-4">
        <img src="./images/logo_with_slog.png" alt="WDS logo">
      </div>
    </div>
  </div>
  <div class="card-bottom">
    <div class="verify">
      <div class="row align-items-center g-4">
        <form [formGroup]="otpForm" class="col-md-6">
          <div class="w-100 d-flex flex-column gap-2">
            <p class="verify-text text-center">We’ve just sent you an email with a Code.
              Please enter it below to Verify your Email.</p>
            <ng-otp-input
              [config]="{length: 6, inputClass: 'otp-input form-control m-auto my-3 rounded-3', isPasswordInput: true}"
              (onInputChange)="onOtpChange($event)">
            </ng-otp-input>
            @if (otpForm.get('otp')?.touched && otpForm.get('otp')?.errors?.['required']) {
            <p class="error-msg">
              OTP is required.
            </p>
            }
            @if (otpForm.get('otp')?.touched && otpForm.get('otp')?.errors?.['minlength']) {
            <p class="error-msg">
              OTP must be 6 digits.
            </p>
            }
            @if (errMsg) {
            <div class="alert alert-danger" role="alert">
              {{errMsg}}
            </div>
            }
            <div class="d-flex align-items-stretch gap-2">
              <button class="btn btn-lg btn-primary w-100 my-3"
                [disabled]="isLoading || !emailForm.valid || !otpForm.valid" (click)="checkCode()">
                @if (isLoading) {
                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                }
                @if (!isLoading) {
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                    stroke-width="1.5" d="M4 12h16m0 0l-6-6m6 6l-6 6" />
                </svg>
                }
                <span>Reset Password</span>
              </button>
            </div>
          </div>
        </form>
        <div class="d-none d-md-block col-md-6 text-center">
          <img src="./images/verify.svg" alt="WDS logo" class="img-fluid">
        </div>
      </div>
    </div>
  </div>
</div>
}

<!-- reset password step  -->
@if (currentStep===3) {
<div>
  <div class="card-top">
    <div class="row align-items-center g-3">
      <div class="col-8">
        <h2>Reset Password</h2>
        <p>Enter a new password.</p>
      </div>
      <div class="col-4">
        <img src="./images/logo_with_slog.png" alt="WDS logo">
      </div>
    </div>
  </div>
  <div class="card-bottom">
    <div class="row align-items-center g-4">
      <div class="col-6">
        <form [formGroup]="passwordForm" class="w-100 d-flex flex-column gap-2">
          <div class="input">
            <label for="password"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <g fill="none">
                  <path stroke-width="1.5"
                    d="M2 16c0-2.828 0-4.243.879-5.121C3.757 10 5.172 10 8 10h8c2.828 0 4.243 0 5.121.879C22 11.757 22 13.172 22 16s0 4.243-.879 5.121C20.243 22 18.828 22 16 22H8c-2.828 0-4.243 0-5.121-.879C2 20.243 2 18.828 2 16Z" />
                  <path stroke-linecap="round" stroke-width="1.5" d="M6 10V8a6 6 0 1 1 12 0v2" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16h.009m3.982 0H12m3.991 0H16" />
                </g>
              </svg> New Password</label>
            <div class="d-flex align-items-center gap-4">
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input formControlName="password" type="password" id="password" class="form-control"
                  placeholder="Enter a strong Password" [ngClass]="{
         'error-input': passwordForm.get('password')?.touched && passwordForm.get('password')?.invalid,
         'success-input': passwordForm.get('password')?.touched && passwordForm.get('password')?.valid
       }">
              </div>
            </div>
            @if (passwordForm.controls['password'].errors && passwordForm.controls['password'].touched) {
            <div class="text-danger mt-1">
              @for (err of getPasswordErrors(); track err) {
              <p class="error-msg">{{ err }}</p>
              }
            </div>
            }
          </div>
          <div class="input">
            <label for="repassword"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <g fill="none">
                  <path stroke-width="1.5"
                    d="M2 16c0-2.828 0-4.243.879-5.121C3.757 10 5.172 10 8 10h8c2.828 0 4.243 0 5.121.879C22 11.757 22 13.172 22 16s0 4.243-.879 5.121C20.243 22 18.828 22 16 22H8c-2.828 0-4.243 0-5.121-.879C2 20.243 2 18.828 2 16Z" />
                  <path stroke-linecap="round" stroke-width="1.5" d="M6 10V8a6 6 0 1 1 12 0v2" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16h.009m3.982 0H12m3.991 0H16" />
                </g>
              </svg> Confirm Password</label>
            <div class="d-flex align-items-center gap-4">
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input formControlName="rePassword" type="password" id="repassword" class="form-control"
                  placeholder="Confirm your Password" [ngClass]="{
         'error-input': passwordForm.hasError('passwordMismatch') && passwordForm.get('rePassword')?.touched,
         'success-input': !passwordForm.hasError('passwordMismatch') && passwordForm.get('rePassword')?.touched && passwordForm.get('rePassword')?.valid
       }">
              </div>
            </div>
            @if (passwordForm.hasError('passwordMismatch') && passwordForm.get('rePassword')?.touched) {
            <p class="error-msg">
              Passwords do not match.
            </p>
            }
          </div>
          @if (errMsg) {
          <div class="alert alert-danger" role="alert">
            {{errMsg}}
          </div>
          }
          <button class="btn btn-lg btn-success w-100" (click)="newPassword()"
            [disabled]="isLoading || !passwordForm.valid">
            @if (isLoading) {
            <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
            }
            @if (!isLoading) {
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
              </g>
            </svg>
            }
            <span>Confirm Password</span>
          </button>
        </form>
      </div>
      <div class="col-6 text-center">
        <img src="./images/verify.svg" alt="WDS logo">
      </div>
    </div>
  </div>
</div>
}