<div class="custom-info-card" [formGroup]="customInfoForm">
   <h2>Custom Info</h2>

   <ol class="info-list" formArrayName="fields">
      @for (group of fieldsArray.controls; track $index; let i = $index){

      <li class="info-item" [formGroupName]="i" [ngClass]="{'editing': !group.get('value')?.disabled}">

         <span [title]="group?.get('label')?.value " class="label">{{ group.get('label')?.value }}</span>

         <div class="value-area">

            <span [title]="group?.get('value')?.value " class="display-value">
               {{ group.get('value')?.value }}
            </span>

            @if(group.get('htmlType')?.value === 'input'){
            <input [type]="group.get('htmlType')?.value" class="edit-input" formControlName="value"
               [placeholder]="(group.get('value')?.value) ? (group.get('value')?.value) : group.get('placeholder')?.value"
               (input)="onFilterInput(i, $event)">
            }

            @if(group.get('htmlType')?.value === 'textarea'){
            <textarea [placeholder]="(group.get('value')?.value) ? '' : group.get('placeholder')?.value"
               class="edit-input" formControlName="value" (input)="onFilterInput(i, $event)"></textarea>
            }

            @let valueControl = group.get('value');
            @if(getErrorMessage(valueControl)) {
            <div class="validation-error">
               <p class="error-msg">
                  {{ getErrorMessage(valueControl) }}
               </p>
            </div>
            }

         </div>

         <div class="actions">

            @if (group.get('value')?.disabled) {
            <ng-container>
               <button class="icon-btn edit" title="edit" (click)="onEdit(i)">
                  <svg width="14" height="17" viewBox="0 0 14 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M8.13693 0.855819C9.27803 -0.285273 11.1281 -0.285273 12.2692 0.855819C13.4103 1.99691 13.4103 3.84699 12.2692 4.98808L6.57369 10.6836C6.25269 11.0046 6.05665 11.2007 5.83816 11.3711C5.58074 11.5719 5.30221 11.744 5.0075 11.8845C4.75736 12.0037 4.49433 12.0913 4.06363 12.2349L2.05915 12.903L1.5779 13.0635C1.14714 13.2071 0.672218 13.0949 0.351146 12.7739C0.0300745 12.4528 -0.0820375 11.9779 0.06155 11.5471L0.890125 9.06139C1.03367 8.63068 1.12133 8.36766 1.24054 8.11752C1.38099 7.82281 1.55313 7.54427 1.75392 7.28685C1.92434 7.06836 2.12039 6.87232 2.44143 6.55132L8.13693 0.855819ZM2.03319 11.7258L1.39917 11.0918L1.94549 9.45287C2.10455 8.97569 2.17025 8.78167 2.2561 8.60151C2.3614 8.38056 2.49046 8.17174 2.64099 7.97875C2.76373 7.82139 2.90789 7.67586 3.26356 7.32019L7.68179 2.90196C7.86416 3.35945 8.17272 3.91161 8.69306 4.43195C9.2134 4.95229 9.76557 5.26086 10.2231 5.44323L5.80483 9.86146C5.44916 10.2171 5.30363 10.3613 5.14627 10.484C4.95327 10.6346 4.74445 10.7636 4.5235 10.8689C4.34335 10.9548 4.14933 11.0205 3.67215 11.1795L2.03319 11.7258ZM11.1195 4.5468C11.0266 4.52642 10.9105 4.49574 10.7785 4.44993C10.4154 4.32399 9.93794 4.08584 9.48856 3.63646C9.03918 3.18708 8.80103 2.70957 8.67508 2.34655C8.62928 2.21453 8.5986 2.0984 8.57821 2.00553L8.93243 1.65131C9.63418 0.949562 10.7719 0.949562 11.4737 1.65131C12.1755 2.35307 12.1755 3.49083 11.4737 4.19259L11.1195 4.5468ZM1.52696e-05 15.5625C1.52696e-05 15.2518 0.251855 15 0.562515 15H12.5625V16.125H0.562515C0.251855 16.125 1.52696e-05 15.8732 1.52696e-05 15.5625Z"
                        fill="#4A6D97" />
                  </svg>
               </button>


               <!-- <button class="icon-btn delete-btn" title="delete" (click)="openDeleteModal(i)">
                  <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M5.66952 1.42113e-05H8.2056C8.3679 -8.93219e-05 8.50929 -0.000179489 8.64281 0.0211409C9.17028 0.10537 9.62673 0.43436 9.87344 0.908129C9.93588 1.02805 9.98051 1.16221 10.0317 1.31621L10.1154 1.56738C10.1296 1.6099 10.1337 1.62193 10.1371 1.63141C10.2684 1.9945 10.609 2.23995 10.995 2.24973C11.0051 2.24998 11.0175 2.25003 11.0626 2.25003H13.3126C13.6232 2.25003 13.8751 2.50187 13.8751 2.81253C13.8751 3.12319 13.6232 3.37503 13.3126 3.37503H0.5625C0.25184 3.37503 0 3.12319 0 2.81253C0 2.50187 0.25184 2.25003 0.5625 2.25003H2.81256C2.8576 2.25003 2.87003 2.24999 2.88017 2.24973C3.26616 2.23995 3.60668 1.99452 3.73802 1.63143C3.74147 1.62188 3.74544 1.61011 3.75968 1.56738L3.84339 1.31622C3.89461 1.16223 3.93924 1.02805 4.00169 0.90813C4.2484 0.434361 4.70485 0.10537 5.23232 0.0211409C5.36584 -0.000179489 5.50723 -8.93219e-05 5.66952 1.42113e-05ZM4.69361 2.25003C4.73225 2.17426 4.76648 2.09553 4.79593 2.01411C4.80487 1.98939 4.81365 1.96307 4.82492 1.92925L4.89977 1.70469C4.96815 1.49956 4.98389 1.45772 4.99951 1.42773C5.08174 1.26981 5.23389 1.16014 5.40972 1.13207C5.44311 1.12673 5.48777 1.12503 5.70401 1.12503H8.17112C8.38735 1.12503 8.43201 1.12673 8.46541 1.13207C8.64123 1.16014 8.79338 1.26981 8.87562 1.42773C8.89124 1.45772 8.90698 1.49955 8.97536 1.70469L9.05016 1.92912L9.0792 2.01413C9.10865 2.09554 9.14288 2.17427 9.18151 2.25003H4.69361Z"
                        fill="#E04F5F" />
                     <path
                        d="M2.37382 4.65011C2.35315 4.34014 2.08512 4.10561 1.77515 4.12627C1.46517 4.14694 1.23064 4.41497 1.25131 4.72495L1.5989 9.93875C1.66302 10.9008 1.71481 11.6779 1.83629 12.2877C1.96259 12.9217 2.17741 13.4512 2.6211 13.8663C3.0648 14.2814 3.60746 14.4606 4.24845 14.5444C4.86497 14.6251 5.64378 14.625 6.60795 14.625H7.26713C8.23129 14.625 9.01016 14.6251 9.62668 14.5444C10.2677 14.4606 10.8103 14.2814 11.254 13.8663C11.6977 13.4512 11.9125 12.9217 12.0388 12.2877C12.1603 11.6779 12.2121 10.9008 12.2762 9.93876L12.6238 4.72495C12.6445 4.41497 12.41 4.14694 12.1 4.12627C11.79 4.10561 11.522 4.34014 11.5013 4.65011L11.1564 9.82445C11.089 10.8353 11.0409 11.5387 10.9355 12.0679C10.8333 12.5813 10.6905 12.853 10.4854 13.0448C10.2804 13.2367 9.99976 13.361 9.48076 13.4289C8.94571 13.4989 8.24071 13.5 7.22757 13.5H6.64755C5.63442 13.5 4.92942 13.4989 4.39436 13.4289C3.87536 13.361 3.59474 13.2367 3.38968 13.0448C3.18462 12.853 3.04187 12.5812 2.93961 12.0679C2.83419 11.5387 2.78617 10.8353 2.71877 9.82445L2.37382 4.65011Z"
                        fill="#E04F5F" />
                     <path
                        d="M5.0066 6.00282C5.31572 5.97191 5.59136 6.19744 5.62228 6.50656L5.99728 10.2566C6.02819 10.5657 5.80266 10.8413 5.49354 10.8722C5.18442 10.9031 4.90877 10.6776 4.87786 10.3685L4.50286 6.6185C4.47195 6.30938 4.69748 6.03373 5.0066 6.00282Z"
                        fill="#E04F5F" />
                     <path
                        d="M8.86854 6.00282C9.17766 6.03373 9.40319 6.30938 9.37228 6.6185L8.99728 10.3685C8.96636 10.6776 8.69072 10.9031 8.3816 10.8722C8.07248 10.8413 7.84695 10.5657 7.87786 10.2566L8.25286 6.50656C8.28377 6.19744 8.55942 5.97191 8.86854 6.00282Z"
                        fill="#E04F5F" />
                  </svg>

               </button> -->
            </ng-container>
            }

            @if (!group.get('value')?.disabled) {
            <ng-container>

               @if(isLoading && selectedField === i){
               <button class="view-btn" disabled title="loading">
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
               </button>
               }
               @if(!isLoading && selectedField !== i){
               <button class="icon-btn delete-btn" title="confirm" (click)="onConfirm(i)">
                  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path
                        d="M11.0852 6.58525C11.3049 6.36558 11.3049 6.00942 11.0852 5.78975C10.8656 5.57008 10.5094 5.57008 10.2898 5.78975L6.9375 9.142L5.83525 8.03975C5.61558 7.82008 5.25942 7.82008 5.03975 8.03975C4.82008 8.25942 4.82008 8.61558 5.03975 8.83525L6.53975 10.3352C6.75942 10.5549 7.11558 10.5549 7.33525 10.3352L11.0852 6.58525Z"
                        fill="#4CA883" />
                     <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M8.0625 0C3.6097 0 0 3.6097 0 8.0625C0 12.5153 3.6097 16.125 8.0625 16.125C12.5153 16.125 16.125 12.5153 16.125 8.0625C16.125 3.6097 12.5153 0 8.0625 0ZM1.125 8.0625C1.125 4.23102 4.23102 1.125 8.0625 1.125C11.894 1.125 15 4.23102 15 8.0625C15 11.894 11.894 15 8.0625 15C4.23102 15 1.125 11.894 1.125 8.0625Z"
                        fill="#4CA883" />
                  </svg>
               </button>
               }
               @if(!isLoading || selectedField !== i){
               <button class="icon-btn delete-btn" title="cancel" (click)="onCancel(i)">
                  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path
                        d="M6.58522 5.78974C6.36555 5.57007 6.0094 5.57007 5.78973 5.78974C5.57006 6.00941 5.57006 6.36557 5.78973 6.58524L7.26699 8.0625L5.78975 9.53974C5.57008 9.75941 5.57008 10.1156 5.78975 10.3352C6.00942 10.5549 6.36557 10.5549 6.58524 10.3352L8.06248 8.85799L9.53971 10.3352C9.75938 10.5549 10.1155 10.5549 10.3352 10.3352C10.5549 10.1156 10.5549 9.7594 10.3352 9.53973L8.85798 8.0625L10.3352 6.58525C10.5549 6.36558 10.5549 6.00943 10.3352 5.78976C10.1156 5.57009 9.7594 5.57009 9.53973 5.78976L8.06248 7.267L6.58522 5.78974Z"
                        fill="#E04F5F" />
                     <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M8.0625 0C3.6097 0 0 3.6097 0 8.0625C0 12.5153 3.6097 16.125 8.0625 16.125C12.5153 16.125 16.125 12.5153 16.125 8.0625C16.125 3.6097 12.5153 0 8.0625 0ZM1.125 8.0625C1.125 4.23102 4.23102 1.125 8.0625 1.125C11.894 1.125 15 4.23102 15 8.0625C15 11.894 11.894 15 8.0625 15C4.23102 15 1.125 11.894 1.125 8.0625Z"
                        fill="#E04F5F" />
                  </svg>
               </button>
               }
            </ng-container>
            }
         </div>
      </li>
      }
   </ol>
</div>

<!--Delete Confirmation Modal-->
<app-popup [title]="'Delete Field'" [paragraph1]="'Are you Sure you want to Delete this field?'"
   [paragraph2]="'This action cannot be undone!'" [isOpen]="isDeleteModalOpen" (close)="closeDeleteModal()">
   <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="onRemove(selectedField)">
      @if(isLoading){
      <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
      }@else{
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
         <g fill="none" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round"
               d="M5.73 0.687514H8.2681C8.4304 0.687411 8.57179 0.687321 8.70531 0.708641C9.23278 0.79287 9.68923 1.12186 9.93594 1.59563C9.99838 1.71555 10.043 1.84971 10.0942 2.00371L10.1779 2.25488C10.1921 2.2974 10.1962 2.30943 10.1996 2.31891C10.3309 2.682 10.6715 2.92745 11.0575 2.93723C11.0676 2.93748 11.08 2.93753 11.1251 2.93753H13.3751C13.6857 2.93753 13.9376 3.18937 13.9376 3.50003C13.9376 3.81069 13.6857 4.06253 13.3751 4.06253H0.625C0.31434 4.06253 0.0625 3.81069 0.0625 3.50003C0.0625 3.18937 0.31434 2.93753 0.625 2.93753H2.87506C2.9201 2.93753 2.93253 2.93749 2.94267 2.93723C3.32866 2.92745 3.66918 2.68202 3.80052 2.31893C3.80397 2.30938 3.80794 2.29761 3.82218 2.25488L3.90589 2.00372C3.95711 1.84973 4.00174 1.71555 4.06419 1.59563C4.3109 1.12186 4.76735 0.79287 5.29482 0.708641C5.42834 0.687321 5.56973 0.687411 5.73202 0.687514ZM4.75611 2.93753C4.79475 2.86176 4.82898 2.78303 4.85843 2.70161C4.86737 2.67689 4.87615 2.65057 4.88742 2.61675L4.96227 2.39219C5.03065 2.18706 5.04639 2.14522 5.06201 2.11523C5.14424 1.95731 5.29639 1.84764 5.47222 1.81957C5.50561 1.81423 5.55027 1.81253 5.76651 1.81253H8.23362C8.44985 1.81253 8.49451 1.81423 8.52791 1.81957C8.70373 1.84764 8.85588 1.95731 8.93812 2.11523C8.95374 2.14522 8.96948 2.18705 9.03786 2.39219L9.11266 2.61662L9.1417 2.70163C9.17115 2.78304 9.20538 2.86177 9.24401 2.93753H4.75611Z" />
            <path stroke-linecap="round"
               d="M2.43632 5.33761C2.41565 5.02764 2.14762 4.79311 1.83765 4.81377C1.52767 4.83444 1.29314 5.10247 1.31381 5.41245L1.6614 10.6262C1.72552 11.5883 1.77731 12.3654 1.89879 12.9752C2.02509 13.6092 2.23991 14.1387 2.6836 14.5538C3.1273 14.9689 3.66996 15.1481 4.31095 15.2319C4.92747 15.3126 5.70628 15.3125 6.67045 15.3125H7.32963C8.29379 15.3125 9.07266 15.3126 9.68918 15.2319C10.3302 15.1481 10.8728 14.9689 11.3165 14.5538C11.7602 14.1387 11.975 13.6092 12.1013 12.9752C12.2228 12.3654 12.2746 11.5883 12.3387 10.6263L12.6863 5.41245C12.707 5.10247 12.4725 4.83444 12.1625 4.81377C11.8525 4.79311 11.5845 5.02764 11.5638 5.33761L11.2189 10.5119C11.1515 11.5228 11.1034 12.2262 10.998 12.7554C10.8958 13.2688 10.753 13.5405 10.5479 13.7323C10.3429 13.9242 10.0623 14.0485 9.54326 14.1164C9.00821 14.1864 8.30321 14.1875 7.29007 14.1875H6.71005C5.69692 14.1875 4.99192 14.1864 4.45686 14.1164C3.93786 14.0485 3.65724 13.9242 3.45218 13.7323C3.24712 13.5405 3.10437 13.2687 3.00211 12.7554C2.89669 12.2262 2.84867 11.5228 2.78127 10.5119L2.43632 5.33761Z" />
            <path stroke-linecap="round"
               d="M5.0691 6.69032C5.37822 6.65941 5.65386 6.88494 5.68478 7.19406L6.05978 10.9441C6.09069 11.2532 5.86516 11.5288 5.55604 11.5597C5.24692 11.5906 4.97127 11.3651 4.94036 11.056L4.56536 7.306C4.53445 6.99688 4.75998 6.72123 5.0691 6.69032Z" />
            <path stroke-linecap="round"
               d="M8.93104 6.69032C9.24016 6.72123 9.46569 6.99688 9.43478 7.306L9.05978 11.056C9.02886 11.3651 8.75322 11.5906 8.4441 11.5597C8.13498 11.5288 7.90945 11.2532 7.94036 10.9441L8.31536 7.19406C8.34627 6.88494 8.62192 6.65941 8.93104 6.69032Z" />
         </g>
      </svg>
      }
      <span>Delete</span>
   </button>
   <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeleteModal()">
      Close
   </button>
</app-popup>