<!-- Contract Form Modal -->
<app-contract-form-modal [isOpen]="isAddModalOpen" [isEditMode]="isEditMode" [contract]="selectedContract"
  [employee]="employee" (onClose)="closeAddModal()" (onSave)="onContractSave($event)">
</app-contract-form-modal>
<div class="contracts-content">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Work Contracts</h2>
    <button class="view-btn" (click)="addContract()">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="10" />
          <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
        </g>
      </svg>
      Add Contract
    </button>
  </div>

  <!-- Table Header Template -->
  <ng-template #headerTemplate>
    <th class="text-start">Contract Number</th>
    <th class="text-start">Start Date</th>
    <th class="text-start">End Date</th>
    <th class="text-start">Salary</th>
    <th class="text-start">Insurance Salary</th>
    <th class="text-start">Status</th>
    <th class="text-start">Actions</th>
  </ng-template>

  <!-- Table Row Template -->
  <ng-template #rowTemplate let-contract>
    <td class="text-start">
      <div class="d-flex flex-column">
        <span class="fw-bold">{{ contract.contractNumber }}</span>
      </div>
    </td>
    <td class="text-start">{{ contract.startDate || contract.start_contract }}</td>
    <td class="text-start">{{ contract.endDate || contract.end_contract }}</td>
    <td class="text-start">{{ getFormattedSalary(contract.salary, contract.currency || 'EGP') }}</td>
    <td class="text-start">{{ getFormattedSalary(contract.insuranceSalary || contract.insurance_salary,
      contract.currency || 'EGP') }}</td>
    <td class="text-start">
      <span [ngClass]="getStatusClass(contract.status)">
        @if (contract.status === 'Upcoming') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="M12 7v5l3 3" />
          </g>
        </svg>
        }
        @if (contract.status === 'Active') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
        @if (contract.status === 'Cancelled') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
          </g>
        </svg>
        }
        @if (contract.status === 'Expired') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="m15 9l-6 6m0-6l6 6" />
          </g>
        </svg>
        }
        <span>{{ contract.status }}</span>
      </span>
    </td>
    <td class="text-start">
      <div class="d-flex align-items-center gap-3">
        <!-- History Action -->
        <a (click)="viewHistory(contract)" class="view-btn" title="Contract History">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 8v4l3 3" />
            <circle cx="12" cy="12" r="10" />
          </svg>

        </a>
        <!-- Edit Action -->
        @if (contract.status !== 'Cancelled' && contract.status !== 'Expired') {
        <a (click)="editContract(contract)" class="edit-btn" title="Edit Contract">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
            <path d="m15 5 4 4" />
          </svg>
          Edit
        </a>
        }
        <!-- Cancel Action -->
        @if (contract.status !== 'Cancelled' && contract.status !== 'Expired') {
        <a (click)="openCancelModal(contract)" class="remove-btn" title="Cancel Contract">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
            viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10" />
              <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
            </g>
          </svg>
          Cancel
        </a>
        }
      </div>
    </td>
  </ng-template>

  <!-- Empty Template -->
  <ng-template #emptyTemplate>
    <tr>
      <td colspan="7" class="text-center py-4">
        <div class="no-data">
          No contracts found
        </div>
      </td>
    </tr>
  </ng-template>

  <app-table [data]="contractsData" [totalItems]="totalItems" [currentPage]="currentPage" [itemsPerPage]="itemsPerPage"
    [isLoading]="isLoading" [columnsCount]="7" [headerTemplate]="headerTemplate" [rowTemplate]="rowTemplate"
    [emptyTemplate]="emptyTemplate" (pageChange)="onPageChange($event)"
    (itemsPerPageChange)="onItemsPerPageChange($event)">
  </app-table>
</div>

<!-- Cancel Confirmation Modal -->
<app-contract-cancel-modal [isOpen]="isCancelModalOpen" [contract]="selectedContract" (onClose)="closeCancelModal()"
  (onCancel)="onContractCancel($event)">
</app-contract-cancel-modal>

<!-- Contract History Modal -->
<app-contract-history-modal [isOpen]="isHistoryModalOpen" [contract]="selectedContract" [historyData]="contractHistory"
  (onClose)="closeHistoryModal()">
</app-contract-history-modal>