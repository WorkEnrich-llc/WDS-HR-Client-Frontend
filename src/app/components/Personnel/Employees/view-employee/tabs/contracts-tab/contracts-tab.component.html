<!-- Contract Form Modal -->
<app-contract-form-modal [isOpen]="isAddModalOpen" [isLoading]="isLoading" [isEditMode]="isEditMode"
  [contract]="selectedContract" [employee]="employee" (onClose)="closeAddModal()" (onSave)="onContractSave($event)">
</app-contract-form-modal>

<!-- <app-contract-form-modal #addForm [isOpen]="isOpen" [contract]="editedContract" [employee]="employee"
[isEditMode]="isEditMode" [isLoading]="isLoading" (onSave)="onContractSave($event)" (onClose)="closeAddModal()">
</app-contract-form-modal> -->


<div class="contracts-content">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Work Contracts</h2>
    <button class="view-btn" (click)="addContract()"
      [title]="isAddContractDisabled ? 'Cannot add new contract ' : 'Add New Contract'">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="10" />
          <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
        </g>
      </svg>
      Add Contract
    </button>
  </div>

  <!-- Table Header Template -->
  <ng-template #headerTemplate>
    <th class="text-start">Contract Number</th>
    <th class="text-start">Start Date</th>
    <th class="text-start">End Date</th>
    <th class="text-start">Salary</th>
    <th class="text-start">Insurance Salary</th>
    <th class="text-start">Status</th>
    <th class="text-start">Actions</th>
  </ng-template>

  <!-- Table Row Template -->
  <ng-template #rowTemplate let-contract>
    <td class="text-start">
      <div class="d-flex flex-column">
        <span class="fw-bold">{{ contract.contractNumber }}</span>
      </div>
    </td>
    <td class="text-start">{{ contract.startDate || contract.start_contract }}</td>
    <td class="text-start">{{ contract.endDate ? contract.endDate : 'Indefinite term contract' }}</td>
    <!-- <td class="text-start">{{ contract.endDate || contract.end_contract }}</td> -->
    <td class="text-start">{{ getFormattedSalary(contract.salary, contract.currency || 'EGP') }}</td>
    <td class="text-start">{{ getFormattedSalary(contract.insurance.insurance.amount ?? 0,
      contract.currency || 'EGP') }}</td>

    <td class="text-start">
      <span [ngClass]="getStatusClass(contract.status)">
        @if (contract.status === 'Upcoming') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="M12 7v5l3 3" />
          </g>
        </svg>
        }
        @if (contract.status === 'Active') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
        @if (contract.status === 'Cancelled') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
          </g>
        </svg>
        }
        @if (contract.status === 'Expired') {
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="m15 9l-6 6m0-6l6 6" />
          </g>
        </svg>
        }
        @if (contract.status === 'Terminate') {
        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
          </g>
        </svg> -->
        <svg width="15" height="17" viewBox="0 0 15 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M7.3125 3.75C7.62316 3.75 7.875 4.00184 7.875 4.3125V8.8125C7.875 9.12316 7.62316 9.375 7.3125 9.375C7.00184 9.375 6.75 9.12316 6.75 8.8125V4.3125C6.75 4.00184 7.00184 3.75 7.3125 3.75Z"
            fill="#E04F5F" />
          <path
            d="M8.0625 11.0625C8.0625 11.4767 7.72671 11.8125 7.3125 11.8125C6.89829 11.8125 6.5625 11.4767 6.5625 11.0625C6.5625 10.6483 6.89829 10.3125 7.3125 10.3125C7.72671 10.3125 8.0625 10.6483 8.0625 11.0625Z"
            fill="#E04F5F" />
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M7.3125 0C6.78406 0 6.30139 0.145194 5.77394 0.390274C5.26356 0.627418 4.67279 0.977278 3.93343 1.41514L3.36861 1.74962C2.629 2.18762 2.03828 2.53743 1.58307 2.87208C1.11236 3.21813 0.751326 3.57233 0.490009 4.03659C0.229107 4.50011 0.111308 4.99571 0.0547917 5.5838C-1.06506e-05 6.15404 -5.87241e-06 6.85237 1.25078e-07 7.72948V8.39551C-5.87241e-06 9.27261 -1.0645e-05 9.97096 0.0547917 10.5412C0.111308 11.1293 0.229107 11.6249 0.490009 12.0884C0.751326 12.5527 1.11236 12.9069 1.58307 13.2529C2.03829 13.5876 2.629 13.9374 3.36861 14.3754L3.93345 14.7099C4.67278 15.1477 5.26358 15.4976 5.77394 15.7347C6.30139 15.9798 6.78406 16.125 7.3125 16.125C7.84094 16.125 8.32361 15.9798 8.85106 15.7347C9.36143 15.4976 9.9522 15.1477 10.6916 14.7099L11.2564 14.3754C11.996 13.9374 12.5867 13.5876 13.0419 13.2529C13.5126 12.9069 13.8737 12.5527 14.135 12.0884C14.3959 11.6249 14.5137 11.1293 14.5702 10.5412C14.625 9.97096 14.625 9.27264 14.625 8.39554V7.72952C14.625 6.85242 14.625 6.15404 14.5702 5.5838C14.5137 4.99571 14.3959 4.50011 14.135 4.03659C13.8737 3.57233 13.5126 3.21813 13.0419 2.87208C12.5867 2.53743 11.996 2.18762 11.2564 1.74964L10.6916 1.41514C9.9522 0.977276 9.36144 0.627417 8.85106 0.390274C8.32361 0.145194 7.84094 0 7.3125 0ZM4.48143 2.39808C5.25179 1.94188 5.79454 1.62121 6.24799 1.41052C6.69015 1.20507 7.00556 1.125 7.3125 1.125C7.61944 1.125 7.93485 1.20507 8.37701 1.41052C8.83046 1.62121 9.37321 1.94188 10.1436 2.39808L10.6582 2.70284C11.4284 3.15898 11.9707 3.48086 12.3756 3.7785C12.7701 4.0685 12.9983 4.3106 13.1546 4.58841C13.3114 4.86696 13.4025 5.19293 13.4504 5.69142C13.4994 6.20163 13.5 6.84602 13.5 7.75774V8.36726C13.5 9.27898 13.4994 9.92337 13.4504 10.4336C13.4025 10.9321 13.3114 11.258 13.1546 11.5366C12.9983 11.8144 12.7701 12.0565 12.3756 12.3465C11.9707 12.6441 11.4284 12.966 10.6582 13.4222L10.1436 13.7269C9.37321 14.1831 8.83046 14.5038 8.37701 14.7145C7.93485 14.9199 7.61944 15 7.3125 15C7.00556 15 6.69015 14.9199 6.24799 14.7145C5.79454 14.5038 5.25179 14.1831 4.48143 13.7269L3.96681 13.4222C3.19657 12.966 2.6543 12.6441 2.24943 12.3465C1.85495 12.0565 1.62675 11.8144 1.47038 11.5366C1.31359 11.258 1.22254 10.9321 1.17463 10.4336C1.1256 9.92337 1.125 9.27898 1.125 8.36726V7.75774C1.125 6.84602 1.1256 6.20163 1.17463 5.69142C1.22254 5.19292 1.31359 4.86696 1.47038 4.58841C1.62675 4.3106 1.85495 4.0685 2.24943 3.7785C2.6543 3.48086 3.19657 3.15898 3.96681 2.70284L4.48143 2.39808Z"
            fill="#E04F5F" />
        </svg>

        }
        @if (contract.status === 'Resign') {
        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="16,17 21,12 16,7" />
                <line x1="21" y1="12" x2="9" y2="12" />
              </g>
            </svg> -->
        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10.2715 3.97516e-07C9.24582 -1.4757e-05 8.41907 -2.6973e-05 7.76885 0.0873933C7.09377 0.178156 6.52536 0.372326 6.07392 0.823763C5.68023 1.21746 5.4813 1.70127 5.37687 2.26977C5.2754 2.82219 5.25599 3.49822 5.25147 4.30937C5.24974 4.62003 5.50018 4.87326 5.81083 4.87499C6.12149 4.87672 6.37473 4.62629 6.37646 4.31563C6.38102 3.49551 6.40232 2.9142 6.48336 2.47301C6.56145 2.0479 6.68683 1.80185 6.86942 1.61926C7.07699 1.41169 7.36842 1.27635 7.91875 1.20236C8.48526 1.1262 9.2361 1.125 10.3127 1.125H11.0627C12.1392 1.125 12.8901 1.1262 13.4566 1.20236C14.0069 1.27635 14.2983 1.41169 14.5059 1.61926C14.7135 1.82683 14.8488 2.11826 14.9228 2.66859C14.999 3.2351 15.0002 3.98594 15.0002 5.0625V11.0625C15.0002 12.1391 14.999 12.8899 14.9228 13.4564C14.8488 14.0067 14.7135 14.2982 14.5059 14.5057C14.2983 14.7133 14.0069 14.8487 13.4566 14.9226C12.8901 14.9988 12.1392 15 11.0627 15H10.3127C9.2361 15 8.48526 14.9988 7.91875 14.9226C7.36842 14.8487 7.07699 14.7133 6.86942 14.5057C6.68683 14.3232 6.56145 14.0771 6.48336 13.652C6.40232 13.2108 6.38102 12.6295 6.37646 11.8094C6.37473 11.4987 6.12149 11.2483 5.81083 11.25C5.50018 11.2517 5.24974 11.505 5.25147 11.8156C5.25599 12.6268 5.2754 13.3028 5.37687 13.8552C5.4813 14.4237 5.68023 14.9075 6.07392 15.3012C6.52536 15.7527 7.09377 15.9468 7.76885 16.0376C8.41907 16.125 9.24582 16.125 10.2715 16.125H11.1038C12.1295 16.125 12.9562 16.125 13.6065 16.0376C14.2816 15.9468 14.85 15.7527 15.3014 15.3012C15.7528 14.8498 15.947 14.2814 16.0378 13.6063C16.1252 12.9561 16.1252 12.1293 16.1252 11.1037V5.02135C16.1252 3.99566 16.1252 3.16891 16.0378 2.51869C15.947 1.84361 15.7528 1.2752 15.3014 0.823763C14.85 0.372326 14.2816 0.178156 13.6065 0.0873933C12.9563 -2.6973e-05 12.1295 -1.4757e-05 11.1038 3.97516e-07H10.2715Z"
            fill="#E04F5F" />
          <path
            d="M10.3125 7.5C10.6232 7.5 10.875 7.75184 10.875 8.0625C10.875 8.37316 10.6232 8.625 10.3125 8.625H2.08308L3.55357 9.88542C3.78944 10.0876 3.81676 10.4427 3.61458 10.6786C3.41241 10.9144 3.0573 10.9418 2.82143 10.7396L0.19643 8.48958C0.0717537 8.38272 0 8.22671 0 8.0625C0 7.89829 0.0717536 7.74228 0.19643 7.63542L2.82143 5.38542C3.0573 5.18324 3.41241 5.21056 3.61458 5.44643C3.81676 5.6823 3.78944 6.03741 3.55357 6.23958L2.08308 7.5H10.3125Z"
            fill="#E04F5F" />
        </svg>

        }
        @if (contract.status === 'Probation') {
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M5.7664 2.47086e-07H5.86002C7.37032 -1.18229e-05 8.56227 -2.13906e-05 9.43044 0.114445C10.2838 0.226954 11.0505 0.474889 11.4146 1.18189C11.4671 1.28375 11.5113 1.38961 11.547 1.49846C11.7955 2.25669 11.4278 2.9729 10.9041 3.65077C10.3716 4.34013 9.52842 5.17508 8.46092 6.23218L6.61262 8.0625L8.46093 9.89283C9.52842 10.9499 10.3716 11.7849 10.9041 12.4742C11.4278 13.1521 11.7955 13.8683 11.547 14.6265C11.5113 14.7354 11.4671 14.8412 11.4146 14.9431C11.0505 15.6501 10.2838 15.898 9.43044 16.0106C8.56226 16.125 7.37031 16.125 5.86001 16.125H5.76641C4.25611 16.125 3.06416 16.125 2.19599 16.0106C1.34267 15.898 0.575959 15.6501 0.211827 14.9431C0.159365 14.8412 0.115085 14.7354 0.0794154 14.6265C-0.169032 13.8683 0.198633 13.1521 0.722295 12.4742C1.25484 11.7849 2.098 10.9499 3.1655 9.89283L5.0138 8.0625L3.1655 6.23218C2.09801 5.17508 1.25484 4.34013 0.722296 3.65077C0.198633 2.9729 -0.169032 2.2567 0.0794154 1.49847C0.115084 1.38961 0.159365 1.28376 0.211827 1.18189C0.575959 0.47489 1.34267 0.226954 2.19599 0.114445C3.06416 -2.13906e-05 4.2561 -1.18229e-05 5.7664 2.47086e-07ZM5.81321 7.27086L7.63569 5.46611C8.74413 4.36845 9.53273 3.58579 10.0138 2.96301C10.5094 2.32151 10.5363 2.02689 10.4779 1.84877C10.4609 1.79665 10.4396 1.7459 10.4145 1.697C10.3269 1.52706 10.0929 1.33652 9.28338 1.22979C8.4977 1.1262 7.38048 1.125 5.81321 1.125C4.24594 1.125 3.12872 1.1262 2.34304 1.22979C1.53356 1.33652 1.2995 1.52706 1.21197 1.697C1.18679 1.7459 1.16556 1.79665 1.14849 1.84877C1.09012 2.02689 1.11701 2.32151 1.61258 2.96301C2.09369 3.58579 2.88229 4.36845 3.99074 5.46612L5.81321 7.27086ZM5.81321 8.85414L3.99074 10.6589C2.88229 11.7565 2.09369 12.5392 1.61258 13.162C1.11701 13.8035 1.09012 14.0981 1.14849 14.2762C1.16556 14.3284 1.18679 14.3791 1.21197 14.428C1.2995 14.5979 1.53356 14.7885 2.34304 14.8952C3.12872 14.9988 4.24594 15 5.81321 15C7.38048 15 8.4977 14.9988 9.28338 14.8952C10.0929 14.7885 10.3269 14.5979 10.4145 14.428C10.4396 14.3791 10.4609 14.3284 10.4779 14.2762C10.5363 14.0981 10.5094 13.8035 10.0138 13.162C9.53273 12.5392 8.74413 11.7565 7.63568 10.6589L5.81321 8.85414ZM3.75071 3.1875C3.75071 2.87684 4.00255 2.625 4.31321 2.625H7.31321C7.62387 2.625 7.87571 2.87684 7.87571 3.1875C7.87571 3.49816 7.62387 3.75 7.31321 3.75H4.31321C4.00255 3.75 3.75071 3.49816 3.75071 3.1875ZM3.75071 12.9375C3.75071 12.6268 4.00255 12.375 4.31321 12.375H7.31321C7.62387 12.375 7.87571 12.6268 7.87571 12.9375C7.87571 13.2482 7.62387 13.5 7.31321 13.5H4.31321C4.00255 13.5 3.75071 13.2482 3.75071 12.9375Z"
            fill="#F28C38" />
        </svg>
        }
        <span>{{ contract.status }}</span>
      </span>
    </td>

    <td class="text-start">
      <div class="d-flex align-items-center gap-1">
        <!-- History Action - Available for all -->
        <a (click)="viewHistory(contract)" class="view-btn" title="Contract History">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 8v4l3 3" />
            <circle cx="12" cy="12" r="10" />
          </svg>
        </a>

        <!-- Delete Action - Only for expired contracts -->
        @if (contract.expired) {
        <a (click)="openDeleteModal(contract)" class="view-btn delete-btn" title="Delete Contract">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#E04F5F" class="bi bi-trash"
            viewBox="0 0 16 16">
            <path
              d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
            <path fill-rule="evenodd"
              d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
          </svg>
        </a>
        }

        <!-- Edit Action - Only for Upcoming and Active -->
        @if (contract.status === 'Upcoming' || contract.status === 'Active' || contract.status === 'Probation') {
        <a (click)="editContract(contract)" class="edit-btn" title="Edit Contract">
          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M8.01947 1.58655e-07L9.1875 3.37469e-07C9.49816 3.37469e-07 9.75 0.25184 9.75 0.5625C9.75 0.873161 9.49816 1.125 9.1875 1.125H8.0625C6.27883 1.125 4.99767 1.12619 4.02268 1.25728C3.06388 1.38619 2.48584 1.63136 2.0586 2.0586C1.63136 2.48584 1.38619 3.06388 1.25728 4.02268C1.12619 4.99767 1.125 6.27883 1.125 8.0625C1.125 9.84617 1.12619 11.1273 1.25728 12.1023C1.38619 13.0611 1.63136 13.6392 2.0586 14.0664C2.48584 14.4936 3.06388 14.7388 4.02268 14.8677C4.99767 14.9988 6.27883 15 8.0625 15C9.84617 15 11.1273 14.9988 12.1023 14.8677C13.0611 14.7388 13.6392 14.4936 14.0664 14.0664C14.4936 13.6392 14.7388 13.0611 14.8677 12.1023C14.9988 11.1273 15 9.84617 15 8.0625V6.9375C15 6.62684 15.2518 6.375 15.5625 6.375C15.8732 6.375 16.125 6.62684 16.125 6.9375V8.10553C16.125 9.83683 16.125 11.1936 15.9827 12.2522C15.837 13.3358 15.533 14.1908 14.8619 14.8619C14.1908 15.533 13.3358 15.837 12.2522 15.9827C11.1936 16.125 9.83683 16.125 8.10553 16.125H8.01947C6.28817 16.125 4.9314 16.125 3.87278 15.9827C2.78923 15.837 1.93421 15.533 1.2631 14.8619C0.591995 14.1908 0.28799 13.3358 0.14231 12.2522C-1.71438e-05 11.1936 -9.4973e-06 9.83683 1.58655e-07 8.10553V8.01947C-9.4973e-06 6.28817 -1.71438e-05 4.93139 0.14231 3.87278C0.28799 2.78923 0.591995 1.93421 1.2631 1.2631C1.93421 0.591995 2.78923 0.28799 3.87278 0.14231C4.93139 -1.71438e-05 6.28817 -9.4973e-06 8.01947 1.58655e-07ZM11.6404 0.769436C12.6663 -0.256478 14.3296 -0.256478 15.3556 0.769436C16.3815 1.79535 16.3815 3.45869 15.3556 4.4846L10.3695 9.47068C10.091 9.74918 9.9166 9.92364 9.72194 10.0755C9.49266 10.2543 9.24459 10.4076 8.98211 10.5327C8.75926 10.6389 8.52521 10.7169 8.15159 10.8414L5.9732 11.5675C5.57101 11.7016 5.1276 11.5969 4.82783 11.2972C4.52806 10.9974 4.42339 10.554 4.55745 10.1518L5.28358 7.97342C5.40809 7.59979 5.48609 7.36574 5.5923 7.14289C5.71739 6.88041 5.87071 6.63234 6.04953 6.40306C6.20137 6.2084 6.37583 6.03397 6.65433 5.7555L11.6404 0.769436ZM14.5601 1.56493C13.9735 0.978357 13.0225 0.978357 12.4359 1.56493L12.1534 1.8474C12.1705 1.91929 12.1943 2.00495 12.2274 2.1005C12.3349 2.41029 12.5383 2.81829 12.9225 3.2025C13.3067 3.5867 13.7147 3.7901 14.0245 3.89758C14.12 3.93073 14.2057 3.95455 14.2776 3.97157L14.5601 3.68911C15.1466 3.10253 15.1466 2.15151 14.5601 1.56493ZM13.3914 4.85782C13.0044 4.6914 12.5536 4.42459 12.127 3.99799C11.7004 3.57139 11.4336 3.12062 11.2672 2.73364L7.47563 6.52519C7.16325 6.83758 7.04073 6.96147 6.93661 7.09496C6.80803 7.25981 6.6978 7.43817 6.60786 7.62689C6.53502 7.77972 6.47901 7.9447 6.3393 8.36381L6.01538 9.33557L6.78943 10.1096L7.76119 9.7857C8.1803 9.64599 8.34528 9.58997 8.49811 9.51714C8.68683 9.4272 8.86519 9.31697 9.03004 9.18839C9.16353 9.08427 9.28742 8.96176 9.59981 8.64937L13.3914 4.85782Z"
              fill="#4A6D97" />
          </svg>
        </a>
        }

        <!-- menu actions -->
        @if (contract.status === 'Active' || contract.status === 'Upcoming' || contract.status === 'Probation') {
        <!-- Custom dropdown for Active contracts -->
        <div class="d-flex align-items-center gap-1" [class.open]="selectedForDropdown?.id === contract.id">
          <div class="custom-dropdown">
            <!-- class="dropdown-toggle action-btn" type="button" -->
            <a (click)="toggleDropdown(contract)" title="Menu" class="menu-btn">
              <!-- Actions
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6,9 12,15 18,9"></polyline>
                          </svg> -->
              <svg width="15" height="5" viewBox="0 0 15 5" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M0 2.0625C0 0.923413 0.923413 0 2.0625 0C3.20159 0 4.125 0.923413 4.125 2.0625C4.125 3.20159 3.20159 4.125 2.0625 4.125C0.923413 4.125 0 3.20159 0 2.0625ZM2.0625 1.125C1.54473 1.125 1.125 1.54473 1.125 2.0625C1.125 2.58027 1.54473 3 2.0625 3C2.58027 3 3 2.58027 3 2.0625C3 1.54473 2.58027 1.125 2.0625 1.125Z"
                  fill="#4A6D97" />
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M5.25 2.0625C5.25 0.923413 6.17341 0 7.3125 0C8.45159 0 9.375 0.923413 9.375 2.0625C9.375 3.20159 8.45159 4.125 7.3125 4.125C6.17341 4.125 5.25 3.20159 5.25 2.0625ZM7.3125 1.125C6.79473 1.125 6.375 1.54473 6.375 2.0625C6.375 2.58027 6.79473 3 7.3125 3C7.83027 3 8.25 2.58027 8.25 2.0625C8.25 1.54473 7.83027 1.125 7.3125 1.125Z"
                  fill="#4A6D97" />
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M12.5625 0C11.4234 0 10.5 0.923413 10.5 2.0625C10.5 3.20159 11.4234 4.125 12.5625 4.125C13.7016 4.125 14.625 3.20159 14.625 2.0625C14.625 0.923413 13.7016 0 12.5625 0ZM11.625 2.0625C11.625 1.54473 12.0447 1.125 12.5625 1.125C13.0803 1.125 13.5 1.54473 13.5 2.0625C13.5 2.58027 13.0803 3 12.5625 3C12.0447 3 11.625 2.58027 11.625 2.0625Z"
                  fill="#4A6D97" />
              </svg>

            </a>
            <ul class="dropdown-menu" [class.show]="selectedForDropdown?.id === contract.id">
              <!-- Terminate Action -->
              @if (contract.status === 'Active' || contract.status === 'Probation') {<li>
                <a class="dropdown-item terminate-item" (click)="openTerminateModal(contract); closeDropdown()">
                  <svg width="15" height="17" viewBox="0 0 15 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M7.3125 3.75C7.62316 3.75 7.875 4.00184 7.875 4.3125V8.8125C7.875 9.12316 7.62316 9.375 7.3125 9.375C7.00184 9.375 6.75 9.12316 6.75 8.8125V4.3125C6.75 4.00184 7.00184 3.75 7.3125 3.75Z"
                      fill="#E04F5F" />
                    <path
                      d="M8.0625 11.0625C8.0625 11.4767 7.72671 11.8125 7.3125 11.8125C6.89829 11.8125 6.5625 11.4767 6.5625 11.0625C6.5625 10.6483 6.89829 10.3125 7.3125 10.3125C7.72671 10.3125 8.0625 10.6483 8.0625 11.0625Z"
                      fill="#E04F5F" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M7.3125 0C6.78406 0 6.30139 0.145194 5.77394 0.390274C5.26356 0.627418 4.67279 0.977278 3.93343 1.41514L3.36861 1.74962C2.629 2.18762 2.03828 2.53743 1.58307 2.87208C1.11236 3.21813 0.751326 3.57233 0.490009 4.03659C0.229107 4.50011 0.111308 4.99571 0.0547917 5.5838C-1.06506e-05 6.15404 -5.87241e-06 6.85237 1.25078e-07 7.72948V8.39551C-5.87241e-06 9.27261 -1.0645e-05 9.97096 0.0547917 10.5412C0.111308 11.1293 0.229107 11.6249 0.490009 12.0884C0.751326 12.5527 1.11236 12.9069 1.58307 13.2529C2.03829 13.5876 2.629 13.9374 3.36861 14.3754L3.93345 14.7099C4.67278 15.1477 5.26358 15.4976 5.77394 15.7347C6.30139 15.9798 6.78406 16.125 7.3125 16.125C7.84094 16.125 8.32361 15.9798 8.85106 15.7347C9.36143 15.4976 9.9522 15.1477 10.6916 14.7099L11.2564 14.3754C11.996 13.9374 12.5867 13.5876 13.0419 13.2529C13.5126 12.9069 13.8737 12.5527 14.135 12.0884C14.3959 11.6249 14.5137 11.1293 14.5702 10.5412C14.625 9.97096 14.625 9.27264 14.625 8.39554V7.72952C14.625 6.85242 14.625 6.15404 14.5702 5.5838C14.5137 4.99571 14.3959 4.50011 14.135 4.03659C13.8737 3.57233 13.5126 3.21813 13.0419 2.87208C12.5867 2.53743 11.996 2.18762 11.2564 1.74964L10.6916 1.41514C9.9522 0.977276 9.36144 0.627417 8.85106 0.390274C8.32361 0.145194 7.84094 0 7.3125 0ZM4.48143 2.39808C5.25179 1.94188 5.79454 1.62121 6.24799 1.41052C6.69015 1.20507 7.00556 1.125 7.3125 1.125C7.61944 1.125 7.93485 1.20507 8.37701 1.41052C8.83046 1.62121 9.37321 1.94188 10.1436 2.39808L10.6582 2.70284C11.4284 3.15898 11.9707 3.48086 12.3756 3.7785C12.7701 4.0685 12.9983 4.3106 13.1546 4.58841C13.3114 4.86696 13.4025 5.19293 13.4504 5.69142C13.4994 6.20163 13.5 6.84602 13.5 7.75774V8.36726C13.5 9.27898 13.4994 9.92337 13.4504 10.4336C13.4025 10.9321 13.3114 11.258 13.1546 11.5366C12.9983 11.8144 12.7701 12.0565 12.3756 12.3465C11.9707 12.6441 11.4284 12.966 10.6582 13.4222L10.1436 13.7269C9.37321 14.1831 8.83046 14.5038 8.37701 14.7145C7.93485 14.9199 7.61944 15 7.3125 15C7.00556 15 6.69015 14.9199 6.24799 14.7145C5.79454 14.5038 5.25179 14.1831 4.48143 13.7269L3.96681 13.4222C3.19657 12.966 2.6543 12.6441 2.24943 12.3465C1.85495 12.0565 1.62675 11.8144 1.47038 11.5366C1.31359 11.258 1.22254 10.9321 1.17463 10.4336C1.1256 9.92337 1.125 9.27898 1.125 8.36726V7.75774C1.125 6.84602 1.1256 6.20163 1.17463 5.69142C1.22254 5.19292 1.31359 4.86696 1.47038 4.58841C1.62675 4.3106 1.85495 4.0685 2.24943 3.7785C2.6543 3.48086 3.19657 3.15898 3.96681 2.70284L4.48143 2.39808Z"
                      fill="#E04F5F" />
                  </svg>

                  Terminate
                </a>
              </li>}
              <!-- Cancel Action - Only for Upcoming -->
              @if (contract.status === 'Upcoming') {
              <li>
                <a (click)="openCancelModal(contract)" class=" dropdown-item cancel-item icon-color"
                  title="Cancel Contract">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9 4.6875C9.31066 4.6875 9.5625 4.93934 9.5625 5.25V9.75C9.5625 10.0607 9.31066 10.3125 9 10.3125C8.68934 10.3125 8.4375 10.0607 8.4375 9.75V5.25C8.4375 4.93934 8.68934 4.6875 9 4.6875Z"
                      fill="#E04F5F" />
                    <path
                      d="M9.75 12C9.75 12.4142 9.41421 12.75 9 12.75C8.58579 12.75 8.25 12.4142 8.25 12C8.25 11.5858 8.58579 11.25 9 11.25C9.41421 11.25 9.75 11.5858 9.75 12Z"
                      fill="#E04F5F" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M9 0.9375C8.47156 0.9375 7.98889 1.08269 7.46144 1.32777C6.95106 1.56492 6.36029 1.91478 5.62093 2.35264L5.05611 2.68712C4.3165 3.12512 3.72578 3.47493 3.27057 3.80958C2.79986 4.15563 2.43883 4.50983 2.17751 4.97409C1.91661 5.43761 1.79881 5.93321 1.74229 6.5213C1.68749 7.09154 1.68749 7.78987 1.6875 8.66698V9.33301C1.68749 10.2101 1.68749 10.9085 1.74229 11.4787C1.79881 12.0668 1.91661 12.5624 2.17751 13.0259C2.43883 13.4902 2.79986 13.8444 3.27057 14.1904C3.72579 14.5251 4.3165 14.8749 5.05611 15.3129L5.62095 15.6474C6.36028 16.0852 6.95108 16.4351 7.46144 16.6722C7.98889 16.9173 8.47156 17.0625 9 17.0625C9.52844 17.0625 10.0111 16.9173 10.5386 16.6722C11.0489 16.4351 11.6397 16.0852 12.3791 15.6474L12.9439 15.3129C13.6835 14.8749 14.2742 14.5251 14.7294 14.1904C15.2001 13.8444 15.5612 13.4902 15.8225 13.0259C16.0834 12.5624 16.2012 12.0668 16.2577 11.4787C16.3125 10.9085 16.3125 10.2101 16.3125 9.33304V8.66702C16.3125 7.78992 16.3125 7.09154 16.2577 6.5213C16.2012 5.93321 16.0834 5.43761 15.8225 4.97409C15.5612 4.50983 15.2001 4.15563 14.7294 3.80958C14.2742 3.47493 13.6835 3.12512 12.9439 2.68714L12.3791 2.35264C11.6397 1.91478 11.0489 1.56492 10.5386 1.32777C10.0111 1.08269 9.52844 0.9375 9 0.9375ZM6.16893 3.33558C6.93929 2.87938 7.48204 2.55871 7.93549 2.34802C8.37765 2.14257 8.69306 2.0625 9 2.0625C9.30694 2.0625 9.62235 2.14257 10.0645 2.34802C10.518 2.55871 11.0607 2.87938 11.8311 3.33558L12.3457 3.64034C13.1159 4.09648 13.6582 4.41836 14.0631 4.716C14.4576 5.006 14.6858 5.2481 14.8421 5.52591C14.9989 5.80446 15.09 6.13043 15.1379 6.62892C15.1869 7.13913 15.1875 7.78352 15.1875 8.69524V9.30476C15.1875 10.2165 15.1869 10.8609 15.1379 11.3711C15.09 11.8696 14.9989 12.1955 14.8421 12.4741C14.6858 12.7519 14.4576 12.994 14.0631 13.284C13.6582 13.5816 13.1159 13.9035 12.3457 14.3597L11.8311 14.6644C11.0607 15.1206 10.518 15.4413 10.0645 15.652C9.62235 15.8574 9.30694 15.9375 9 15.9375C8.69306 15.9375 8.37765 15.8574 7.93549 15.652C7.48204 15.4413 6.93929 15.1206 6.16893 14.6644L5.65431 14.3597C4.88407 13.9035 4.3418 13.5816 3.93693 13.284C3.54245 12.994 3.31425 12.7519 3.15788 12.4741C3.00109 12.1955 2.91004 11.8696 2.86213 11.3711C2.8131 10.8609 2.8125 10.2165 2.8125 9.30476V8.69524C2.8125 7.78352 2.8131 7.13913 2.86213 6.62892C2.91004 6.13042 3.00109 5.80446 3.15788 5.52591C3.31425 5.2481 3.54245 5.006 3.93693 4.716C4.3418 4.41836 4.88407 4.09648 5.65431 3.64034L6.16893 3.33558Z"
                      fill="#E04F5F" />
                  </svg>

                  Cancel
                </a>
              </li>
              }
              <!-- Confirm Action - Only for Probation -->
              @if (contract.status === 'Probation') {
              <li>
                <a (click)="openCancelModal(contract)" class=" dropdown-item confirm-item" title="Cancel Contract">
                  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M11.0852 6.58525C11.3049 6.36558 11.3049 6.00942 11.0852 5.78975C10.8656 5.57008 10.5094 5.57008 10.2898 5.78975L6.9375 9.142L5.83525 8.03975C5.61558 7.82008 5.25942 7.82008 5.03975 8.03975C4.82008 8.25942 4.82008 8.61558 5.03975 8.83525L6.53975 10.3352C6.75942 10.5549 7.11558 10.5549 7.33525 10.3352L11.0852 6.58525Z"
                      fill="#4CA883" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M8.0625 0C3.6097 0 0 3.6097 0 8.0625C0 12.5153 3.6097 16.125 8.0625 16.125C12.5153 16.125 16.125 12.5153 16.125 8.0625C16.125 3.6097 12.5153 0 8.0625 0ZM1.125 8.0625C1.125 4.23102 4.23102 1.125 8.0625 1.125C11.894 1.125 15 4.23102 15 8.0625C15 11.894 11.894 15 8.0625 15C4.23102 15 1.125 11.894 1.125 8.0625Z"
                      fill="#4CA883" />
                  </svg>
                  Confirm
                </a>
              </li>
              }
              <!-- Resign Action -->
              @if (contract.status === 'Active' || contract.status === 'Probation') {<li>
                <a class="dropdown-item resign-item" (click)="openResignModal(contract)">
                  <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                                    <polyline points="16,17 21,12 16,7" />
                                                    <line x1="21" y1="12" x2="9" y2="12" />
                                                  </svg> -->

                  <svg class="icon-color" width="18" height="18" viewBox="0 0 18 18" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_2905_19237)">
                      <path
                        d="M11.209 0.9375C10.1833 0.937485 9.35657 0.937473 8.70635 1.02489C8.03127 1.11566 7.46286 1.30983 7.01142 1.76126C6.61773 2.15496 6.4188 2.63877 6.31437 3.20727C6.2129 3.75969 6.19349 4.43572 6.18897 5.24687C6.18724 5.55753 6.43768 5.81076 6.74833 5.81249C7.05899 5.81422 7.31223 5.56379 7.31396 5.25313C7.31852 4.43301 7.33982 3.8517 7.42086 3.41051C7.49895 2.9854 7.62433 2.73935 7.80692 2.55676C8.01449 2.34919 8.30592 2.21385 8.85625 2.13986C9.42276 2.0637 10.1736 2.0625 11.2502 2.0625H12.0002C13.0767 2.0625 13.8276 2.0637 14.3941 2.13986C14.9444 2.21385 15.2358 2.34919 15.4434 2.55676C15.651 2.76433 15.7863 3.05576 15.8603 3.60609C15.9365 4.1726 15.9377 4.92344 15.9377 6V12C15.9377 13.0766 15.9365 13.8274 15.8603 14.3939C15.7863 14.9442 15.651 15.2357 15.4434 15.4432C15.2358 15.6508 14.9444 15.7862 14.3941 15.8601C13.8276 15.9363 13.0767 15.9375 12.0002 15.9375H11.2502C10.1736 15.9375 9.42276 15.9363 8.85625 15.8601C8.30592 15.7862 8.01449 15.6508 7.80692 15.4432C7.62433 15.2607 7.49895 15.0146 7.42086 14.5895C7.33982 14.1483 7.31852 13.567 7.31396 12.7469C7.31223 12.4362 7.05899 12.1858 6.74833 12.1875C6.43768 12.1892 6.18724 12.4425 6.18897 12.7531C6.19349 13.5643 6.2129 14.2403 6.31437 14.7927C6.4188 15.3612 6.61773 15.845 7.01142 16.2387C7.46286 16.6902 8.03127 16.8843 8.70635 16.9751C9.35657 17.0625 10.1833 17.0625 11.209 17.0625H12.0413C13.067 17.0625 13.8937 17.0625 14.544 16.9751C15.2191 16.8843 15.7875 16.6902 16.2389 16.2387C16.6903 15.7873 16.8845 15.2189 16.9753 14.5438C17.0627 13.8936 17.0627 13.0668 17.0627 12.0412V5.95885C17.0627 4.93316 17.0627 4.10641 16.9753 3.45619C16.8845 2.78111 16.6903 2.2127 16.2389 1.76126C15.7875 1.30983 15.2191 1.11566 14.544 1.02489C13.8938 0.937473 13.067 0.937485 12.0413 0.9375H11.209Z"
                        fill="#E04F5F" />
                      <path
                        d="M11.25 8.4375C11.5607 8.4375 11.8125 8.68934 11.8125 9C11.8125 9.31066 11.5607 9.5625 11.25 9.5625H3.02058L4.49107 10.8229C4.72694 11.0251 4.75426 11.3802 4.55208 11.6161C4.34991 11.8519 3.9948 11.8793 3.75893 11.6771L1.13393 9.42708C1.00925 9.32022 0.9375 9.16421 0.9375 9C0.9375 8.83579 1.00925 8.67978 1.13393 8.57292L3.75893 6.32292C3.9948 6.12074 4.34991 6.14806 4.55208 6.38393C4.75426 6.6198 4.72694 6.97491 4.49107 7.17708L3.02058 8.4375H11.25Z"
                        fill="#E04F5F" />
                    </g>
                    <defs>
                      <clipPath id="clip0_2905_19237">
                        <rect width="18" height="18" rx="5" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>

                  Resign
                </a>
              </li>}
            </ul>
          </div>
        </div>
        }

        <!-- View Action - Only for Terminated and Resigned -->
        @if (contract.status === 'Terminate') {
        <a (click)="viewTerminatedContract(contract)" class="view-btn" title="View Termination Details">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
            <circle cx="12" cy="12" r="3" />
          </svg>
          View
        </a>
        }

        @if (contract.status === 'Resign') {
        <a (click)="viewResignedContract(contract)" class="view-btn" title="View Resignation Details">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
            <circle cx="12" cy="12" r="3" />
          </svg>
          View
        </a>
        }
      </div>
    </td>
  </ng-template>

  <!-- Empty Template -->
  <ng-template #emptyTemplate>
    <tr>
      <td colspan="7" class="text-center py-4">
        <div class="no-data">
          No contracts found
        </div>
      </td>
    </tr>
  </ng-template>

  <app-table [data]="contractsData" [totalItems]="totalItems" [currentPage]="currentPage" [itemsPerPage]="itemsPerPage"
    [isLoading]="isLoading" [columnsCount]="7" [headerTemplate]="headerTemplate" [rowTemplate]="rowTemplate"
    [emptyTemplate]="emptyTemplate" (pageChange)="onPageChange($event)"
    (itemsPerPageChange)="onItemsPerPageChange($event)">
  </app-table>
</div>

<!-- Cancel Confirmation Modal -->
<app-contract-cancel-modal [isOpen]="isCancelModalOpen" [isLoading]="isLoading" [contract]="selectedContract"
  (onClose)="closeCancelModal()" (onCancel)="onContractCancel($event)">
</app-contract-cancel-modal>

<!-- Contract History Modal -->
<app-contract-history-modal [isOpen]="isHistoryModalOpen" [contract]="selectedContract" [historyData]="contractHistory"
  [isLoading]="isLoadingHistory" (onClose)="closeHistoryModal()">
</app-contract-history-modal>


<!-- Terminate Contract Modal -->
<app-contract-terminate-modal [isOpen]="isTerminateModalOpen" [contract]="selectedContract"
  (onClose)="closeTerminateModal()" (onTerminate)="onContractTerminate($event)">
</app-contract-terminate-modal>

<!-- Resign Contract Modal -->
@if (selectedContract) {
<app-contract-resign-modal [isOpen]="isResignModalOpen" [contract]="selectedContract" (onClose)="closeResignModal()"
  (onResign)="onContractResign($event)">
</app-contract-resign-modal>
}

<!-- Terminated Contract View Modal -->
<app-contract-terminated-view-modal [isOpen]="isTerminatedViewModalOpen" [contract]="selectedContract"
  [terminationData]="contractTerminationData" (onClose)="closeTerminatedViewModal()">
</app-contract-terminated-view-modal>

<!-- Resigned Contract View Modal -->
<app-contract-resigned-view-modal [isOpen]="isResignedViewModalOpen" [contract]="selectedContract"
  [resignationData]="contractResignationData" (onClose)="closeResignedViewModal()">
</app-contract-resigned-view-modal>

<!-- <app-contract-form-modal #addForm [isOpen]="isOpen" [contract]="editedContract" [employee]="employee"
                                  [isEditMode]="isEditMode" [isLoading]="isLoading" (onSave)="onContractSave($event)" (onClose)="closeAddModal()">
                                </app-contract-form-modal> -->

<app-popup [title]="modalTitle" [paragraph1]="modalMessage" [paragraph2]="modalMessage2" [isOpen]="isWarningModalOpen"
  (close)="closeWarningModal()">

  <button modal-btn-right class="btn btn-lg btn-outline-dark border-1 w-100" (click)="closeWarningModal()">
    Close
  </button>
</app-popup>

<!-- Delete contract confirmation -->
<app-popup title="Delete Contract" paragraph1="Are you sure you want to delete this expired contract?"
  [paragraph2]="selectedContract ? 'Contract: ' + (selectedContract.contractNumber ?? ('#' + selectedContract.id)) : ''"
  [isOpen]="isDeleteModalOpen" (close)="closeDeleteModal()">
  <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDeleteContract()" [disabled]="isDeleting">
    @if (isDeleting) {
    <span class="spinner-grow spinner-grow-sm me-2" role="status" aria-hidden="true"></span>
    }
    Delete
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeleteModal()">
    Cancel
  </button>
</app-popup>