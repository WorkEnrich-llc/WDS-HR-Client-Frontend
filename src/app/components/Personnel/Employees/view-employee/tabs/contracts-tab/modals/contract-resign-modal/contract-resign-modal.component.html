<!-- Resign Contract Modal -->
<app-overlay-filter-box [title]="'Resign Contract'" [customWidth]="'500px'" [isOverlayVisible]="isOpen"
  (onClose)="closeModal()">
  <div modal-content>
    <div class="warning-message">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
        <path d="M12 9v4" />
        <path d="m12 17 .01 0" />
      </svg>
      Any upcoming contracts for this employee will be cancelled automatically.
    </div>

    <form [formGroup]="resignForm" class="resign-form">
      <div class="form-group">
        <label for="resignDate" class="form-label">Resign date</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="date" id="resignDate" class="form-control custom-date-input" formControlName="resignDate"
            [min]="minResignDate" [max]="maxResignDate"
            [class.is-invalid]="resignForm.get('resignDate')?.invalid && resignForm.get('resignDate')?.touched">
          <svg [class.svg-error-adjust]="resignForm.get('resignDate')?.invalid && resignForm.get('resignDate')?.touched"
            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <path stroke-linecap="round"
                d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
              <circle cx="18" cy="18" r="3" />
              <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
            </g>
          </svg>

          @if(resignForm.get('resignDate')?.touched){
          <div class="invalid-feedback">
            @if(resignForm.get('resignDate')?.hasError('required')){
            <span> Resign date is required </span>
            }
            @if(resignForm.get('resignDate')?.hasError('minDate')){
            <span> Resign Date cannot after {{minResignDate}}</span>
            }
            @if(resignForm.get('resignDate')?.hasError('maxDate')){
            <span>Date cannot be after contract end date {{maxResignDate}}</span>
            }
          </div>
          }

        </div>
      </div>

      <!-- <div class="form-group">
        <label for="noticePeriod" class="form-label">Notice Period</label>
        <div class="notice-period-container">
          <input 
            type="number" 
            id="noticePeriod"
            class="form-control notice-input" 
            formControlName="noticePeriod"
            min="0"
            [class.is-invalid]="resignForm.get('noticePeriod')?.invalid && resignForm.get('noticePeriod')?.touched">
          <span class="notice-label">Days</span>
        </div>
        <div class="invalid-feedback" *ngIf="resignForm.get('noticePeriod')?.invalid && resignForm.get('noticePeriod')?.touched">
          Notice period is required
        </div>
      </div> -->

      <div class="form-group">
        <label for="lastDay" class="form-label">Last day</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="date" id="lastDay" class="form-control custom-date-input" formControlName="lastDay"
            [class.is-invalid]="resignForm.get('lastDay')?.invalid && resignForm.get('lastDay')?.touched"
            [min]="minLastDay" [max]="maxLastDay">
          <svg [class.svg-error-adjust]="resignForm.get('lastDay')?.invalid && resignForm.get('lastDay')?.touched"
            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <path stroke-linecap="round"
                d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
              <circle cx="18" cy="18" r="3" />
              <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
            </g>
          </svg>

          @if(resignForm.get('lastDay')?.touched){
          <div class="invalid-feedback">
            @if(resignForm.get('lastDay')?.hasError('required')){
            <span>Last day is required</span>
            }
            @if(resignForm.get('lastDay')?.hasError('minDate')){
            <span> Date cannot be before Resign Date {{ minLastDay }} </span>
            }
            @if(resignForm.get('lastDay')?.hasError('maxDate')){
            <span> Date cannot be after contract end date {{ maxLastDay }}</span>
            }
          </div>
          }

        </div>

      </div>

      <div class="form-group">
        <label for="reason" class="form-label">Reason</label>
        <textarea id="reason" class="form-control" rows="3" placeholder="Why did this employee resign?"
          formControlName="reason"
          [class.is-invalid]="resignForm.get('reason')?.invalid && resignForm.get('reason')?.touched">
        </textarea>
        @if(resignForm.get('reason')?.hasError('required') && resignForm.get('reason')?.touched){
        <div class="invalid-feedback">Reason is required</div>
        }

        @if (resignForm.get('reason')?.hasError('whitespace') && !resignForm.get('reason')?.hasError('required'))
        {
        <div class="invalid-feedback"> Reason cannot be only spaces.</div>
        }
      </div>
    </form>

    <div class="modal-footer">
      <button type="button" class="btn btn-resign" (click)="confirmResign()" [disabled]="resignForm.invalid">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <polyline points="16,17 21,12 16,7" />
          <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
        Resign
      </button>
      <button type="button" class="btn btn-secondary" (click)="closeModal()">
        Close
      </button>
    </div>
  </div>
</app-overlay-filter-box>