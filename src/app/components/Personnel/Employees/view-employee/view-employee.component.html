<!-- page header inactive account -->
@if (employee && !isEmployeeActive) {
<app-page-header [breadcrumbs]="[
    { label: 'Personnel', link: '/dashboard' },
    { label: 'Employees', link: '/employees' },
    { label: 'View ' + employee.contact_info.name }
  ]" [title]="'View ' + employee.contact_info.name" [create]="(employee.created_at | date : 'dd/MM/yyyy') || ''"
  [update]="(employee.updated_at | date : 'dd/MM/yyyy') || ''">
  @if (hasEmployeePermission('update')) {
  <button class="btn btn-lg btn-primary" [routerLink]="['/employees/edit-employee', employee.id]">
    <!-- SVG and Edit -->
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round"
          d="M22 10.5V12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2h1.5" />
        <path
          d="m16.652 3.455l.649-.649A2.753 2.753 0 0 1 21.194 6.7l-.65.649m-3.892-3.893s.081 1.379 1.298 2.595c1.216 1.217 2.595 1.298 2.595 1.298m-3.893-3.893L10.687 9.42c-.404.404-.606.606-.78.829q-.308.395-.524.848c-.121.255-.211.526-.392 1.068L8.412 13.9m12.133-6.552l-5.965 5.965c-.404.404-.606.606-.829.78a4.6 4.6 0 0 1-.848.524c-.255.121-.526.211-1.068.392l-1.735.579m0 0l-1.123.374a.742.742 0 0 1-.939-.94l.374-1.122m1.688 1.688L8.412 13.9" />
      </g>
    </svg>
    <span>Edit</span>
  </button>
  }
</app-page-header>
}

<!-- page header active account -->
@if (employee && isEmployeeActive) {
<app-page-header [breadcrumbs]="[
    { label: 'Personnel', link: '/dashboard' },
    { label: 'Employees', link: '/employees' },
    { label: 'View ' + employee.contact_info.name }
  ]" [title]="'View ' + employee.contact_info.name" [create]="(employee.created_at | date : 'dd/MM/yyyy') || ''"
  [update]="(employee.updated_at | date : 'dd/MM/yyyy') || ''">
  @if (hasEmployeePermission('update')) {
  <button class="btn btn-lg btn-primary" [routerLink]="['/employees/edit-employee', employee.id]">
    <!-- SVG and Edit -->
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round"
          d="M22 10.5V12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2h1.5" />
        <path
          d="m16.652 3.455l.649-.649A2.753 2.753 0 0 1 21.194 6.7l-.65.649m-3.892-3.893s.081 1.379 1.298 2.595c1.216 1.217 2.595 1.298 2.595 1.298m-3.893-3.893L10.687 9.42c-.404.404-.606.606-.78.829q-.308.395-.524.848c-.121.255-.211.526-.392 1.068L8.412 13.9m12.133-6.552l-5.965 5.965c-.404.404-.606.606-.829.78a4.6 4.6 0 0 1-.848.524c-.255.121-.526.211-1.068.392l-1.735.579m0 0l-1.123.374a.742.742 0 0 1-.939-.94l.374-1.122m1.688 1.688L8.412 13.9" />
      </g>
    </svg>
    <span>Edit</span>
  </button>
  }
</app-page-header>
}

<div class="content-hug d-flex flex-column gap-4">
  <!-- Loading state -->
  @if (loading) {
  <div class="d-flex justify-content-center align-items-center" style="min-height: 400px">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  }

  <!-- Error state -->
  @if (!loading && !employee) {
  <div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Employee Not Found</h4>
    <p>
      The requested employee could not be found or an error occurred while
      loading the data.
    </p>
  </div>
  }

  <!-- Content when employee data is loaded -->
  @if (!loading && employee) {

  <!-- 3 cards -->
  <div class="d-flex align-items-stretch gap-4">
    <div class="col-12 col-lg-6 col-xl-4">
      <div class="content-box contact-info-card d-flex flex-column gap-3 h-100">
        <div class="d-flex align-items-center justify-content-between">
          <h2>Contact Info</h2>
          @if (hasAdditionalContactInfo()) {
          <button type="button" class="btn-toggle-expand" (click)="toggleContactInfo()"
            [attr.aria-expanded]="contactInfoExpanded"
            [attr.aria-label]="contactInfoExpanded ? 'Show less contact information' : 'Show more contact information'">
            <span>{{ contactInfoExpanded ? 'Show Less' : 'Show More' }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
              [class.rotated]="contactInfoExpanded">
              <path d="M7 10l5 5l5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
          }
        </div>

        <!-- Always visible fields -->
        <div class="info">
          <h6>ID</h6>
          <span>{{ employee.id || "N/A" }}</span>
        </div>
        <div class="info">
          <h6>Full Name (English)</h6>
          <span>{{ employee.contact_info.name || "N/A" }}</span>
        </div>
        @if (employee.contact_info.name_arabic) {
        <div class="info">
          <h6>Full Name (Arabic)</h6>
          <span>{{ employee.contact_info.name_arabic || "N/A" }}</span>
        </div>
        }
        <div class="info">
          <h6>Phone Number</h6>
          <span>{{ employee.contact_info.mobile.country.phone_prefix || ""
            }}{{ employee.contact_info.mobile.number || "N/A" }}</span>
        </div>
        <div class="info">
          <h6>Business Email</h6>
          <span>{{ employee.contact_info.email || "N/A" }}</span>
        </div>
        <div class="info">
          <h6>Date of Birth</h6>
          <span>{{
            (employee.contact_info.date_of_birth | date : "dd/MM/yyyy") || "N/A"
            }}</span>
        </div>
        <div class="info">
          <h6>Address</h6>
          <span>{{ employee.contact_info.address || "N/A" }}</span>
        </div>
        <div class="info">
          <h6>Marital Status</h6>
          <span>{{ employee.contact_info.marital_status.name }}</span>
        </div>

        <!-- Collapsible fields (Custom Fields only) -->
        <div class="contact-info-collapsible" [class.expanded]="contactInfoExpanded">
          @for(item of customFieldValues; track item.id) {
          @if(item.custom_field.pinned === true && item.value.value) {
          <div class="info">
            <h6 [title]="item.custom_field.input_option.label">{{
              item.custom_field.input_option.label }}</h6>
            <span [title]="item.value.value">{{ item.value.value }}</span>
          </div>
          }
          }
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6 col-xl-4">
      <div class="content-box d-flex flex-column gap-3 h-100">
        <div class="d-flex align-items-center justify-content-between">
          <h2>Job Info</h2>
          @if (employeeData.employeeStatus ==='New Employee') {
          <span class="badge-newemployee">
            <!-- SVG and New Employee -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path
                  d="M3 12c0 3.771 0 7.657 1.318 8.828C5.636 22 7.758 22 12 22s6.364 0 7.682-1.172S21 15.771 21 12" />
                <path
                  d="m14.66 14.202l6.008-1.802c.595-.179.893-.268 1.082-.482a1 1 0 0 0 .1-.134c.15-.243.15-.553.15-1.175c0-2.45 0-3.675-.673-4.502a3 3 0 0 0-.434-.434C20.066 5 18.841 5 16.391 5H7.61c-2.45 0-3.675 0-4.502.673q-.24.195-.434.434C2 6.934 2 8.159 2 10.609c0 .622 0 .932.15 1.175q.045.07.1.134c.19.214.487.303 1.082.482l6.008 1.802M6.5 5c.823-.02 1.66-.545 1.94-1.32l.035-.103L8.5 3.5c.042-.127.064-.19.086-.246a2 2 0 0 1 1.735-1.25C10.38 2 10.448 2 10.58 2h2.838c.133 0 .2 0 .26.004a2 2 0 0 1 1.735 1.25c.023.056.044.12.086.246l.026.077c.018.053.026.08.035.103c.28.775 1.116 1.3 1.939 1.32" />
                <path stroke-linecap="round"
                  d="M14 12.5h-4a.5.5 0 0 0-.5.5v2.162a.5.5 0 0 0 .314.464l.7.28a4 4 0 0 0 2.972 0l.7-.28a.5.5 0 0 0 .314-.464V13a.5.5 0 0 0-.5-.5Z" />
              </g>
            </svg>
            <span>New Employee</span>
          </span>
          } @if (employeeData.employeeStatus ==='Employed') {
          <span class="badge-success">
            <!-- SVG and Employed -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path
                  d="M3 12c0 3.771 0 7.657 1.318 8.828C5.636 22 7.758 22 12 22s6.364 0 7.682-1.172S21 15.771 21 12" />
                <path
                  d="m14.66 14.202l6.008-1.802c.595-.179.893-.268 1.082-.482a1 1 0 0 0 .1-.134c.15-.243.15-.553.15-1.175c0-2.45 0-3.675-.673-4.502a3 3 0 0 0-.434-.434C20.066 5 18.841 5 16.391 5H7.61c-2.45 0-3.675 0-4.502.673q-.24.195-.434.434C2 6.934 2 8.159 2 10.609c0 .622 0 .932.15 1.175q.045.07.1.134c.19.214.487.303 1.082.482l6.008 1.802M6.5 5c.823-.02 1.66-.545 1.94-1.32l.035-.103L8.5 3.5c.042-.127.064-.19.086-.246a2 2 0 0 1 1.735-1.25C10.38 2 10.448 2 10.58 2h2.838c.133 0 .2 0 .26.004a2 2 0 0 1 1.735 1.25c.023.056.044.12.086.246l.026.077c.018.053.026.08.035.103c.28.775 1.116 1.3 1.939 1.32" />
                <path stroke-linecap="round"
                  d="M14 12.5h-4a.5.5 0 0 0-.5.5v2.162a.5.5 0 0 0 .314.464l.7.28a4 4 0 0 0 2.972 0l.7-.28a.5.5 0 0 0 .314-.464V13a.5.5 0 0 0-.5-.5Z" />
              </g>
            </svg>
            <span>Employed</span>
          </span>
          }
        </div>
        @if (employee.job_info.job_title.name) {
        <div class="info">
          <h6>Job Title</h6>
          <span>{{ employee.job_info.job_title.name || "N/A" }}</span>
        </div>
        }
        @if(employee.job_info.employment_type.name){
        <div class="info">
          <h6>Employment Type</h6>
          <span>{{ employee.job_info.employment_type.name || "N/A" }}</span>
        </div>
        }
        @if(employee.job_info.work_mode.name){
        <div class="info">
          <h6>Work Mode</h6>
          <span>{{ employee.job_info.work_mode.name || "N/A" }}</span>
        </div>
        }
        @if(employee.job_info.section?.name){
        <div class="info">
          <h6>Section</h6>
          <span>{{ employee.job_info.section?.name || "Not assigned" }}</span>
        </div>
        }
        @if(employee.job_info.department.name){
        <div class="info">
          <h6>Department</h6>
          <span>{{ employee.job_info.department.name || "Not assigned" }}</span>
        </div>
        }
        @if(employee.job_info.branch.name){
        <div class="info">
          <h6>Branch</h6>
          <span>{{ employee.job_info.branch.name || "Not assigned" }}</span>
        </div>
        }

        <!-- <div class="info">
    <h6>Work Schedule</h6>
    <span>{{ employee.job_info.work_schedule.name || 'N/A' }}</span>
    </div> -->
        <!-- <div class="info">
    <h6>Contract Start Date</h6>
    <span>{{ (employee.job_info.start_contract | date:'dd/MM/yyyy') || 'N/A' }}</span>
    </div> -->

        @if (employee.job_info.end_contract) {
        <div class="info">
          <h6>Contract End Date</h6>
          <span>{{
            (employee.job_info.end_contract | date : "dd/MM/yyyy") || "N/A"
            }}</span>
        </div>
        }



        <!-- <div class="info">
    <h6>Contract Type</h6>
    <span>{{ employee.job_info.contract_type.name || 'N/A' }}</span>
    </div> -->
        <!-- <div class="info">
    <h6>Salary</h6>
    <span>{{ employee.job_info.salary || 'N/A' }} EGP</span>
    </div> -->
        <!-- <div class="info" *ngIf="employee.job_info.days_on_site">
    <h6>Days On Site</h6>
    <span>{{ employee.job_info.days_on_site }} days/week</span>
    </div> -->
        @if (employee.job_info.direct_manager?.name) {
        <div class="d-flex align-items-center justify-content-between">
          <div class="info">
            <h6>Direct Manager</h6>
            <span>{{ employee.job_info.direct_manager?.name || "--" }}</span>
          </div>
          <a class="view-btn h-100 d-flex align-items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
                <path stroke-linejoin="round" d="m13 11l9-9m0 0h-5.344M22 2v5.344" />
                <path
                  d="M22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2" />
              </g>
            </svg>
          </a>
        </div>
        }
      </div>
    </div>



    <div class="col-12 col-lg-6 col-xl-4">
      <div class="content-box d-flex flex-column gap-3 h-100">
        <div class="d-flex align-items-center justify-content-between">
          <h2>Account Info</h2>
          @if (isEmployeeActive) {
          <span class="badge-success">
            <!-- SVG and Active -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
              </g>
            </svg>
            <span>Active</span>
          </span>
          } @if (isEmployeePending) {
          <span class="badge-warning">
            <!-- SVG and Pending -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" d="M12 7v5l3 3" />
              </g>
            </svg>
            <span>Pending</span>
          </span>
          } @if (isEmployeeDisabled) {
          <span class="badge-danger">
            <!-- SVG and Disabled -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
              </g>
            </svg>
            <span>Deactivated</span>
          </span>
          } @if (isEmployeeInactive) {
          <span class="badge-gray">
            <!-- SVG and Inactive -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" d="m18.5 5.5l-13 13" />
                <circle cx="12" cy="12" r="10" />
              </g>
            </svg>
            <span>Inactive</span>
          </span>
          }
        </div>
        <div class="info">
          <h6>Company Email</h6>
          <span>{{ employee.contact_info.email || "N/A" }}</span>
        </div>
        <div class="info">
          <h6>Created Date</h6>
          <!-- <h6>Join Date</h6> -->
          <span>
            {{
            (employee.job_info.start_contract | date : "dd/MM/yyyy") || "N/A"
            }}
          </span>
        </div>
        @if (employee.device) {
        <!-- <div class="device-card">
          <div class="device-card__header">
            <div>
              <h3>Last Known Device</h3>
              <p class="device-card__subtitle">
                Last seen {{ formatDeviceDate(employee.device.last_seen) }}
              </p>
            </div>
            <span class="badge-success" [ngClass]="employee.device.is_main ? 'badge-success' : 'badge-gray'">
              {{ employee.device.is_main ? 'Primary Device' : 'Secondary Device' }}
            </span>
          </div>
          <div class="device-card__grid">
            <div>
              <p class="device-section__title">Device</p>
              <div class="device-section__grid">
                <div class="device-card__item">
                  <span class="device-card__label">Type</span>
                  <span class="device-card__value text-capitalize">{{ employee.device.device_type || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Brand</span>
                  <span class="device-card__value">{{ employee.device.device_family || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Model</span>
                  <span class="device-card__value">{{ employee.device.device_model || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Language</span>
                  <span class="device-card__value text-uppercase">{{ employee.device.device_ln || "—" }}</span>
                </div>
              </div>
            </div>

            <div>
              <p class="device-section__title">Platform</p>
              <div class="device-section__grid">
                <div class="device-card__item">
                  <span class="device-card__label">OS</span>
                  <span class="device-card__value">{{ employee.device.os_device || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">OS Version</span>
                  <span class="device-card__value">{{ employee.device.os_version || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Browser</span>
                  <span class="device-card__value">{{ employee.device.browser || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Browser Version</span>
                  <span class="device-card__value">{{ employee.device.browser_version || "—" }}</span>
                </div>
              </div>
            </div>

            <div>
              <p class="device-section__title">Network & Activity</p>
              <div class="device-section__grid">
                <div class="device-card__item">
                  <span class="device-card__label">IP Address</span>
                  <span class="device-card__value">{{ employee.device.ip_address || "—" }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Registered</span>
                  <span class="device-card__value">{{ formatDeviceDate(employee.device.created_at) }}</span>
                </div>
                <div class="device-card__item">
                  <span class="device-card__label">Last Update</span>
                  <span class="device-card__value">{{ formatDeviceDate(employee.device.updated_at) }}</span>
                </div>
                @if (employee.device.fcm_token) {
                <div class="device-card__item device-card__item--wide">
                  <span class="device-card__label">Push Token</span>
                  <span class="device-card__value text-break">{{ employee.device.fcm_token }}</span>
                </div>
                }
              </div>
            </div>
          </div>
        </div> -->

        <div class="device-card device-info-card d-flex flex-column gap-0">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <h2>Last Known Device</h2>
              <small class="mb-0 text-muted">Seen: {{ formatDeviceDate(employee.device.last_seen) }}</small>
            </div>
            <div class="d-flex align-items-center gap-2">
              <span class="badge-success" [ngClass]="employee.device.is_main ? 'badge-newjoiner' : 'badge-gray'">
                {{ employee.device.is_main ? 'Primary Device' : 'Secondary Device' }}
              </span>
              <button type="button" class="btn-toggle-expand-arrow" (click)="toggleDeviceInfo()"
                [attr.aria-expanded]="deviceInfoExpanded"
                [attr.aria-label]="deviceInfoExpanded ? 'Hide device information' : 'Show device information'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  [class.rotated]="deviceInfoExpanded">
                  <path d="M7 10l5 5l5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>
            </div>
          </div>

          <!-- All fields collapsible - hidden by default -->
          <div class="device-info-collapsible" [class.expanded]="deviceInfoExpanded">
            <div class="info">
              <h6>TYPE</h6>
              <span class="text-capitalize">{{ employee.device.device_type || "—" }}</span>
            </div>
            <div class="info">
              <h6>BRAND</h6>
              <span>{{ employee.device.device_family || "—" }}</span>
            </div>
            <div class="info">
              <h6>MODEL</h6>
              <span>{{ employee.device.device_model || "—" }}</span>
            </div>
            <div class="info">
              <h6>LANGUAGE</h6>
              <span class="text-uppercase">{{ employee.device.device_ln || "—" }}</span>
            </div>
          </div>
        </div>
        }

        <div class="mt-auto d-flex flex-column gap-2">
          @if (employee.device) {
          <button class="btn btn-lg btn-outline-primary w-100" (click)="openClearSession()"
            [disabled]="clearSessionLoading">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8 12h8m-4-4l4 4l-4 4" />
                <path d="M12 6v-.5C12 3.015 9.985 1 7.5 1H7a6 6 0 0 0-6 6v4a6 6 0 0 0 6 6h.5" />
                <path d="M12 18v.5c0 2.485 2.015 4.5 4.5 4.5h.5a6 6 0 0 0 6-6v-4a6 6 0 0 0-6-6h-.5" />
              </g>
            </svg>
            <span>Clear Session</span>
          </button>
          }

          @if (!isEmployeeActive) {
          <!-- <div class="info">
        <h6>Password</h6>
        <span>**********</span>
      </div> -->
          @if (isEmployeeDisabled) {
          <button class="btn btn-lg btn-success w-100 mt-auto" (click)="openActivate()">
            <!-- SVG and Activate -->
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
            </svg>
            <span>Activate</span>
          </button>
          } @else if (isEmployeeInactive) {
          <button class="btn btn-lg btn-primary w-100 mt-auto" (click)="resendActiveLink()" [disabled]="resendLoading">
            <!-- SVG and Send in Email -->
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path
                  d="M2 12c0-3.771 0-5.657 1.172-6.828S6.229 4 10 4h4c3.771 0 5.657 0 6.828 1.172S22 8.229 22 12s0 5.657-1.172 6.828S17.771 20 14 20h-4c-3.771 0-5.657 0-6.828-1.172S2 15.771 2 12Z" />
                <path stroke-linecap="round"
                  d="m6 8l2.159 1.8c1.837 1.53 2.755 2.295 3.841 2.295s2.005-.765 3.841-2.296L18 8" />
              </g>
            </svg>
            <span>Send in Email</span>
          </button>
          } @else {
          <button class="btn btn-lg btn-primary w-100 mt-auto" (click)="resendActiveLink()" [disabled]="resendLoading">
            <!-- SVG and Send Again -->
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="1.5">
                <path
                  d="M2 12c0-3.771 0-5.657 1.172-6.828S6.229 4 10 4h4c3.771 0 5.657 0 6.828 1.172S22 8.229 22 12s0 5.657-1.172 6.828S17.771 20 14 20h-4c-3.771 0-5.657 0-6.828-1.172S2 15.771 2 12Z" />
                <path stroke-linecap="round"
                  d="m6 8l2.159 1.8c1.837 1.53 2.755 2.295 3.841 2.295s2.005-.765 3.841-2.296L18 8" />
              </g>
            </svg>
            <span>Send Again</span>
          </button>
          }
          } @else {
          <button class="btn btn-lg btn-outline-danger w-100" (click)="openDeactivate()">
            <!-- SVG and Deactivate -->
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
            </svg>
            <span>Deactivate</span>
          </button>
          <button class="btn btn-lg btn-primary w-100 mt-auto" (click)="resetPassword()" [disabled]="resetLoading">
            <!-- SVG and Reset Password -->
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="m18.364 8.05l-.707-.707a8 8 0 1 0 2.28 4.658m-1.573-3.95h-4.243m4.243 0V3.807" />
            </svg>
            <span>Reset Password</span>
          </button>
          }
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <div class="content-box d-flex flex-column gap-3 w-100">
        <!-- Tab Navigation -->
        <ul class="nav d-flex align-items-center nav-tabs bg-white px-3">
          <li class="nav-item" [ngClass]="{
              active: currentTab === 'attendance',
              'text-success': false,
              'bg-light-success': false
            }" (click)="setCurrentTab('attendance')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12s0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12"
                opacity=".5" />
              <path
                d="M10.543 7.517a.75.75 0 1 0-1.086-1.034l-2.314 2.43l-.6-.63a.75.75 0 1 0-1.086 1.034l1.143 1.2a.75.75 0 0 0 1.086 0zM13 8.25a.75.75 0 0 0 0 1.5h5a.75.75 0 0 0 0-1.5zm-2.457 6.267a.75.75 0 1 0-1.086-1.034l-2.314 2.43l-.6-.63a.75.75 0 1 0-1.086 1.034l1.143 1.2a.75.75 0 0 0 1.086 0zM13 15.25a.75.75 0 0 0 0 1.5h5a.75.75 0 0 0 0-1.5z" />
            </svg>
            <span class="nav-link">Attendance</span>
          </li>

          <li class="nav-item" [ngClass]="{
              active: currentTab === 'requests'
            }" (click)="setCurrentTab('requests')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                d="M22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12"
                opacity=".5" />
              <path
                d="M7 16.75a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zm0-3.5a.75.75 0 0 0 0 1.5h9a.75.75 0 0 0 0-1.5zM22 5a3 3 0 1 1-6 0a3 3 0 0 1 6 0" />
            </svg>
            <span class="nav-link">Requests</span>
          </li>

          <li class="nav-item" [ngClass]="{
              active: currentTab === 'documents'
            }" (click)="setCurrentTab('documents')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <g fill-rule="evenodd" clip-rule="evenodd">
                <path
                  d="M10.75 2h2c2.828 0 4.243 0 5.121.879c.879.878.879 2.293.879 5.121v8c0 2.828 0 4.243-.879 5.121c-.878.879-2.293.879-5.121.879h-2c-2.828 0-4.243 0-5.121-.879c-.879-.878-.879-2.293-.879-5.121V8c0-2.828 0-4.243.879-5.121C6.507 2 7.922 2 10.75 2M8 13a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6A.75.75 0 0 1 8 13m0-4a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6A.75.75 0 0 1 8 9m0 8a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 8 17" />
                <path
                  d="M1.75 4.25A.75.75 0 0 1 2.5 5v14A.75.75 0 0 1 1 19V5a.75.75 0 0 1 .75-.75m20 0a.75.75 0 0 1 .75.75v14a.75.75 0 0 1-1.5 0V5a.75.75 0 0 1 .75-.75"
                  opacity=".5" />
              </g>
            </svg>

            <span class="nav-link">Documents</span>
          </li>

          <li class="nav-item" [ngClass]="{
              active: currentTab === 'contracts'
            }" (click)="setCurrentTab('contracts')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                d="M3 10c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h2c3.771 0 5.657 0 6.828 1.172S21 6.229 21 10v4c0 3.771 0 5.657-1.172 6.828S16.771 22 13 22h-2c-3.771 0-5.657 0-6.828-1.172S3 17.771 3 14z"
                opacity=".5" />
              <path
                d="M16.519 16.501c.175-.136.334-.295.651-.612l3.957-3.958c.096-.095.052-.26-.075-.305a4.3 4.3 0 0 1-1.644-1.034a4.3 4.3 0 0 1-1.034-1.644c-.045-.127-.21-.171-.305-.075L14.11 12.83c-.317.317-.476.476-.612.651q-.243.311-.412.666c-.095.2-.166.414-.308.84l-.184.55l-.292.875l-.273.82a.584.584 0 0 0 .738.738l.82-.273l.875-.292l.55-.184c.426-.142.64-.212.84-.308q.355-.17.666-.412m5.849-5.809a2.163 2.163 0 1 0-3.06-3.059l-.126.128a.52.52 0 0 0-.148.465c.02.107.055.265.12.452c.13.375.376.867.839 1.33s.955.709 1.33.839c.188.065.345.1.452.12a.53.53 0 0 0 .465-.148z" />
              <path fill-rule="evenodd"
                d="M7.25 9A.75.75 0 0 1 8 8.25h6.5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 9m0 4a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75m0 4a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75"
                clip-rule="evenodd" />
            </svg>
            <span class="nav-link">Contracts</span>
          </li>

          <li class="nav-item" [ngClass]="{ active: currentTab === 'leave-balance' }"
            (click)="setCurrentTab('leave-balance')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                d="M12 22c-4.714 0-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12s0 7.071-1.465 8.535C19.072 22 16.714 22 12 22"
                opacity=".5" />
              <path
                d="M12 5.25a.75.75 0 0 1 .75.75v12a.75.75 0 0 1-1.5 0V6a.75.75 0 0 1 .75-.75m-5 3a.75.75 0 0 1 .75.75v9a.75.75 0 0 1-1.5 0V9A.75.75 0 0 1 7 8.25m10 4a.75.75 0 0 1 .75.75v5a.75.75 0 0 1-1.5 0v-5a.75.75 0 0 1 .75-.75" />
            </svg>
            <span class="nav-link">Leave Balance</span>
          </li>

          <li class="nav-item" [ngClass]="{
                            active: currentTab === 'custom-info'
                          }" (click)="setCurrentTab('custom-info')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path
                d="M3 10c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h2c3.771 0 5.657 0 6.828 1.172S21 6.229 21 10v4c0 3.771 0 5.657-1.172 6.828S16.771 22 13 22h-2c-3.771 0-5.657 0-6.828-1.172S3 17.771 3 14z"
                opacity=".5" />
              <path
                d="M16.519 16.501c.175-.136.334-.295.651-.612l3.957-3.958c.096-.095.052-.26-.075-.305a4.3 4.3 0 0 1-1.644-1.034a4.3 4.3 0 0 1-1.034-1.644c-.045-.127-.21-.171-.305-.075L14.11 12.83c-.317.317-.476.476-.612.651q-.243.311-.412.666c-.095.2-.166.414-.308.84l-.184.55l-.292.875l-.273.82a.584.584 0 0 0 .738.738l.82-.273l.875-.292l.55-.184c.426-.142.64-.212.84-.308q.355-.17.666-.412m5.849-5.809a2.163 2.163 0 1 0-3.06-3.059l-.126.128a.52.52 0 0 0-.148.465c.02.107.055.265.12.452c.13.375.376.867.839 1.33s.955.709 1.33.839c.188.065.345.1.452.12a.53.53 0 0 0 .465-.148z" />
              <path fill-rule="evenodd"
                d="M7.25 9A.75.75 0 0 1 8 8.25h6.5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 9m0 4a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75m0 4a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75"
                clip-rule="evenodd" />
            </svg>
            <span class="nav-link">Custom Info</span>
          </li>
          <li class="nav-item" [ngClass]="{
                            active: currentTab === 'devices'
                          }" (click)="setCurrentTab('devices')">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M7 18h10M9 22h6M7 4h10a2 2 0 0 1 2 2v10H5V6a2 2 0 0 1 2-2Z" />
            </svg>
            <span class="nav-link">Devices</span>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
          @if (currentTab === 'attendance') {
          <app-attendance-tab [employee]="employee" [isEmployeeActive]="isEmployeeActive">
          </app-attendance-tab>
          } @if (currentTab === 'requests') {
          <app-requests-tab [employee]="employee" [isEmployeeActive]="isEmployeeActive">
          </app-requests-tab>
          } @if (currentTab === 'documents') {
          <app-documents-tab [employee]="employee" [documentsRequired]="documentsRequired"
            [uploadProgress]="uploadProgress" (fileSelected)="onFileSelected($event)"
            (uploadDocument)="onUpload($event.key, $event.fileInput)" (deleteDocument)="onDelete($event)">
          </app-documents-tab>
          } @if (currentTab === 'contracts') {
          <app-contracts-tab [employee]="employee"> </app-contracts-tab>
          } @if (currentTab === 'leave-balance') {
          <app-leave-balance-tab [employee]="employee" [isEmployeeActive]="isEmployeeActive"></app-leave-balance-tab>
          }@if (currentTab === 'custom-info') {
          <app-custom-info [customFieldValues]="customFieldValues" [isLoading]="isLoading"
            (valueUpdated)="handleValueUpdate($event)" (fieldDeleted)="handleFieldDelete($event)">
          </app-custom-info>
          } @if (currentTab === 'devices') {
          <div class="device-tab">
            @if (devicesAttempted) {
            <div class="device-table-meta" *ngIf="devicesTotal">
              <span>Total Devices: {{ devicesTotal }}</span>
              <span>Page {{ devicesPage }} of {{ devicesTotalPages }}</span>
            </div>

            <app-table [data]="devices" [totalItems]="devicesTotal" [itemsPerPage]="devicesPerPage"
              [currentPage]="devicesPage" [columnsCount]="10" [isLoading]="devicesLoading"
              [headerTemplate]="devicesTableHeader" [rowTemplate]="devicesTableRow" [emptyTemplate]="devicesTableEmpty"
              (pageChange)="onDevicesPageChange($event)"
              (itemsPerPageChange)="onDevicesPerPageChange($event)"></app-table>
            } @else {
            <div class="text-muted py-4">Open the Devices tab to load history.</div>
            }

            <ng-template #devicesTableHeader>
              <th>ID</th>
              <th>Status</th>
              <th>Type</th>
              <th>Brand / Model</th>
              <th>Language</th>
              <th>OS</th>
              <th>Browser</th>
              <th>IP Address</th>
              <th>Last Seen</th>
              <th>Registered</th>
              <!-- <th>Updated</th> -->
              <!-- <th>Push Token</th> -->
            </ng-template>

            <ng-template #devicesTableRow let-device>
              <td>{{ device.id }}</td>
              <td>
                <span class="device-status"
                  [ngClass]="device.is_main ? 'device-status--main' : 'device-status--secondary'">
                  {{ device.is_main ? 'Primary' : 'Secondary' }}
                </span>
              </td>
              <td class="text-capitalize">{{ device.device_type || '—' }}</td>
              <td>
                <div class="d-flex flex-column">
                  <span>{{ device.device_family || '—' }}</span>
                  <span class="text-muted small">{{ device.device_model || '—' }}</span>
                </div>
              </td>
              <td class="text-uppercase">{{ device.device_ln || '—' }}</td>
              <td>
                <div class="d-flex flex-column">
                  <span>{{ device.os_device || '—' }}</span>
                  <span class="text-muted small">{{ device.os_version || '—' }}</span>
                </div>
              </td>
              <td>
                <div class="d-flex flex-column">
                  <span>{{ device.browser || '—' }}</span>
                  <span class="text-muted small">{{ device.browser_version || '—' }}</span>
                </div>
              </td>
              <td>{{ device.ip_address || '—' }}</td>
              <td>{{ formatDeviceDate(device.last_seen) }}</td>
              <td>{{ formatDeviceDate(device.created_at) }}</td>
              <!-- <td>{{ formatDeviceDate(device.updated_at) }}</td>
              <td class="device-token-cell">
                <span>{{ device.fcm_token || '—' }}</span>
              </td> -->
            </ng-template>

            <ng-template #devicesTableEmpty>
              <tr>
                <td colspan="10" class="py-3 text-center text-muted">No device history found for this employee.</td>
              </tr>
            </ng-template>
          </div>
          }
        </div>
      </div>
    </div>
  </div>

  }
</div>

<!-- deactivate popup  -->
<app-popup [title]="'Deactivate Employee'" [paragraph1]="
    'Are you sure you want to deactivate the Employee &quot;' +
    (employee?.contact_info?.name || '') +
    '&quot;?'
  " [paragraph2]="
    'This will only hold any access this employee has to the system. You can activate it at any time later.'
  " [isOpen]="deactivateOpen" (close)="closeDeactivate()">
  <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDeactivate()"
    [disabled]="deactivateLoading">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
    </svg>
    <span>Deactivate</span>
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeactivate()">
    Cancel
  </button>
</app-popup>

<!-- activate popup  -->
<app-popup [title]="'Activate Employee'" [paragraph1]="
    'Are you sure you want to Activate the Employee &quot;' +
    (employee?.contact_info?.name || '') +
    '&quot;?'
  " [paragraph2]="'You can deactivate it at any time later.'" [isOpen]="activateOpen" (close)="closeActivate()">
  <button modal-btn-left class="btn btn-lg btn-success w-100" (click)="confirmActivate()" [disabled]="activateLoading">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
    </svg>
    <span>Activate</span>
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeActivate()">
    Cancel
  </button>
</app-popup>

<!-- clear session popup -->
<app-popup [title]="'Clear Employee Session'" [paragraph1]="
    'Are you sure you want to clear the active session for &quot;' +
    (employee?.contact_info?.name || '') +
    '&quot;?'
  " [paragraph2]="'This will sign the employee out from all devices immediately.'"
  [isOpen]="clearSessionOpen && !!employee?.device" (close)="closeClearSession()">
  <button modal-btn-left class="btn btn-lg btn-outline-primary w-100" (click)="confirmClearSession()"
    [disabled]="clearSessionLoading">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M8 12h8m-4-4l4 4l-4 4" />
        <path d="M12 6v-.5C12 3.015 9.985 1 7.5 1H7a6 6 0 0 0-6 6v4a6 6 0 0 0 6 6h.5" />
        <path d="M12 18v.5c0 2.485 2.015 4.5 4.5 4.5h.5a6 6 0 0 0 6-6v-4a6 6 0 0 0-6-6h-.5" />
      </g>
    </svg>
    <span>Clear Session</span>
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeClearSession()">
    Cancel
  </button>
</app-popup>

<!-- Onboarding Checklist Component with Badge -->
@if (employee && employee.onboarding_list) {
<app-onboarding-checklist [isOpen]="isOnboardingModalOpen" [checklistItems]="employee.onboarding_list"
  [showBadge]="true" [completed]="onboardingCompleted" [total]="onboardingTotal" [allowToggle]="true"
  [loadingItemTitle]="loadingChecklistItemTitle" (close)="closeOnboardingModal()"
  (itemClick)="onChecklistItemClick($event)" (badgeClick)="openOnboardingModal()">
</app-onboarding-checklist>
}