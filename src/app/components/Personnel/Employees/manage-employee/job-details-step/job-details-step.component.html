<div class="content-hug">
    <div class="content-box d-flex flex-column gap-3">
        <h2>Job Details</h2>
        <div formGroupName="job_details" class="w-lg-50 d-flex flex-column gap-2">

            <!-- Years of Experience (new) -->
            <div class="input">
                <label for="years_of_experience">Years of Experience</label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <input type="number" id="years_of_experience" formControlName="years_of_experience"
                        class="form-control" placeholder="Enter your years of experience" min="0" max="100" />
                </div>
                @if (sharedService.isFieldInvalid('years_of_experience', sharedService.jobDetails)) {
                <p class="error-msg">
                    {{ sharedService.getFieldError('years_of_experience', sharedService.jobDetails) }}
                </p>
                }
            </div>

            <div class="input">
                <label for="level">Management Level <span>*</span></label>
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select name="level" formControlName="management_level" id="level" class="form-select">
                            <option [value]="null" disabled hidden>Select Level</option>
                            <option [ngValue]="1">Company</option>
                            <option [ngValue]="2">Branch</option>
                            <option [ngValue]="3">Department</option>
                            <option [ngValue]="4">Section</option>
                            <option [ngValue]="5">None</option>
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('management_level',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError("management_level", sharedService.jobDetails)
                    }}
                </p>
                }
            </div>

            @if (sharedService.jobDetails.get('management_level'); as levelControl) {

            @if (levelControl.value === 2 ) {
            <div class="input">
                <label for="branch_id">Branch <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="branch_id" (focus)="sharedService.onBranchFocus()" formControlName="branch_id"
                            class="form-select">
                            <option [value]="null" disabled hidden>Select Branch</option>
                            @for (branch of sharedService.getActiveBranches(); track
                            branch.id) {
                            <option [ngValue]="branch.id">{{ branch.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('branch_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError("branch_id", sharedService.jobDetails)
                    }}
                </p>
                }
                }
            </div>
            }
            @if (levelControl.value === 3 ) {
            <div class="input">
                <label for="branch_id">Branch <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="branch_id" (focus)="sharedService.onBranchFocus()" formControlName="branch_id"
                            class="form-select">
                            <option [value]="null" disabled hidden>Select Branch</option>
                            @for (branch of sharedService.getActiveBranches(); track
                            branch.id) {
                            <option [ngValue]="branch.id">{{ branch.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('branch_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError("branch_id", sharedService.jobDetails)
                    }}
                </p>
                }
                }
            </div>

            <div class="input">
                <label for="department_id">Department <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="department_id" (focus)="sharedService.onDepartmentFocus()"
                            formControlName="department_id" class="form-select">
                            <option [value]="null" disabled hidden>
                                {{ sharedService.getActiveDepartments().length > 0
                                ? 'Select Department' : 'No department available' }}
                            </option>
                            @for (dept of sharedService.getActiveDepartments(); track dept.id)
                            {
                            <option [ngValue]="dept.id">{{ dept.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('department_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError(
                    "department_id",
                    sharedService.jobDetails
                    )
                    }}
                </p>
                }
                }
            </div>
            }
            @if (levelControl.value === 5 || levelControl.value === 4) {

            <div class="input">
                <label for="branch_id">Branch <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="branch_id" (focus)="sharedService.onBranchFocus()" formControlName="branch_id"
                            class="form-select">
                            <option [value]="null" disabled hidden>Select Branch</option>
                            @for (branch of sharedService.getActiveBranches(); track
                            branch.id) {
                            <option [ngValue]="branch.id">{{ branch.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('branch_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError("branch_id", sharedService.jobDetails)
                    }}
                </p>
                }
                }
            </div>

            <div class="input">
                <label for="department_id">Department <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="department_id" (focus)="sharedService.onDepartmentFocus()"
                            formControlName="department_id" class="form-select">
                            <option [value]="null" disabled hidden>
                                {{ sharedService.getActiveDepartments().length > 0
                                ? 'Select Department' : 'No department available' }}
                            </option>
                            @for (dept of sharedService.getActiveDepartments(); track dept.id)
                            {
                            <option [ngValue]="dept.id">{{ dept.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('department_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError(
                    "department_id",
                    sharedService.jobDetails
                    )
                    }}
                </p>
                }
                }
            </div>

            <div class="input">
                <label for="section_id">Section</label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="section_id" (focus)="sharedService.onSectionFocus()" formControlName="section_id"
                            class="form-select" [disabled]="sharedService.getSections().length === 0">
                            <option [value]="null" disabled hidden>
                                {{
                                sharedService.getSections().length === 0
                                ? "Select Department first"
                                : "Select Section"
                                }}
                            </option>
                            @for (section of sharedService.getSections(); track section.id) {
                            <option [ngValue]="section.id">{{ section.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                }
            </div>

            }

            <div class="input">
                <label for="job_title_id">Job Title <span>*</span></label>
                @if (sharedService.isLoadingJobDetails()) {
                <div class="skeleton-loader" style="height: 46px; border-radius: 8px;"></div>
                } @else {
                <div class="d-flex align-items-center gap-4">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <select id="job_title_id" (focus)="sharedService.onJobTitleFocus()"
                            formControlName="job_title_id" class="form-select">
                            <option [value]="null" disabled hidden>
                                {{ sharedService.jobTitles().length > 0
                                ? 'Select Job Title' : 'No job title available'}}
                            </option>
                            @for (job of sharedService.jobTitles(); track job.id) {
                            <option [ngValue]="job.id">{{ job.name }}</option>
                            }
                        </select>
                    </div>
                </div>
                @if (sharedService.isFieldInvalid('job_title_id',
                sharedService.jobDetails)) {
                <p class="error-msg">
                    {{
                    sharedService.getFieldError(
                    "job_title_id",
                    sharedService.jobDetails
                    )
                    }}
                </p>
                }
                }
            </div>

            }

            <!-- prev and next buttons -->
            <div class="btn-fixed d-flex align-items-stretch gap-2">
                <button type="button"
                    class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
                    (click)="goPrev()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5" d="M20 12H4m0 0l6-6m-6 6l6 6" />
                    </svg>
                </button>
                <button type="button" class="btn btn-lg btn-primary" (click)="goNext()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5" d="M4 12h16m0 0l-6-6m6 6l-6 6" />
                    </svg>
                    <span>
                        {{ sharedService.isEditMode() ? 'Next (2/4)' : 'Next (2/5)' }}
                    </span>
                </button>
            </div>
        </div>
    </div>