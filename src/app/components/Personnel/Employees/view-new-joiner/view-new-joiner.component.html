<!-- page header inactive account -->
<app-page-header *ngIf="employee && !employee.employee_active" [breadcrumbs]="[
    { label: 'Personnel', link: '/dashboard' },
    { label: 'Employees', link: '/employees' },
    { label: 'New Joiner' }
  ]" [title]="'New Joiner - ' + (employee.contact_info.name || '')" 
  [create]="(employee.created_at | date:'dd/MM/yyyy') || ''" 
  [update]="(employee.updated_at | date:'dd/MM/yyyy') || ''">
</app-page-header>

<!-- page header active account -->
<app-page-header *ngIf="employee && employee.employee_active" [breadcrumbs]="[
    { label: 'Personnel', link: '/dashboard' },
    { label: 'Employees', link: '/employees' },
    { label: 'View New Joiner ' + employee.contact_info.name }
  ]" [title]="'New Joiner - ' + employee.contact_info.name" 
  [create]="(employee.created_at | date:'dd/MM/yyyy') || ''" 
  [update]="(employee.updated_at | date:'dd/MM/yyyy') || ''">
    <button class="btn btn-lg btn-primary" (click)="openSuccessModal()"
      *ngIf="hasEmployeePermission('update')">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
            </g>
        </svg>
        <span>Employee Joined</span>
    </button>

    <button class="btn btn-lg btn-outline-danger" (click)="openModal()"
      *ngIf="hasEmployeePermission('delete')">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
            </g>
        </svg>
        <span>Cancel Contract</span>
    </button>
</app-page-header>

<div class="content-hug d-flex flex-column gap-4">

  <!-- Loading state -->
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="min-height: 400px;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="!loading && !employee" class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Employee Not Found</h4>
    <p>The requested employee could not be found or an error occurred while loading the data.</p>
  </div>

  <!-- Content when employee data is loaded -->
  <div *ngIf="!loading && employee">

    <!-- 3 cards -->
    <div class="d-flex align-items-stretch gap-4">

        <div class="content-box d-flex flex-column gap-3 w-100">
            <h2>Contact Info</h2>
            <div class="info">
                <h6>ID</h6>
                <span>{{ employee.id || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Full Name</h6>
                <span>{{ employee.contact_info.name || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Phone Number</h6>
                <span>{{ employee.contact_info.mobile.country.phone_prefix || '' }}{{ employee.contact_info.mobile.number || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Personal Email</h6>
                <span>{{ employee.contact_info.email || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Date of Birth</h6>
                <span>{{ (employee.contact_info.date_of_birth | date:'dd/MM/yyyy') || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Address</h6>
                <span>{{ employee.contact_info.address || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Marital Status</h6>
                <span>{{ employee.contact_info.marital_status.name || 'N/A' }}</span>
            </div>
        </div>

        <div class="content-box d-flex flex-column gap-3 w-100">
            <div class="d-flex align-items-center justify-content-between">
                <h2>Job Info</h2>
                <span class="badge-newjoiner" *ngIf="employeeData.employeeStatus === 'New Joiner'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-width="1.5">
                            <path
                                d="M2 12c0-3.771 0-5.657 1.172-6.828S6.229 4 10 4h4c3.771 0 5.657 0 6.828 1.172S22 8.229 22 12v2c0 3.771 0 5.657-1.172 6.828S17.771 22 14 22h-4c-3.771 0-5.657 0-6.828-1.172S2 17.771 2 14z" />
                            <path stroke-linecap="round" d="M7 4V2.5M17 4V2.5" />
                            <circle cx="16.5" cy="16.5" r="1.5" />
                            <path stroke-linecap="round" d="M2.5 9h19" />
                        </g>
                    </svg>
                    <span>New Joiner</span>
                </span>
                <span class="badge-newemployee" *ngIf="employeeData.employeeStatus === 'Joining Today'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M3 12c0 3.771 0 7.657 1.318 8.828C5.636 22 7.758 22 12 22s6.364 0 7.682-1.172S21 15.771 21 12" />
                            <path
                                d="m14.66 14.202l6.008-1.802c.595-.179.893-.268 1.082-.482a1 1 0 0 0 .1-.134c.15-.243.15-.553.15-1.175c0-2.45 0-3.675-.673-4.502a3 3 0 0 0-.434-.434C20.066 5 18.841 5 16.391 5H7.61c-2.45 0-3.675 0-4.502.673q-.24.195-.434.434C2 6.934 2 8.159 2 10.609c0 .622 0 .932.15 1.175q.045.07.1.134c.19.214.487.303 1.082.482l6.008 1.802M6.5 5c.823-.02 1.66-.545 1.94-1.32l.035-.103L8.5 3.5c.042-.127.064-.19.086-.246a2 2 0 0 1 1.735-1.25C10.38 2 10.448 2 10.58 2h2.838c.133 0 .2 0 .26.004a2 2 0 0 1 1.735 1.25c.023.056.044.12.086.246l.026.077c.018.053.026.08.035.103c.28.775 1.116 1.3 1.939 1.32" />
                            <path stroke-linecap="round"
                                d="M14 12.5h-4a.5.5 0 0 0-.5.5v2.162a.5.5 0 0 0 .314.464l.7.28a4 4 0 0 0 2.972 0l.7-.28a.5.5 0 0 0 .314-.464V13a.5.5 0 0 0-.5-.5Z" />
                        </g>
                    </svg>
                    <span>Joining Today</span>
                </span>
            </div>
            <div class="info">
                <h6>Job Title</h6>
                <span>{{ employee.job_info.job_title.name || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Employment Type</h6>
                <span>{{ employee.job_info.employment_type.name || 'N/A' }}</span>
            </div>
            <!-- <div class="info">
                <h6>Work Mode</h6>
                <span>{{ employee.job_info.work_mode.name || 'N/A' }}</span>
            </div> -->
            <div class="info">
                <h6>Section</h6>
                <span>{{ employee.job_info.section?.name || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Department</h6>
                <span>{{ employee.job_info.department.name || 'N/A' }}</span>
            </div>
            <div class="info">
                <h6>Branch</h6>
                <span>{{ employee.job_info.branch.name || 'N/A' }}</span>
            </div>
            <!-- <div class="info">
                <h6>Work Schedule</h6>
                <span>{{ employee.job_info.work_schedule.name || 'N/A' }}</span>
            </div> -->
            <!-- <div class="info">
                <h6>Contract Start Date</h6>
                <span>{{ (employee.job_info.start_contract | date:'dd/MM/yyyy') || 'N/A' }}</span>
            </div> -->
            <div class="info" *ngIf="employee.job_info.end_contract">
                <h6>Contract End Date</h6>
                <span>{{ (employee.job_info.end_contract | date:'dd/MM/yyyy') || 'N/A' }}</span>
            </div>
            <!-- <div class="info">
                <h6>Contract Type</h6>
                <span>{{ employee.job_info.contract_type.name || 'N/A' }}</span>
            </div> -->
            <!-- <div class="info">
                <h6>Salary</h6>
                <span>{{ employee.job_info.salary || 'N/A' }} EGP</span>
            </div> -->
            <!-- <div class="info" *ngIf="employee.job_info.days_on_site">
                <h6>Days On Site</h6>
                <span>{{ employee.job_info.days_on_site }} days/week</span>
            </div> -->
            <div class="d-flex align-items-center justify-content-between">
                <div class="info">
                    <h6>Direct Manager</h6>
                    <span>Ahmed Hamed</span>
                </div>
                <a class="view-btn h-100 d-flex align-items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
                            <path stroke-linejoin="round" d="m13 11l9-9m0 0h-5.344M22 2v5.344" />
                            <path
                                d="M22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2" />
                        </g>
                    </svg>
                </a>
            </div>
        </div>

        <div class="content-box d-flex flex-column gap-3 w-100 my-3">
            <div class="d-flex align-items-center justify-content-between">
                <h2>Account Info</h2>
                <span class="badge-success" *ngIf="employee.employee_active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
                        </g>
                    </svg>
                    <span>Active</span>
                </span>
                <span class="badge-gray" *ngIf="!employee.employee_active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" d="m18.5 5.5l-13 13" />
                            <circle cx="12" cy="12" r="10" />
                        </g>
                    </svg>
                    <span>Inactive</span>
                </span>
            </div>
            <div class="info">
                <h6>Company Email</h6>
                <span>{{ employee.contact_info.email || 'N/A' }}</span>
            </div>
            <div class="info" *ngIf="!employee.employee_active">
                <h6>Password</h6>
                <span>**********</span>
            </div>

            <button class="btn btn-lg btn-primary w-100 mt-auto" *ngIf="!employee.employee_active">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                    <g fill="none" stroke="currentColor" stroke-width="1.5">
                        <path
                            d="M2 12c0-3.771 0-5.657 1.172-6.828S6.229 4 10 4h4c3.771 0 5.657 0 6.828 1.172S22 8.229 22 12s0 5.657-1.172 6.828S17.771 20 14 20h-4c-3.771 0-5.657 0-6.828-1.172S2 15.771 2 12Z" />
                        <path stroke-linecap="round"
                            d="m6 8l2.159 1.8c1.837 1.53 2.755 2.295 3.841 2.295s2.005-.765 3.841-2.296L18 8" />
                    </g>
                </svg>
                <span>Send Account Credentials</span>
            </button>
        </div>

    </div>

    <!-- Join Status Section -->
    <div class="content-box d-flex flex-column gap-3 w-100 my-3">
        <!-- Future join date -->
        <h5 class="m-0 text-center" *ngIf="isJoiningFuture()">
            {{ employee.contact_info.name }} will join on <span>{{ getFormattedJoinDate() }}</span>
        </h5>
        <!-- Today joined -->
        <h5 class="m-0 text-center" *ngIf="isJoiningToday()">
            {{ employee.contact_info.name }} will join <span>Today</span>
        </h5>
        <div class="d-flex justify-content-center" *ngIf="isJoiningFuture()">
            <button class="btn btn-outline-danger btn-lg border-0 w-auto m-0" 
              *ngIf="hasEmployeePermission('update')">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                    <g fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" d="M4 22h16" />
                        <path
                            d="m13.888 3.663l.742-.742a3.146 3.146 0 1 1 4.449 4.45l-.742.74m-4.449-4.448s.093 1.576 1.483 2.966s2.966 1.483 2.966 1.483m-4.449-4.45L7.071 10.48c-.462.462-.693.692-.891.947a5.2 5.2 0 0 0-.599.969c-.139.291-.242.601-.449 1.22l-.875 2.626m14.08-8.13l-6.817 6.817c-.462.462-.692.692-.947.891q-.451.352-.969.599c-.291.139-.601.242-1.22.448l-2.626.876m0 0l-.641.213a.848.848 0 0 1-1.073-1.073l.213-.641m1.501 1.5l-1.5-1.5" />
                    </g>
                </svg>
                <span class="fw-semibold">Reschedule Join Date</span>
            </button>
        </div>
    </div>

    <!-- Work Schedule Section -->
    <div class="content-box d-flex flex-column gap-3 w-100">
        <h2>Work Schedule</h2>
        <div class="info">
            <h6>Schedule Name</h6>
            <span>{{ employee.job_info.work_schedule.name || 'N/A' }}</span>
        </div>
        <div class="info">
            <h6>Working days</h6>
            <span>Sunday, Monday, Tuesday, Wednesday, Thursday</span>
        </div>
        <div class="info">
            <h6>Working Hours</h6>
            <span>09:00 AM - 05:00 PM</span>
        </div>
        <div class="info">
            <h6>Break Time</h6>
            <span>12:00 PM - 01:00 PM</span>
        </div>
        <div class="info">
            <h6>Total Working Hours</h6>
            <span>8 hours/day</span>
        </div>
    </div>

  </div>
</div>

<!-- Cancel Contract Modal -->
<app-popup
  [title]="'Cancel Contract'"
  [paragraph1]="'Are you sure you want to cancel the contract for &quot;' + (employee?.contact_info?.name || '') + '&quot;?'"
  [paragraph2]="'This action cannot be undone. The employee will be removed from the system.'"
  [isOpen]="isModalOpen"
  (close)="closeModal()">
  
  <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmAction()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
      </g>
    </svg>
    <span>Cancel Contract</span>
  </button>
  
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeModal()">
    Cancel
  </button>
</app-popup>

<!-- Success Modal -->
<app-popup
  [title]="'Employee Joined Successfully'"
  [paragraph1]="'&quot;' + (employee?.contact_info?.name || '') + '&quot; has been successfully marked as joined.'"
  [paragraph2]="'The employee is now active in the system and can access their account.'"
  [isOpen]="isSuccessModalOpen"
  (close)="closeSuccessModal()">
  
  <button modal-btn-left class="btn btn-lg btn-success w-100" (click)="viewEmployees()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
      </g>
    </svg>
    <span>View All Employees</span>
  </button>
  
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="createAnother()">
    Create Another
  </button>
</app-popup>
