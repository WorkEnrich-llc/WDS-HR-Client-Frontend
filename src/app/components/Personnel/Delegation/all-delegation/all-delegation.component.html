<!-- start page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Personnel', link: '/dashboard' },
    { label: 'Delegation' }
  ]" title="All Delegations">
</app-page-header>
<!-- end page header -->

<!-- start page content -->
<div class="content-hug">
    <div class="content-box d-flex flex-column gap-3">
        <!-- start search and filter -->
        <div
            class="d-flex flex-column flex-lg-row align-items-start align-lg-items-center justify-content-between gap-2">
            <div class="d-flex align-items-center gap-2 w-100 w-lg-50">
                <!-- Search input -->
                <div data-mdb-input-init class="form-outline w-75">
                    <input type="text" class="form-control" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                        placeholder="Search" />
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <g fill="none" stroke-width="1.5">
                            <circle cx="11.5" cy="11.5" r="9.5" />
                            <path stroke-linecap="round" d="M18.5 18.5L22 22" />
                        </g>
                    </svg>
                </div>

                <!-- Filter button -->
                <button class="btn btn-lg btn-outline-primary" (click)="overlay.openOverlay()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                        <path fill="none" stroke-width="1.5"
                            d="M19 3H5c-1.414 0-2.121 0-2.56.412S2 4.488 2 5.815v.69c0 1.037 0 1.556.26 1.986s.733.698 1.682 1.232l2.913 1.64c.636.358.955.537 1.183.735c.474.411.766.895.898 1.49c.064.284.064.618.064 1.285v2.67c0 .909 0 1.364.252 1.718c.252.355.7.53 1.594.88c1.879.734 2.818 1.101 3.486.683S15 19.452 15 17.542v-2.67c0-.666 0-1 .064-1.285a2.68 2.68 0 0 1 .899-1.49c.227-.197.546-.376 1.182-.735l2.913-1.64c.948-.533 1.423-.8 1.682-1.23c.26-.43.26-.95.26-1.988v-.69c0-1.326 0-1.99-.44-2.402C21.122 3 20.415 3 19 3Z" />
                    </svg>
                    <span>Filter</span>
                </button>
            </div>

            <!-- New Delegation button -->
            <button class="btn btn-lg btn-primary" routerLink="/delegation/create">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                    <g fill="none" stroke="#ffffff" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
                    </g>
                </svg>
                <span>New Delegation</span>
            </button>
        </div>

        <!-- start Table -->
        <app-table [isLoading]="loadData" [columnsCount]="5" [data]="filteredDelegations" [totalItems]="totalItems"
            [itemsPerPage]="itemsPerPage" [currentPage]="currentPage" (pageChange)="onPageChange($event)"
            (itemsPerPageChange)="onItemsPerPageChange($event)" [headerTemplate]="delegationTableHeader"
            [rowTemplate]="delegationTableRow" [emptyTemplate]="noDelegations"></app-table>

        <ng-template #delegationTableHeader>
            <th (click)="sortBy()" style="cursor: pointer;" class="width-fix">
                <div class="d-flex align-items-center justify-content-between">
                    <span>Delegator</span>
                    <svg xmlns="http://www.w3.org/2000/svg" *ngIf="sortDirection === 'desc'" width="24" height="24"
                        viewBox="0 0 24 24">
                        <g fill="none" stroke="#DDE3EB" stroke-linecap="round" stroke-width="1.5">
                            <path d="M4 8h9m-7 5h7m-5 5h5" />
                            <path stroke-linejoin="round" d="M17 20V4l3 4" />
                        </g>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" *ngIf="sortDirection === 'asc'" width="24" height="24"
                        viewBox="0 0 24 24">
                        <path fill="#DDE3EB" fill-rule="evenodd"
                            d="M17 3.25a.75.75 0 0 1 .75.75v13.75l1.65-2.2a.75.75 0 1 1 1.2.9l-3 4a.75.75 0 0 1-1.35-.45V4a.75.75 0 0 1 .75-.75M7.25 6A.75.75 0 0 1 8 5.25h5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 6m-2 5a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75m-2 5a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5H4a.75.75 0 0 1-.75-.75"
                            clip-rule="evenodd" />
                    </svg>
                </div>
            </th>
            <th>Delegate</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Actions</th>
        </ng-template>

        <ng-template #delegationTableRow let-delegation let-i="index">
            <td class="width-fix">
                <span class="d-block text-truncate" style="max-width: 300px;">
                    {{ delegation.delegatorName }}
                </span>
            </td>
            <td>
                <span class="d-block text-truncate" style="max-width: 300px;">
                    {{ delegation.delegateName }}
                </span>
            </td>
            <td>{{ delegation.startDate }}</td>
            <td>{{ delegation.endDate }}</td>

            <td>
                <div class="d-flex align-items-center gap-2">
                    <!-- Edit icon-only button -->
                    <a class="btn btn-icon" [routerLink]="['/delegation/edit', delegation.id]" title="Edit">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_2505_23400)">
                                <g clip-path="url(#clip1_2505_23400)">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M8.95697 0.9375L10.125 0.9375C10.4357 0.9375 10.6875 1.18934 10.6875 1.5C10.6875 1.81066 10.4357 2.0625 10.125 2.0625H9C7.21633 2.0625 5.93517 2.06369 4.96018 2.19478C4.00138 2.32369 3.42334 2.56886 2.9961 2.9961C2.56886 3.42334 2.32369 4.00138 2.19478 4.96018C2.06369 5.93517 2.0625 7.21633 2.0625 9C2.0625 10.7837 2.06369 12.0648 2.19478 13.0398C2.32369 13.9986 2.56886 14.5767 2.9961 15.0039C3.42334 15.4311 4.00138 15.6763 4.96018 15.8052C5.93517 15.9363 7.21633 15.9375 9 15.9375C10.7837 15.9375 12.0648 15.9363 13.0398 15.8052C13.9986 15.6763 14.5767 15.4311 15.0039 15.0039C15.4311 14.5767 15.6763 13.9986 15.8052 13.0398C15.9363 12.0648 15.9375 10.7837 15.9375 9V7.875C15.9375 7.56434 16.1893 7.3125 16.5 7.3125C16.8107 7.3125 17.0625 7.56434 17.0625 7.875V9.04303C17.0625 10.7743 17.0625 12.1311 16.9202 13.1897C16.7745 14.2733 16.4705 15.1283 15.7994 15.7994C15.1283 16.4705 14.2733 16.7745 13.1897 16.9202C12.1311 17.0625 10.7743 17.0625 9.04303 17.0625H8.95697C7.22567 17.0625 5.8689 17.0625 4.81028 16.9202C3.72673 16.7745 2.87171 16.4705 2.2006 15.7994C1.5295 15.1283 1.22549 14.2733 1.07981 13.1897C0.937483 12.1311 0.937491 10.7743 0.9375 9.04303V8.95697C0.937491 7.22567 0.937483 5.86889 1.07981 4.81028C1.22549 3.72673 1.5295 2.87171 2.2006 2.2006C2.87171 1.5295 3.72673 1.22549 4.81028 1.07981C5.86889 0.937483 7.22567 0.937491 8.95697 0.9375ZM12.5779 1.70694C13.6038 0.681022 15.2671 0.681022 16.2931 1.70694C17.319 2.73285 17.319 4.39619 16.2931 5.4221L11.307 10.4082C11.0285 10.6867 10.8541 10.8611 10.6594 11.013C10.4302 11.1918 10.1821 11.3451 9.91961 11.4702C9.69676 11.5764 9.46271 11.6544 9.08909 11.7789L6.9107 12.505C6.50851 12.6391 6.0651 12.5344 5.76533 12.2347C5.46556 11.9349 5.36089 11.4915 5.49495 11.0893L6.22108 8.91092C6.34559 8.53729 6.42359 8.30324 6.5298 8.08039C6.65489 7.81791 6.80821 7.56984 6.98703 7.34056C7.13887 7.1459 7.31333 6.97147 7.59183 6.693L12.5779 1.70694ZM15.4976 2.50243C14.911 1.91586 13.96 1.91586 13.3734 2.50243L13.0909 2.7849C13.108 2.85679 13.1318 2.94245 13.1649 3.038C13.2724 3.34779 13.4758 3.75579 13.86 4.14C14.2442 4.5242 14.6522 4.7276 14.962 4.83508C15.0575 4.86823 15.1432 4.89205 15.2151 4.90907L15.4976 4.62661C16.0841 4.04003 16.0841 3.08901 15.4976 2.50243ZM14.3289 5.79532C13.9419 5.6289 13.4911 5.36209 13.0645 4.93549C12.6379 4.50889 12.3711 4.05812 12.2047 3.67114L8.41313 7.46269C8.10075 7.77508 7.97823 7.89897 7.87411 8.03246C7.74553 8.19731 7.6353 8.37567 7.54536 8.56439C7.47252 8.71722 7.41651 8.8822 7.2768 9.30131L6.95288 10.2731L7.72693 11.0471L8.69869 10.7232C9.1178 10.5835 9.28278 10.5275 9.43561 10.4546C9.62433 10.3647 9.80269 10.2545 9.96754 10.1259C10.101 10.0218 10.2249 9.89926 10.5373 9.58687L14.3289 5.79532Z"
                                        fill="#4A6D97" />
                                </g>
                            </g>
                            <defs>
                                <clipPath id="clip0_2505_23400">
                                    <rect width="18" height="18" fill="white" />
                                </clipPath>
                                <clipPath id="clip1_2505_23400">
                                    <rect width="18" height="18" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>

                    </a>

                    <!-- Delete icon-only button -->
                    <button type="button" class="btn btn-icon"
                        (click)="confirmAndDelete(delegation.id)" title="Delete">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M7.7319 1.68751H10.268C10.4303 1.68741 10.5717 1.68732 10.7052 1.70864C11.2327 1.79287 11.6891 2.12186 11.9358 2.59563C11.9983 2.71555 12.0429 2.84971 12.0941 3.00371L12.1778 3.25488C12.192 3.2974 12.196 3.30943 12.1995 3.31891C12.3308 3.682 12.6713 3.92745 13.0573 3.93723C13.0675 3.93748 13.0799 3.93753 13.1249 3.93753H15.3749C15.6856 3.93753 15.9374 4.18937 15.9374 4.50003C15.9374 4.81069 15.6856 5.06253 15.3749 5.06253H2.62488C2.31422 5.06253 2.06238 4.81069 2.06238 4.50003C2.06238 4.18937 2.31422 3.93753 2.62488 3.93753H4.87494C4.91997 3.93753 4.9324 3.93749 4.94255 3.93723C5.32854 3.92745 5.66906 3.68202 5.8004 3.31893C5.80385 3.30938 5.80782 3.29761 5.82206 3.25488L5.90577 3.00372C5.95699 2.84973 6.00162 2.71555 6.06407 2.59563C6.31078 2.12186 6.76723 1.79287 7.2947 1.70864C7.42821 1.68732 7.5696 1.68741 7.7319 1.68751ZM6.75599 3.93753C6.79462 3.86176 6.82886 3.78303 6.85831 3.70161C6.86725 3.67689 6.87602 3.65057 6.88729 3.61675L6.96215 3.39219C7.03052 3.18706 7.04627 3.14522 7.06189 3.11523C7.14412 2.95731 7.29627 2.84764 7.4721 2.81957C7.50549 2.81423 7.55015 2.81253 7.76639 2.81253H10.2335C10.4497 2.81253 10.4944 2.81423 10.5278 2.81957C10.7036 2.84764 10.8558 2.95731 10.938 3.11523C10.9536 3.14522 10.9694 3.18705 11.0377 3.39219L11.1125 3.61662L11.1416 3.70163C11.171 3.78304 11.2053 3.86177 11.2439 3.93753H6.75599Z"
                                fill="#E04F5F" />
                            <path
                                d="M4.4362 6.33761C4.41553 6.02764 4.1475 5.79311 3.83752 5.81377C3.52755 5.83444 3.29302 6.10247 3.31369 6.41245L3.66127 11.6262C3.7254 12.5883 3.77719 13.3654 3.89867 13.9752C4.02497 14.6092 4.23978 15.1387 4.68348 15.5538C5.12718 15.9689 5.66984 16.1481 6.31083 16.2319C6.92735 16.3126 7.70616 16.3125 8.67033 16.3125H9.3295C10.2937 16.3125 11.0725 16.3126 11.6891 16.2319C12.33 16.1481 12.8727 15.9689 13.3164 15.5538C13.7601 15.1387 13.9749 14.6092 14.1012 13.9752C14.2227 13.3654 14.2745 12.5883 14.3386 11.6263L14.6862 6.41245C14.7069 6.10247 14.4723 5.83444 14.1624 5.81377C13.8524 5.79311 13.5844 6.02764 13.5637 6.33761L13.2187 11.5119C13.1513 12.5228 13.1033 13.2262 12.9979 13.7554C12.8956 14.2688 12.7529 14.5405 12.5478 14.7323C12.3428 14.9242 12.0621 15.0485 11.5431 15.1164C11.0081 15.1864 10.3031 15.1875 9.28995 15.1875H8.70993C7.6968 15.1875 6.99179 15.1864 6.45674 15.1164C5.93774 15.0485 5.65712 14.9242 5.45206 14.7323C5.247 14.5405 5.10425 14.2687 5.00199 13.7554C4.89656 13.2262 4.84854 12.5228 4.78115 11.5119L4.4362 6.33761Z"
                                fill="#E04F5F" />
                            <path
                                d="M7.06898 7.69032C7.37809 7.65941 7.65374 7.88494 7.68466 8.19406L8.05966 11.9441C8.09057 12.2532 7.86504 12.5288 7.55592 12.5597C7.2468 12.5906 6.97115 12.3651 6.94024 12.056L6.56524 8.306C6.53433 7.99688 6.75986 7.72123 7.06898 7.69032Z"
                                fill="#E04F5F" />
                            <path
                                d="M10.9309 7.69032C11.24 7.72123 11.4656 7.99688 11.4347 8.306L11.0597 12.056C11.0287 12.3651 10.7531 12.5906 10.444 12.5597C10.1349 12.5288 9.90933 12.2532 9.94024 11.9441L10.3152 8.19406C10.3462 7.88494 10.6218 7.65941 10.9309 7.69032Z"
                                fill="#E04F5F" />
                        </svg>

                    </button>
                </div>
            </td>
        </ng-template>

        <ng-template #noDelegations>
            <tr>
                <td colspan="6" class="no-data py-4">
                    <ng-container *ngIf="searchTerm?.trim()|| filterForm?.dirty; else noDelegationsTemplate">
                        No delegations match your search.
                    </ng-container>
                    <ng-template #noDelegationsTemplate>
                        No delegations added yet.
                    </ng-template>
                </td>
            </tr>
        </ng-template>
    </div>
</div>

<!-- filter popup -->
<app-overlay-filter-box #filterBox [title]="'Filters'">
    <form class="w-100 d-flex flex-column gap-3">
        <div class="input">
            <label for="status">Status</label>
            <div class="d-flex align-items-center gap-4">
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <select name="" id="status" class="form-select">
                        <option value="" selected disabled hidden>Select</option>
                        <option value="all">Any</option>
                        <option value="accepted">Accepted</option>
                        <option value="pending">Pending</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="#e04f5f"
                        d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
                    <path fill="#e04f5f" fill-rule="evenodd"
                        d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                        clip-rule="evenodd" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <g fill="none" stroke="#3f9870" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
                    </g>
                </svg>
            </div>
        </div>

        <div class="input">
            <label for="createdFrom">Created From</label>
            <div class="d-flex align-items-center gap-4">
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <input type="date" id="createdFrom" class="form-control custom-date-input" placeholder="Min-Max" />
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <g fill="none" stroke-width="1.5">
                            <path stroke-linecap="round"
                                d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
                            <circle cx="18" cy="18" r="3" />
                            <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
                        </g>
                    </svg>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="#e04f5f"
                        d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
                    <path fill="#e04f5f" fill-rule="evenodd"
                        d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                        clip-rule="evenodd" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <g fill="none" stroke="#3f9870" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
                    </g>
                </svg>
            </div>
        </div>

        <div class="d-flex align-items-center gap-3">
            <button type="submit" class="btn btn-lg btn-primary w-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <g fill="none" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
                    </g>
                </svg>
                <span>Apply Filter</span>
            </button>
            <a (click)="resetFilterForm()" class="text-danger-dark fw-bold w-100 text-center">
                <span>Clear Filters</span>
            </a>
        </div>
    </form>
</app-overlay-filter-box>

<!-- delete confirmation popup -->
<app-popup [title]="'Delete Delegation'" [paragraph1]="'Are you sure you want to delete this delegation?'" [isOpen]="deleteOpen" (close)="closeDeleteConfirm()">
    <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDelete()" [disabled]="loading">
        Delete
    </button>
    <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeleteConfirm()">
        Cancel
    </button>
</app-popup>