<!-- page header -->
<app-page-header [breadcrumbs]="breadcrumb" title="Announcements"></app-page-header>

<!-- content -->
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <!-- toolbar above table -->
    <div class="d-flex align-items-center justify-content-between gap-4 w-100">
      <div class="d-flex align-items-center gap-3">
        <!-- Search input -->
        <div class="form-outline search-input">
          <input type="text" class="form-control" placeholder="Search" [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()" />
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <circle cx="11.5" cy="11.5" r="9.5" />
              <path stroke-linecap="round" d="M18.5 18.5L22 22" />
            </g>
          </svg>
        </div>

        <!-- Filter button -->
        <button class="btn btn-lg btn-outline-primary" (click)="filterBox.openOverlay()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
            <path fill="none" stroke-width="1.5"
              d="M19 3H5c-1.414 0-2.121 0-2.56.412S2 4.488 2 5.815v.69c0 1.037 0 1.556.26 1.986s.733.698 1.682 1.232l2.913 1.64c.636.358.955.537 1.183.735c.474.411.766.895.898 1.49c.064.284.064.618.064 1.285v2.67c0 .909 0 1.364.252 1.718c.252.355.7.53 1.594.88c1.879.734 2.818 1.101 3.486.683S15 19.452 15 17.542v-2.67c0-.666 0-1 .064-1.285a2.68 2.68 0 0 1 .899-1.49c.227-.197.546-.376 1.182-.735l2.913-1.64c.948-.533 1.423-.8 1.682-1.23c.26-.43.26-.95.26-1.988v-.69c0-1.326 0-1.99-.44-2.402C21.122 3 20.415 3 19 3Z" />
          </svg>
          <span>Filter</span>
        </button>
      </div>

      <div class="d-flex align-items-center gap-3">
        <!-- Create button -->
        <button class="btn btn-lg btn-primary px-4" [routerLink]="['/announcements/create']">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M9.5625 6.75C9.5625 6.43934 9.31066 6.1875 9 6.1875C8.68934 6.1875 8.4375 6.43934 8.4375 6.75L8.4375 8.43752H6.75C6.43934 8.43752 6.1875 8.68936 6.1875 9.00002C6.1875 9.31068 6.43934 9.56252 6.75 9.56252H8.4375V11.25C8.4375 11.5607 8.68934 11.8125 9 11.8125C9.31066 11.8125 9.5625 11.5607 9.5625 11.25L9.5625 9.56252H11.25C11.5607 9.56252 11.8125 9.31068 11.8125 9.00002C11.8125 8.68936 11.5607 8.43752 11.25 8.43752H9.5625V6.75Z"
              fill="#E0EBFF" />
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C12.8315 2.0625 15.9375 5.16852 15.9375 9C15.9375 12.8315 12.8315 15.9375 9 15.9375C5.16852 15.9375 2.0625 12.8315 2.0625 9Z"
              fill="#E0EBFF" />
          </svg>

          <span>Create Notification</span>
        </button>
      </div>
    </div>
    <app-table [data]="announcements" [isLoading]="isLoading" [columnsCount]="3" [currentPage]="currentPage"
      [totalItems]="totalItems" [itemsPerPage]="itemsPerPage" (pageChange)="onPageChange($event)"
      (itemsPerPageChange)="onItemsPerPageChange($event)" [headerTemplate]="tableHeader" [rowTemplate]="tableRow"
      [emptyTemplate]="emptyState">
    </app-table>
  </div>
</div>

<!-- table templates -->
<ng-template #tableHeader>
  <th class="w-40">
    <span class="header-two-line">Recipient</span>
    <span class="header-two-line">Name</span>
  </th>
  <th class="w-40">Title</th>
  <th class="w-20 text-end">Actions</th>

</ng-template>

<ng-template #tableRow let-item>
  <td>
    <div class="recipients-cell">
      <div class="recipients-list">
        @for (recipient of item.recipients; track recipient.id) {
        <div class="recipient-item">
          <span class="recipient-type">{{ recipient.recipient_type }}</span>
          <span class="recipient-name">{{ recipient.recipient_name }}</span>
        </div>
        }
        @if (item.recipients.length === 0) {
        <span class="text-muted">No recipients</span>
        }
      </div>
    </div>
  </td>
  <td>
    <span class="title-text">{{ item.title }}</span>
  </td>
  <td class="text-end">
    <a class="view-link" [routerLink]="['/announcements/view', item.id]">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M9 6.1875C7.4467 6.1875 6.1875 7.4467 6.1875 9C6.1875 10.5533 7.4467 11.8125 9 11.8125C10.5533 11.8125 11.8125 10.5533 11.8125 9C11.8125 7.4467 10.5533 6.1875 9 6.1875ZM7.3125 9C7.3125 8.06802 8.06802 7.3125 9 7.3125C9.93198 7.3125 10.6875 8.06802 10.6875 9C10.6875 9.93198 9.93198 10.6875 9 10.6875C8.06802 10.6875 7.3125 9.93198 7.3125 9Z"
          fill="#377AFD" />
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M9 2.4375C5.6144 2.4375 3.33397 4.46565 2.01043 6.18515L1.98656 6.21615C1.68723 6.6049 1.41155 6.96294 1.22452 7.3863C1.02423 7.83965 0.9375 8.33377 0.9375 9C0.9375 9.66623 1.02423 10.1603 1.22452 10.6137C1.41155 11.0371 1.68723 11.3951 1.98656 11.7839L2.01043 11.8149C3.33397 13.5344 5.6144 15.5625 9 15.5625C12.3856 15.5625 14.666 13.5344 15.9896 11.8149L16.0134 11.7839C16.3128 11.3951 16.5885 11.0371 16.7755 10.6137C16.9758 10.1603 17.0625 9.66623 17.0625 9C17.0625 8.33377 16.9758 7.83965 16.7755 7.3863C16.5885 6.96293 16.3128 6.60489 16.0134 6.21613L15.9896 6.18515C14.666 4.46565 12.3856 2.4375 9 2.4375ZM2.90191 6.87135C4.12398 5.28369 6.11277 3.5625 9 3.5625C11.8872 3.5625 13.876 5.28369 15.0981 6.87135C15.427 7.29869 15.6197 7.55404 15.7464 7.84091C15.8649 8.10901 15.9375 8.4367 15.9375 9C15.9375 9.5633 15.8649 9.89099 15.7464 10.1591C15.6197 10.446 15.427 10.7013 15.0981 11.1287C13.876 12.7163 11.8872 14.4375 9 14.4375C6.11277 14.4375 4.12398 12.7163 2.90191 11.1287C2.57298 10.7013 2.3803 10.446 2.25357 10.1591C2.13513 9.89099 2.0625 9.5633 2.0625 9C2.0625 8.4367 2.13513 8.10901 2.25357 7.84091C2.3803 7.55404 2.57298 7.29869 2.90191 6.87135Z"
          fill="#377AFD" />
      </svg>

      <span>View</span>
    </a>
  </td>
</ng-template>

<ng-template #emptyState>
  <tr>
    <td colspan="3" class="text-center py-4">
      <div class="empty-state">No announcements found</div>
    </td>
  </tr>
</ng-template>

<!-- filter overlay -->
<app-overlay-filter-box #filterBox [title]="'Filters'">
  <form [formGroup]="filterForm" (ngSubmit)="filter()" class="w-100 d-flex flex-column gap-3">
    <div class="input">
      <label for="recipientType">Recipient Type</label>
      <div class="form-outline w-100 position-relative custom-date-wrapper">
        <select id="recipientType" class="form-control custom-date-input" formControlName="recipient_type">
          <option value="">All Types</option>
          <option value="1">Department</option>
          <option value="2">Section</option>
          <option value="3">Employee</option>
          <option value="4">Branch</option>
          <option value="5">Company</option>
        </select>
      </div>
    </div>
    <div class="d-flex align-items-center gap-3">
      <button type="submit" class="btn btn-lg btn-primary w-100">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        <span>Apply Filter</span>
      </button>
      <a (click)="resetFilterForm()" class="text-danger-dark fw-bold w-100 text-center cursor-pointer">
        <span>Clear Filters</span>
      </a>
    </div>
  </form>
</app-overlay-filter-box>