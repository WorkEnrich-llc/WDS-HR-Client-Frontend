<!-- page header -->
<app-page-header [breadcrumbs]="breadcrumb" title="View Company Document" [create]="createdDate" [update]="updatedDate">
    <div class="d-flex gap-2">
        <button class="btn btn-lg btn-outline-danger w-auto" (click)="openDeleteModal()" [disabled]="isDeleting">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                <path fill="currentColor"
                    d="M12 2.75a2.25 2.25 0 0 0-2.122 1.5a.75.75 0 0 1-1.414-.5a3.751 3.751 0 0 1 7.073 0a.75.75 0 0 1-1.415.5A2.25 2.25 0 0 0 12 2.75M2.75 6a.75.75 0 0 1 .75-.75h17a.75.75 0 0 1 0 1.5h-17A.75.75 0 0 1 2.75 6m3.165 2.45a.75.75 0 1 0-1.497.1l.464 6.952c.085 1.282.154 2.318.316 3.132c.169.845.455 1.551 1.047 2.104s1.315.793 2.17.904c.822.108 1.86.108 3.146.108h.879c1.285 0 2.324 0 3.146-.108c.854-.111 1.578-.35 2.17-.904c.591-.553.877-1.26 1.046-2.104c.162-.814.23-1.85.316-3.132l.464-6.952a.75.75 0 0 0-1.497-.1l-.46 6.9c-.09 1.347-.154 2.285-.294 2.99c-.137.685-.327 1.047-.6 1.303c-.274.256-.648.422-1.34.512c-.713.093-1.653.095-3.004.095h-.774c-1.35 0-2.29-.002-3.004-.095c-.692-.09-1.066-.256-1.34-.512c-.273-.256-.463-.618-.6-1.303c-.14-.705-.204-1.643-.294-2.99z" />
                <path fill="currentColor"
                    d="M9.425 10.254a.75.75 0 0 1 .821.671l.5 5a.75.75 0 0 1-1.492.15l-.5-5a.75.75 0 0 1 .671-.821m5.821.821a.75.75 0 0 0-1.492-.15l-.5 5a.75.75 0 0 0 1.492.15z" />
            </svg>
            <span>Delete Document</span>
        </button>
    </div>
</app-page-header>

<!-- content -->
<div class="content-hug">
    <div class="content-box">
        <!-- Loading State -->
        @if (isLoading) {
        <div class="skeleton-container">
            <div class="skeleton-line skeleton-title"></div>
            <div class="skeleton-meta">
                <div class="skeleton-line skeleton-meta-line"></div>
                <div class="skeleton-line skeleton-meta-line"></div>
            </div>
            <div class="skeleton-body">
                <div class="skeleton-line skeleton-body-line"></div>
                <div class="skeleton-line skeleton-body-line"></div>
                <div class="skeleton-line skeleton-body-line short"></div>
            </div>
        </div>
        }

        <!-- Document Details -->
        @if (documentDetails && !isLoading) {
        <div class="content-box d-flex flex-column gap-4">
            <h2 class="section-title">Document Information</h2>
            <div class="d-flex flex-column gap-3">
                <!-- Document Name Field -->
                <div class="field-item">
                    <label class="field-label">Document Name</label>
                    <div class="field-value">{{ documentDetails.name || 'N/A' }}</div>
                </div>

                @if (documentDetails.info?.file_name) {
                <!-- File Name Field -->
                <div class="field-item">
                    <label class="field-label">File</label>
                    <div class="field-value">
                        <a href="javascript:void(0)" (click)="openDocument(documentDetails.document_url)"
                            class="text-primary">
                            {{ documentDetails.info.file_name }}
                        </a>
                    </div>
                </div>
                }

                @if (documentDetails.info?.file_type) {
                <!-- File Type Field -->
                <div class="field-item">
                    <label class="field-label">File Type</label>
                    <div class="field-value">
                        <span class="badge bg-secondary">{{ documentDetails.info.file_type }}</span>
                    </div>
                </div>
                }

                @if (documentDetails.info?.file_size_kb) {
                <!-- File Size Field -->
                <div class="field-item">
                    <label class="field-label">File Size</label>
                    <div class="field-value">{{ formatFileSize(documentDetails.info.file_size_kb) }}</div>
                </div>
                }
            </div>
        </div>
        }

        <!-- Error State -->
        @if (!documentDetails && !isLoading) {
        <div class="error-state">
            <div class="error-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="15" y1="9" x2="9" y2="15" />
                    <line x1="9" y1="9" x2="15" y2="15" />
                </svg>
            </div>
            <h3>Document Not Found</h3>
            <p>The requested document could not be found or may have been deleted.</p>
            <button class="btn btn-primary" (click)="goBack()">Back to Company Documents</button>
        </div>
        }
    </div>
</div>

<!-- Delete Confirmation Modal -->
<app-popup [title]="'Delete Document'"
    [paragraph1]="'Are you Sure you want to Delete this document: ' + (documentDetails?.name || '')"
    [paragraph2]="'This action cannot be undone!'" [isOpen]="isDeleteModalOpen" (close)="closeDeleteModal()">
    <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDelete()" [disabled]="isDeleting">
        @if(isDeleting){
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        }@else{
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <path fill="currentColor"
                d="M12 2.75a2.25 2.25 0 0 0-2.122 1.5a.75.75 0 0 1-1.414-.5a3.751 3.751 0 0 1 7.073 0a.75.75 0 0 1-1.415.5A2.25 2.25 0 0 0 12 2.75M2.75 6a.75.75 0 0 1 .75-.75h17a.75.75 0 0 1 0 1.5h-17A.75.75 0 0 1 2.75 6m3.165 2.45a.75.75 0 1 0-1.497.1l.464 6.952c.085 1.282.154 2.318.316 3.132c.169.845.455 1.551 1.047 2.104s1.315.793 2.17.904c.822.108 1.86.108 3.146.108h.879c1.285 0 2.324 0 3.146-.108c.854-.111 1.578-.35 2.17-.904c.591-.553.877-1.26 1.046-2.104c.162-.814.23-1.85.316-3.132l.464-6.952a.75.75 0 0 0-1.497-.1l-.46 6.9c-.09 1.347-.154 2.285-.294 2.99c-.137.685-.327 1.047-.6 1.303c-.274.256-.648.422-1.34.512c-.713.093-1.653.095-3.004.095h-.774c-1.35 0-2.29-.002-3.004-.095c-.692-.09-1.066-.256-1.34-.512c-.273-.256-.463-.618-.6-1.303c-.14-.705-.204-1.643-.294-2.99z" />
            <path fill="currentColor"
                d="M9.425 10.254a.75.75 0 0 1 .821.671l.5 5a.75.75 0 0 1-1.492.15l-.5-5a.75.75 0 0 1 .671-.821m5.821.821a.75.75 0 0 0-1.492-.15l-.5 5a.75.75 0 0 0 1.492.15z" />
        </svg>
        }
        <span>Delete</span>
    </button>
    <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeleteModal()">
        Close
    </button>
</app-popup>