<!-- start page header -->
<app-page-header [breadcrumbs]="breadcrumb" title="Integrations">
  <div class="d-flex align-items-center justify-content-end gap-4 w-100">
    <!-- Text element -->
    <div class="documentation-text">
      <h6 class="mb-0">Check our
        documentation to
        integrate with any
        service</h6>
    </div>

    <!-- Button element -->
    <a href="https://talentdot.apidog.io/" target="_blank" class="btn documentation-btn" title="View Documentation">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_588_11993)">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M11.7083 1.18786C12.9508 1.01036 14.0625 1.9745 14.0625 3.22964V4.26201C14.9546 4.73357 15.5625 5.67085 15.5625 6.75012V14.2501C15.5625 15.8034 14.3033 17.0626 12.75 17.0626H5.25C3.6967 17.0626 2.4375 15.8034 2.4375 14.2501V3.75012C2.4375 3.74315 2.43763 3.7362 2.43788 3.72929C2.43763 3.7185 2.4375 3.70767 2.4375 3.69682C2.4375 3.01713 2.93729 2.44087 3.61015 2.34475L11.7083 1.18786ZM3.5625 5.06262V14.2501C3.5625 15.1821 4.31802 15.9376 5.25 15.9376H12.75C13.682 15.9376 14.4375 15.1821 14.4375 14.2501V6.75012C14.4375 5.81814 13.682 5.06262 12.75 5.06262H3.5625ZM3.8033 3.93762H12.9375V3.22964C12.9375 2.65912 12.4322 2.22087 11.8674 2.30156L3.76925 3.45844C3.65062 3.47539 3.5625 3.57698 3.5625 3.69682C3.5625 3.82981 3.67031 3.93762 3.8033 3.93762ZM5.4375 9.00012C5.4375 8.68946 5.68934 8.43762 6 8.43762H12C12.3107 8.43762 12.5625 8.68946 12.5625 9.00012C12.5625 9.31078 12.3107 9.56262 12 9.56262H6C5.68934 9.56262 5.4375 9.31078 5.4375 9.00012ZM5.4375 11.6251C5.4375 11.3145 5.68934 11.0626 6 11.0626H10.125C10.4357 11.0626 10.6875 11.3145 10.6875 11.6251C10.6875 11.9358 10.4357 12.1876 10.125 12.1876H6C5.68934 12.1876 5.4375 11.9358 5.4375 11.6251Z"
            fill="#377AFD" />
        </g>
        <defs>
          <clipPath id="clip0_588_11993">
            <rect width="18" height="18" fill="white" />
          </clipPath>
        </defs>
      </svg>

      <span class="ms-2">Documentation</span>
    </a>
  </div>
</app-page-header>
<!-- end page header -->

<!-- start page content -->
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">

    <!-- start search and filter -->
    <div class="d-flex flex-column flex-lg-row align-items-start align-lg-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-2 w-100 w-lg-50">
        <!-- Search input -->
        <div class="form-outline w-25">
          <input type="text" class="form-control" placeholder="Search" (ngModelChange)="onSearchChange()"
            [(ngModel)]="searchTerm" />
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <circle cx="11.5" cy="11.5" r="9.5" />
              <path stroke-linecap="round" d="M18.5 18.5L22 22" />
            </g>
          </svg>
        </div>

        <!-- Filter button -->
        <button class="btn btn-lg btn-outline-primary" (click)="filterBox.openOverlay()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
            <path fill="none" stroke-width="1.5"
              d="M19 3H5c-1.414 0-2.121 0-2.56.412S2 4.488 2 5.815v.69c0 1.037 0 1.556.26 1.986s.733.698 1.682 1.232l2.913 1.64c.636.358.955.537 1.183.735c.474.411.766.895.898 1.49c.064.284.064.618.064 1.285v2.67c0 .909 0 1.364.252 1.718c.252.355.7.53 1.594.88c1.879.734 2.818 1.101 3.486.683S15 19.452 15 17.542v-2.67c0-.666 0-1 .064-1.285a2.68 2.68 0 0 1 .899-1.49c.227-.197.546-.376 1.182-.735l2.913-1.64c.948-.533 1.423-.8 1.682-1.23c.26-.43.26-.95.26-1.988v-.69c0-1.326 0-1.99-.44-2.402C21.122 3 20.415 3 19 3Z" />
          </svg>
          <span>Filter</span>
        </button>
      </div>

      <!-- New Integration Key button -->
      <button class="btn btn-lg btn-primary px-4" routerLink="/integrations/create-integration">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#clip0_588_11252)">
            <g clip-path="url(#clip1_588_11252)">
              <path
                d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z"
                fill="#E0EBFF" />
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75C17.1086 2.75 21.25 6.89137 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12Z"
                fill="#E0EBFF" />
            </g>
          </g>
          <defs>
            <clipPath id="clip0_588_11252">
              <rect width="24" height="24" fill="white" />
            </clipPath>
            <clipPath id="clip1_588_11252">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>

        <span>New Integration Key</span>
      </button>
    </div>
    <!-- end search and filter -->

    <!-- start Table -->
    <app-table [data]="integrations" [isLoading]="loadData" [columnsCount]="7" [currentPage]="currentPage"
      [totalItems]="totalItems" [itemsPerPage]="itemsPerPage" (pageChange)="onPageChange($event)"
      (itemsPerPageChange)="onItemsPerPageChange($event)" [headerTemplate]="integrationsTableHeader"
      [rowTemplate]="integrationsTableRow" [emptyTemplate]="noIntegrations">
    </app-table>

    <!-- Table Header Template -->
    <ng-template #integrationsTableHeader>
      <th scope="col" (click)="sortBy('integrationName')" style="cursor: pointer;" class="w-30">
        <div class="d-flex align-items-center justify-content-between gap-3">
          <span>Integration Name</span>
          <svg xmlns="http://www.w3.org/2000/svg" *ngIf="sortDirection === 'desc'" width="24" height="24"
            viewBox="0 0 24 24">
            <g fill="none" stroke="#DDE3EB" stroke-linecap="round" stroke-width="1.5">
              <path d="M4 8h9m-7 5h7m-5 5h5" />
              <path stroke-linejoin="round" d="M17 20V4l3 4" />
            </g>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" *ngIf="sortDirection === 'asc'" width="24" height="24"
            viewBox="0 0 24 24">
            <path fill="#DDE3EB" fill-rule="evenodd"
              d="M17 3.25a.75.75 0 0 1 .75.75v13.75l1.65-2.2a.75.75 0 1 1 1.2.9l-3 4a.75.75 0 0 1-1.35-.45V4a.75.75 0 0 1 .75-.75M7.25 6A.75.75 0 0 1 8 5.25h5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 6m-2 5a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75m-2 5a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5H4a.75.75 0 0 1-.75-.75"
              clip-rule="evenodd" />
          </svg>
        </div>
      </th>
      <th scope="col" (click)="sortBy('createDate')" style="cursor: pointer;">Create Date</th>
      <th scope="col" (click)="sortBy('expiryDate')" style="cursor: pointer;">Expiry Date</th>
      <th scope="col" (click)="sortBy('status')" style="cursor: pointer;">Status</th>
      <th scope="col" (click)="sortBy('key')" style="cursor: pointer;">Key</th>
      <th scope="col">Actions</th>
    </ng-template>

    <!-- Table Row Template -->
    <ng-template #integrationsTableRow let-integration>
      <td class="cursor-pointer">
        <span class="d-block text-gray-sm">{{ integration.id.toString().padStart(3, '0') }}</span>
        <span class="d-block text-truncate">{{ integration.integrationName }}</span>
      </td>
      <td class="cursor-pointer">{{ integration.createDate }}</td>
      <td class="cursor-pointer">{{ integration.expiryDate }}</td>
      <td class="cursor-pointer">
        @switch (integration.status) {
        @case (userStatus.Active) {
        <span class="badge-success">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10" />
              <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
            </g>
          </svg>
          <span>Active</span>
        </span>
        }
        @case (userStatus.Inactive) {
        <span class="badge-gray">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" d="m18.5 5.5l-13 13" />
              <circle cx="12" cy="12" r="10" />
            </g>
          </svg>
          <span>Inactive</span>
        </span>
        }
        @case (userStatus.Expired) {
        <span class="badge-danger">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M9 4.6875C9.31066 4.6875 9.5625 4.93934 9.5625 5.25V9.75C9.5625 10.0607 9.31066 10.3125 9 10.3125C8.68934 10.3125 8.4375 10.0607 8.4375 9.75V5.25C8.4375 4.93934 8.68934 4.6875 9 4.6875Z"
              fill="#E04F5F" />
            <path
              d="M9 12.75C9.41421 12.75 9.75 12.4142 9.75 12C9.75 11.5858 9.41421 11.25 9 11.25C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75Z"
              fill="#E04F5F" />
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M9 1.5C4.85786 1.5 1.5 4.85786 1.5 9C1.5 13.1421 4.85786 16.5 9 16.5C13.1421 16.5 16.5 13.1421 16.5 9C16.5 4.85786 13.1421 1.5 9 1.5ZM3 9C3 5.68629 5.68629 3 9 3C12.3137 3 15 5.68629 15 9C15 12.3137 12.3137 15 9 15C5.68629 15 3 12.3137 3 9Z"
              fill="#E04F5F" />
          </svg>
          <span>Expired</span>
        </span>
        }
        }
      </td>
      <td class="cursor-pointer">
        <span class="text-truncate d-inline-block" style="max-width: 150px;" [title]="integration.key">
          {{ integration.key }}
        </span>
      </td>
      <td>
        <div class="d-flex align-items-center gap-2">
          <!-- Copy button (show for all rows) -->
          <button class="btn btn-sm" [class]="copiedKeyId === integration.id ? 'btn-success' : 'btn-outline-secondary'"
            (click)="copyKey(integration.key, integration.id)"
            [title]="copiedKeyId === integration.id ? 'Copied!' : 'Copy Key'">
            <svg *ngIf="copiedKeyId !== integration.id" xmlns="http://www.w3.org/2000/svg" width="14" height="14"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <svg *ngIf="copiedKeyId === integration.id" xmlns="http://www.w3.org/2000/svg" width="14" height="14"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            <span *ngIf="copiedKeyId === integration.id" class="ms-1">Copied!</span>
          </button>

          <!-- Edit button -->
          <button class="btn btn-sm btn-outline-primary" (click)="editIntegration(integration)" title="Edit">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span>Edit</span>
          </button>

          <!-- Activate/Deactivate button -->
          <button class="btn btn-sm"
            [class]="integration.status === userStatus.Active ? 'btn-outline-danger' : 'btn-outline-success'"
            (click)="toggleIntegrationStatus(integration)"
            [title]="integration.status === userStatus.Active ? 'Deactivate' : 'Activate'">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
              <line x1="6" y1="6" x2="6" y2="18"></line>
            </svg>
            <span>{{ integration.status === userStatus.Active ? 'Deactivate' : 'Activate' }}</span>
          </button>
        </div>
      </td>
    </ng-template>

    <!-- Empty State Template -->
    <ng-template #noIntegrations>
      <td colspan="7" class="text-center py-4">
        <div class="d-flex flex-column align-items-center justify-content-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" />
            <path d="M16 16s-1.5-2-4-2-4 2-4 2" />
            <line x1="9" y1="9" x2="9.01" y2="9" />
            <line x1="15" y1="9" x2="15.01" y2="9" />
          </svg>
          <p class="text-muted mb-0">No integrations found</p>
        </div>
      </td>
    </ng-template>
    <!-- end Table -->

    <!-- Filter Overlay -->
    <app-overlay-filter-box #filterBox [title]="'Filters'">
      <form [formGroup]="filterForm" (ngSubmit)="filter()" class="w-100 d-flex flex-column gap-3">
        <!-- Created at Filter -->
        <div class="input">
          <label for="createdAt">Created at</label>
          <div class="d-flex align-items-center gap-4">
            <div class="form-outline w-100 position-relative custom-date-wrapper">
              <input formControlName="created_at" type="date" id="createdAt" class="form-control custom-date-input"
                placeholder="Select date" />
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <g fill="none" stroke-width="1.5">
                  <path stroke-linecap="round"
                    d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
                  <circle cx="18" cy="18" r="3" />
                  <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
                </g>
              </svg>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              (click)="clearFilter('created_at')" *ngIf="filterForm.get('created_at')?.value" class="cursor-pointer">
              <path fill="#e04f5f"
                d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
              <path fill="#e04f5f" fill-rule="evenodd"
                d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                clip-rule="evenodd" />
            </svg>
          </div>
        </div>

        <!-- Expiry at Filter -->
        <div class="input">
          <label for="expiryAt">Expiry at</label>
          <div class="d-flex align-items-center gap-4">
            <div class="form-outline w-100 position-relative custom-date-wrapper">
              <input formControlName="expiry_at" type="date" id="expiryAt" class="form-control custom-date-input"
                placeholder="Select date" />
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <g fill="none" stroke-width="1.5">
                  <path stroke-linecap="round"
                    d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
                  <circle cx="18" cy="18" r="3" />
                  <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
                </g>
              </svg>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              (click)="clearFilter('expiry_at')" *ngIf="filterForm.get('expiry_at')?.value" class="cursor-pointer">
              <path fill="#e04f5f"
                d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
              <path fill="#e04f5f" fill-rule="evenodd"
                d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                clip-rule="evenodd" />
            </svg>
          </div>
        </div>

        <!-- Status Filter -->
        <div class="input">
          <label for="status">Status</label>
          <div class="d-flex align-items-center gap-4">
            <div class="form-outline w-100 position-relative custom-date-wrapper">
              <select formControlName="status" name="" id="status" class="form-select">
                <option value="" selected disabled hidden>Select</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="expired">Expired</option>
              </select>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              (click)="clearFilter('status')" *ngIf="filterForm.get('status')?.value" class="cursor-pointer">
              <path fill="#e04f5f"
                d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
              <path fill="#e04f5f" fill-rule="evenodd"
                d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                clip-rule="evenodd" />
            </svg>
          </div>
        </div>

        <!-- Filter Buttons -->
        <div class="d-flex align-items-center gap-3">
          <button type="submit" class="btn btn-lg btn-primary w-100">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <g fill="none" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
              </g>
            </svg>
            <span>Apply Filter</span>
          </button>
          <a (click)="resetFilterForm()" type="button"
            class="text-danger-dark fw-bold w-100 text-center cursor-pointer">
            <span>Clear Filters</span>
          </a>
        </div>
      </form>
    </app-overlay-filter-box>

  </div>
</div>
<!-- end page content -->

<!-- Status Change Confirmation Modal -->
<app-popup [title]="modalAction === 'deactivate' ? 'Deactivate Integration' : 'Activate Integration'"
  [paragraph1]="modalAction === 'deactivate' ? 'Are you sure you want to deactivate this integration?' : 'Are you sure you want to activate this integration?'"
  [paragraph2]="modalAction === 'deactivate' ? 'This will disable the integration and it will no longer be accessible.' : 'This will enable the integration and make it accessible again.'"
  [isOpen]="isStatusModalOpen" (close)="closeStatusModal()">
  <button modal-btn-left
    [class]="modalAction === 'deactivate' ? 'btn btn-lg btn-danger w-100' : 'btn btn-lg btn-success w-100'"
    (click)="confirmStatusChange()">
    {{ modalAction === 'deactivate' ? 'Confirm Deactivate' : 'Confirm Activate' }}
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeStatusModal()">
    Cancel
  </button>
</app-popup>