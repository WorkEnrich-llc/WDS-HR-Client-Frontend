<!-- page header -->
<app-page-header [breadcrumbs]="breadcrumb" title="View Email Settings" [create]="createdDate" [update]="updatedDate">
    <div class="d-flex gap-2">
        <button class="btn btn-lg btn-primary px-5" routerLink="/email-settings/manage">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                <path fill="currentColor" fill-rule="evenodd"
                    d="M14.1 2.391a3.896 3.896 0 0 1 5.509 5.51l-7.594 7.594c-.428.428-.69.69-.98.917a6 6 0 0 1-1.108.684c-.334.159-.685.276-1.259.467l-2.672.891l-.642.214a1.598 1.598 0 0 1-2.022-2.022l1.105-3.314c.191-.574.308-.925.467-1.259a6 6 0 0 1 .685-1.107c.227-.291.488-.553.916-.98zM5.96 16.885l-.844-.846l.728-2.185c.212-.636.3-.895.414-1.135q.212-.443.513-.83c.164-.21.356-.404.83-.879l5.891-5.89a6.05 6.05 0 0 0 1.349 2.04a6.05 6.05 0 0 0 2.04 1.348l-5.891 5.89c-.475.475-.668.667-.878.83q-.388.302-.83.514c-.24.114-.5.202-1.136.414zm12.116-9.573a4 4 0 0 1-.455-.129a4.5 4.5 0 0 1-1.72-1.084a4.54 4.54 0 0 1-1.084-1.72a4 4 0 0 1-.13-.455l.473-.472a2.396 2.396 0 0 1 3.388 3.388zM3.25 22a.75.75 0 0 1 .75-.75h16v1.5H4a.75.75 0 0 1-.75-.75"
                    clip-rule="evenodd" />
            </svg>
            <span>Edit</span>
        </button>
        @if (emailSettings?.is_active) {
        <button class="btn btn-lg btn-outline-danger px-5" (click)="openDeactivate()">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                    d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
            </svg>
            <span>Deactivate</span>
        </button>
        } @else {
        <button class="btn btn-lg btn-outline-success px-5" (click)="openActivate()">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                    d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
            </svg>
            <span>Activate</span>
        </button>
        }
    </div>
</app-page-header>

<!-- content -->
<div class="content-hug">
    @if (isLoading) {
    <div class="content-box d-flex flex-column gap-3">
        <div class="skeleton-loader">
            <div class="skeleton-line" style="height: 32px; width: 60%; margin-bottom: 16px;"></div>
            <div class="skeleton-line" style="height: 20px; width: 40%; margin-bottom: 24px;"></div>
        </div>
    </div>
    } @else {
    @if (!emailSettings) {
    <div class="content-box d-flex flex-column gap-3">
        <div class="info">
            <span class="d-block">No email settings found</span>
        </div>
    </div>
    } @else {
    <!-- Credentials Section -->
    <div class="content-box d-flex flex-column gap-3 mt-4">
        <h2 class="section-title">Credentials</h2>
        <div class="d-flex flex-column gap-3">
            <!-- Email Field -->
            <div class="field-item">
                <label class="field-label">Email</label>
                <div class="field-value">{{ emailSettings.host_user || 'N/A' }}</div>
            </div>
            <!-- Password Field -->
            <div class="field-item">
                <label class="field-label">Password</label>
                <div class="field-value">{{ emailSettings.host_password ? '**********' : 'N/A' }}</div>
            </div>
        </div>
    </div>

    <!-- Technical Details Section -->
    <div class="content-box d-flex flex-column gap-3 mt-4">
        <h2 class="section-title">Technical Details</h2>
        <div class="d-flex flex-column gap-3">
            <!-- SMTP Server Field -->
            <div class="field-item">
                <label class="field-label">SMTP Server</label>
                <div class="field-value">{{ emailSettings.host || 'N/A' }}</div>
            </div>
            <!-- SMTP Port Field -->
            <div class="field-item">
                <label class="field-label">SMTP Port</label>
                <div class="field-value">{{ emailSettings.port || 'N/A' }}</div>
            </div>
            <!-- Use Field -->
            <div class="field-item">
                <div class="tls-badge-container">
                    @if (emailSettings.use?.name) {
                    <button class="badge-success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19L21 7l-1.41-1.41z" />
                        </svg>
                        {{ emailSettings.use.name }}
                    </button>
                    } @else {
                    <button class="badge-warning">N/A</button>
                    }
                </div>
            </div>
        </div>
    </div>
    }
    }
</div>

<!-- Deactivate Confirmation Modal -->
<app-popup [title]="'Deactivate Email Settings'"
    [paragraph1]="'Are you sure you want to deactivate the email settings?'"
    [paragraph2]="'This will disable the email settings. You can activate it at any time later.'"
    [isOpen]="deactivateOpen" (close)="closeDeactivate()">
    <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDeactivate()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
        </svg>
        <span>Deactivate</span>
    </button>
    <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeactivate()">
        Cancel
    </button>
</app-popup>

<!-- Activate Confirmation Modal -->
<app-popup [title]="'Activate Email Settings'" [paragraph1]="'Are you sure you want to activate the email settings?'"
    [paragraph2]="'This will enable the email settings. You can deactivate it at any time later.'"
    [isOpen]="activateOpen" (close)="closeActivate()">
    <button modal-btn-left class="btn btn-lg btn-success w-100" (click)="confirmActivate()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
        </svg>
        <span>Activate</span>
    </button>
    <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeActivate()">
        Cancel
    </button>
</app-popup>