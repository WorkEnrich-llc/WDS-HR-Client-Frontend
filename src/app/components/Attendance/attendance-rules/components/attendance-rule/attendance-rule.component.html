<!-- start page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Attendance', link: '/attendance' },
    { label: 'Attendance Rules' }
  ]" title="Attendance Rules">
</app-page-header>
<!-- end page header -->

<div class="content-hug">
  <!-- Loading state -->
  @if (loading || salaryPortionsLoading) {
  <!-- Full-Time Skeleton -->
  <div class="content-box d-flex flex-column gap-3">
    <div class="d-flex align-items-center justify-content-between">
      <div class="skeleton-block" style="width: 120px; height: 32px;"></div>
      <div class="skeleton-block" style="width: 100px; height: 38px;"></div>
    </div>
    <div class="info">
      <div class="skeleton-block" style="width: 100px; height: 20px; margin-bottom: 8px;"></div>
      <div class="skeleton-block" style="width: 200px; height: 18px;"></div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="w-70">Penalty Type</th>
            <th class="w-10">1st</th>
            <th class="w-10">2nd</th>
            <th class="w-10">3rd</th>
          </tr>
        </thead>
        <tbody>
          @for (i of [1, 2, 3]; track i) {
          <tr>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Part-Time Skeleton -->
  <div class="content-box d-flex flex-column gap-3 mt-4">
    <div class="d-flex align-items-center justify-content-between">
      <div class="skeleton-block" style="width: 120px; height: 32px;"></div>
      <div class="skeleton-block" style="width: 100px; height: 38px;"></div>
    </div>
    <div class="info">
      <div class="skeleton-block" style="width: 100px; height: 20px; margin-bottom: 8px;"></div>
      <div class="skeleton-block" style="width: 200px; height: 18px;"></div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="w-70">Penalty Type</th>
            <th class="w-10">1st</th>
            <th class="w-10">2nd</th>
            <th class="w-10">3rd</th>
          </tr>
        </thead>
        <tbody>
          @for (i of [1, 2, 3]; track i) {
          <tr>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
            <td>
              <div class="skeleton-block" style="height: 20px;"></div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }

  <!-- Error state -->
  @if (error && !loading) {
  <div class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-outline-danger btn-sm ms-3" (click)="loadAttendanceRules()">
      Retry
    </button>
  </div>
  }

  <!-- Full-Time Rules -->
  @if (!loading && !error && attendanceRulesData) {
  <div class="content-box d-flex flex-column gap-3">
    <div class="d-flex align-items-center justify-content-between">
      <h2>Full-Time</h2>
      <button class="btn btn-outline-primary" routerLink="/attendance-rules/full-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="currentColor" fill-rule="evenodd"
            d="M14.1 2.391a3.896 3.896 0 0 1 5.509 5.51l-7.594 7.594c-.428.428-.69.69-.98.917a6 6 0 0 1-1.108.684c-.334.159-.685.276-1.259.467l-2.672.891l-.642.214a1.598 1.598 0 0 1-2.022-2.022l1.105-3.314c.191-.574.308-.925.467-1.259a6 6 0 0 1 .685-1.107c.227-.291.488-.553.916-.98zM5.96 16.885l-.844-.846l.728-2.185c.212-.636.3-.895.414-1.135q.212-.443.513-.83c.164-.21.356-.404.83-.879l5.891-5.89a6.05 6.05 0 0 0 1.349 2.04a6.05 6.05 0 0 0 2.04 1.348l-5.891 5.89c-.475.475-.668.667-.878.83q-.388.302-.83.514c-.24.114-.5.202-1.136.414zm12.116-9.573a4 4 0 0 1-.455-.129a4.5 4.5 0 0 1-1.72-1.084a4.54 4.54 0 0 1-1.084-1.72a4 4 0 0 1-.13-.455l.473-.472a2.396 2.396 0 0 1 3.388 3.388zM3.25 22a.75.75 0 0 1 .75-.75h16v1.5H4a.75.75 0 0 1-.75-.75"
            clip-rule="evenodd" />
        </svg>
        <span>Edit</span>
      </button>
    </div>
    <div class="info">
      <h6>Grace Period</h6>
      <span>{{ getGracePeriodText(getFullTimeSettings()) }}</span>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="w-70">Penalty Type</th>
            <th class="w-10">1st</th>
            <th class="w-10">2nd</th>
            <th class="w-10">3rd</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Lateness</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getFullTimeSettings()?.lateness || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
          <tr>
            <td>Early Leave</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getFullTimeSettings()?.early_leave || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
          <tr>
            <td>Absence</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getFullTimeSettings()?.absence || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  }


  @if (!loading && !error && attendanceRulesData) {
  <div class="content-box d-flex flex-column gap-3 mt-4">
    <div class="d-flex align-items-center justify-content-between">
      <h2>Part-Time</h2>
      <button class="btn btn-outline-primary" routerLink="/attendance-rules/part-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="currentColor" fill-rule="evenodd"
            d="M14.1 2.391a3.896 3.896 0 0 1 5.509 5.51l-7.594 7.594c-.428.428-.69.69-.98.917a6 6 0 0 1-1.108.684c-.334.159-.685.276-1.259.467l-2.672.891l-.642.214a1.598 1.598 0 0 1-2.022-2.022l1.105-3.314c.191-.574.308-.925.467-1.259a6 6 0 0 1 .685-1.107c.227-.291.488-.553.916-.98zM5.96 16.885l-.844-.846l.728-2.185c.212-.636.3-.895.414-1.135q.212-.443.513-.83c.164-.21.356-.404.83-.879l5.891-5.89a6.05 6.05 0 0 0 1.349 2.04a6.05 6.05 0 0 0 2.04 1.348l-5.891 5.89c-.475.475-.668.667-.878.83q-.388.302-.83.514c-.24.114-.5.202-1.136.414zm12.116-9.573a4 4 0 0 1-.455-.129a4.5 4.5 0 0 1-1.72-1.084a4.54 4.54 0 0 1-1.084-1.72a4 4 0 0 1-.13-.455l.473-.472a2.396 2.396 0 0 1 3.388 3.388zM3.25 22a.75.75 0 0 1 .75-.75h16v1.5H4a.75.75 0 0 1-.75-.75"
            clip-rule="evenodd" />
        </svg>
        <span>Edit</span>
      </button>
    </div>
    <div class="info">
      <h6>Grace Period</h6>
      <span>{{ getGracePeriodText(getPartTimeSettings()) }}</span>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="w-70">Penalty Type</th>
            <th class="w-10">1st</th>
            <th class="w-10">2nd</th>
            <th class="w-10">3rd</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Lateness</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getPartTimeSettings()?.lateness || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
          <tr>
            <td>Early Leave</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getPartTimeSettings()?.early_leave || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
          <tr>
            <td>Absence</td>
            @for (occurrence of [1, 2, 3]; track occurrence) {
            @let penaltyData = getPenaltyWithSalaryPortion(getPartTimeSettings()?.absence || [], occurrence);
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ penaltyData.value }}</span>
                @if (penaltyData.salaryPortion) {
                <span class="text-muted small mt-1 salary-portion-text"
                  [attr.data-tooltip]="penaltyData.salaryPortion && penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6 ? getSalaryPortionDisplayText(penaltyData.salaryPortion) : null">
                  @if (penaltyData.salaryPortion.name && penaltyData.salaryPortion.name.length > 6) {
                  {{ truncateName(penaltyData.salaryPortion.name) }} ({{ penaltyData.salaryPortion.percentage }}%)
                  } @else {
                  {{ penaltyData.salaryPortion.name }} ({{ penaltyData.salaryPortion.percentage }}%)
                  }
                </span>
                }
              </div>
            </td>
            }
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  }


</div>