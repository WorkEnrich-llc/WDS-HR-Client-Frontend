<!-- page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Attendance', link: '/attendance' },
    { label: 'Leave Types', link: '/leave-types' },
    { label: 'Create New Leave Type' }
  ]" title="Create New Leave Type" [create]="todayFormatted">
  <button class="btn btn-lg btn-success w-auto"
    [disabled]="!leaveType1.valid || !leaveType2.valid || !leaveType3.valid || isLoading" (click)="createleaveType()">
    @if (isLoading) {
    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
    }
    @if (!isLoading) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
      </g>
    </svg>
    }
    <span>Create Leave Type</span>
  </button>

  <button class="btn btn-lg btn-outline-dark w-auto" (click)="openModal()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
      </g>
    </svg>
    <span>Discard Leave Type</span>
  </button>
</app-page-header>


<!-- steps -->
<ul class="nav d-flex align-items-center nav-tabs bg-white px-3">
  <li class="nav-item" [ngClass]="{
        'active': currentStep === 1,
        'text-success': currentStep > 1, 
        'bg-light-success': currentStep > 1  
    }">
    @if (currentStep == 1) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
      <path
        d="M12 17.75a.75.75 0 0 0 .75-.75v-6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75M12 7a1 1 0 1 1 0 2a1 1 0 0 1 0-2" />
    </svg>
    }
    @if (currentStep > 1) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
      [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
      <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
      <path
        d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
    </svg>
    }
    <span class="nav-link">Main Information</span>
  </li>

  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" [style.fill]="
    currentStep === 1 ? '#DDE3EB' :
    currentStep === 2 ? '#377AFD' :
    currentStep > 2 ? '#4CA883' :
    '#DDE3EB'
  ">
    <path
      d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
  </svg>


  <li class="nav-item" [ngClass]="{
        'active': currentStep === 2,
        'text-success': currentStep > 2, 
        'bg-light-success': currentStep > 2  
    }">

    @if (currentStep <= 2) { <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path [style.fill]="currentStep === 2 ? '#007bff' : '#4A6D97'"
        d="M13.752 14.5a3 3 0 1 1 6 0a3 3 0 0 1-6 0m-10-5a3 3 0 1 0 6 0a3 3 0 0 0-6 0" />
      <path [style.fill]="currentStep === 2 ? '#007bff' : '#4A6D97'"
        d="M7.462 6.584a3 3 0 0 0-1.5.021V2a.75.75 0 0 1 1.5 0zm-1.5 5.81a3 3 0 0 0 1.5.021V22a.75.75 0 0 1-1.5 0zm10 5V22a.75.75 0 0 0 1.5 0v-4.585a3 3 0 0 1-1.5-.021m1.5-5.81V2a.75.75 0 0 0-1.5 0v9.605a3 3 0 0 1 1.5-.021"
        opacity=".5" />
      </svg>
      }
      @if (currentStep > 2) {
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
        [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
        <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
        <path
          d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
      </svg>
      }
      <span class="nav-link">Leaves Settings</span>
  </li>


  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" [style.fill]="
                  currentStep === 2 ? '#377AFD' :
                  currentStep === 3 ? '#377AFD' :
                  currentStep > 3 ? '#4CA883' :
                  '#DDE3EB'
                ">
    <path
      d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
  </svg>

  <!-- Step 3 -->
  <li class="nav-item" [ngClass]="{
                    'active': currentStep === 3,
                    'text-success': currentStep > 3, 
                    'bg-light-success': currentStep > 3  
                }">
    @if (currentStep <= 3) { <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      
      <path [style.fill]="currentStep === 3 ? '#007bff' : '#4A6D97'"
        d="M12 22c-4.714 0-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12s0 7.071-1.465 8.535C19.072 22 16.714 22 12 22"
        opacity=".5" />
      <path [style.fill]="currentStep === 3 ? '#007bff' : '#4A6D97'"
        d="M10.683 18.62A6.75 6.75 0 0 0 18.75 12a.75.75 0 0 0-1.5 0A5.25 5.25 0 1 1 12 6.75a.75.75 0 0 0 0-1.5a6.75 6.75 0 0 0-1.317 13.37" />
      <path [style.fill]="currentStep === 3 ? '#007bff' : '#4A6D97'"
        d="M13.31 6.045a.75.75 0 0 1 .986-.393a7.73 7.73 0 0 1 4.052 4.052a.75.75 0 0 1-1.378.591a6.23 6.23 0 0 0-3.265-3.265a.75.75 0 0 1-.394-.985M12 9.75a.75.75 0 0 1 .75.75v.75h.75a.75.75 0 1 1 0 1.5h-.75v.75a.75.75 0 1 1-1.5 0v-.75h-.75a.75.75 0 0 1 0-1.5h.75v-.75a.75.75 0 0 1 .75-.75" />
      </svg>


      }
      @if (currentStep > 3) {
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
        [style.fill]="currentStep > 3 ? 'currentColor' : 'black'">
        <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
        <path
          d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
      </svg>
      }
      <span class="nav-link">Extra Conditions </span><small>Optional</small>
  </li>
</ul>


<!-- step 1 -->
@if (currentStep === 1) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Main Information</h2>
    <form [formGroup]="leaveType1" class="w-lg-50 d-flex flex-column gap-2">
      <div class="input">
        <label for="leaveId">Leave Type ID (Optional)</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="text" formControlName="code" id="leaveId" class="form-control custom-date-input"
            placeholder="0050" />
        </div>
      </div>
      <div class="input">
        <label for="leaveName">Leave Type Name<span>*</span></label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="text" id="leaveName" formControlName="name" class="form-control custom-date-input"
            placeholder="Leave type name" />
        </div>
        @if (leaveType1.get('name')?.touched && leaveType1.get('name')?.errors?.['minLength']) {
        <p class="error-msg">
          Leave Type Name min length must be 3.
        </p>
        }
        @if (leaveType1.get('name')?.touched && leaveType1.get('name')?.errors?.['maxLength']) {
        <p class="error-msg">
          Leave Type Name max length must be 3.
        </p>
        }
        @if (leaveType1.get('name')?.touched && leaveType1.get('name')?.errors?.['required']) {
        <p class="error-msg">
          Leave Type Name is required.
        </p>
        }
      </div>

      <div class="input">
        <label for="desc">Leave Type Description (Optional)</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <textarea type="text" formControlName="description" id="desc" class="form-control custom-date-input"
            placeholder="Describe the leave type briefly"></textarea>
        </div>
      </div>
      <div class="input">
        <label for="emptype">Employment Type</label>
        <div class="d-flex align-items-center gap-4">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <select name="emptype" formControlName="employmentType" id="emptype" class="form-select">
              <option value="" disabled selected hidden>Select Type</option>
              <option value="1">Full-Time</option>
              <option value="2">Part-Time</option>
              <option value="3">Per Hour</option>
              <option value="4">Freelance</option>
            </select>
          </div>
        </div>
        @if (leaveType1.get('employmentType')?.touched && leaveType1.get('employmentType')?.errors?.['required']) {
        <p class="error-msg">
          Employment Type is required.
        </p>
        }
      </div>
    </form>
    @if (errMsg) {
    <div class="alert alert-danger mb-0 mt-3" role="alert">
      {{errMsg}}
    </div>
    }
    <!-- next button -->
    <div class="btn-fixed">
      <button class="btn btn-lg btn-primary" [disabled]="!leaveType1.valid" (click)="goNext()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M4 12h16m0 0l-6-6m6 6l-6 6" />
        </svg>
        <span>Next (1/3)</span>
      </button>
    </div>
  </div>
</div>
}



<!-- step 2 -->
@if (currentStep === 2) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Leave Settings</h2>
    <form [formGroup]="leaveType2" class="w-lg-50 d-flex flex-column gap-2">
      <div class="input">
        <label for="accrualRate">Accrual Rate</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="number" formControlName="accrual_rate" id="accrualRate" class="form-control custom-date-input"
            placeholder="Per Month" />
        </div>
        @if (leaveType2.get('accrual_rate')?.touched && leaveType2.get('accrual_rate')?.errors?.['required']) {
        <p class="error-msg">
          Accrual Rate is required.
        </p>
        }
        @if (leaveType2.get('accrual_rate')?.touched && leaveType2.get('accrual_rate')?.errors?.['pattern']) {
        <p class="error-msg">
          Accrual Rate must be number.
        </p>
        }
      </div>
      <div class="input">
        <label for="leaveLimits">Leave Limits</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="number" formControlName="leave_limits" id="leaveLimits" class="form-control custom-date-input"
            placeholder="Per Year" />
        </div>
        @if (leaveType2.get('leave_limits')?.touched && leaveType2.get('leave_limits')?.errors?.['required']) {
        <p class="error-msg">
          Leave Limits is required.
        </p>
        }
        @if (leaveType2.get('leave_limits')?.touched && leaveType2.get('leave_limits')?.errors?.['pattern']) {
        <p class="error-msg">
          Leave Limits must be number.
        </p>
        }
      </div>
      <div class="input">
        <label for="maxReview">Max Review Days</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="number" formControlName="max_review_days" id="maxReview" class="form-control custom-date-input"
            placeholder="ex: 5" />
        </div>
        @if (leaveType2.get('max_review_days')?.touched && leaveType2.get('max_review_days')?.errors?.['required']) {
        <p class="error-msg">
          Max Review Days is required.
        </p>
        }
        @if (leaveType2.get('max_review_days')?.touched && leaveType2.get('max_review_days')?.errors?.['pattern']) {
        <p class="error-msg">
          Max Review Days must be number.
        </p>
        }
      </div>
      <div class="form-check d-flex align-items-end justify-content-start p-0 m-0 gap-3">
        <input class="form-check-input m-0" [(ngModel)]="carryoverAllowed" (change)="toggleCarryoverValidators()"
          [ngModelOptions]="{ standalone: true }" type="checkbox" id="allowCarryover">
        <label class="form-check-label m-0" for="allowCarryover">
          Allow Carryover
        </label>
      </div>
      <div class="input mt-2" [style.opacity]="carryoverAllowed ? '1' : '0.5'">
        <label for="maxCarryover">Maximum Carryover Days</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="number" [disabled]="!carryoverAllowed" formControlName="maximum_carryover_days" id="maxCarryover"
            class="form-control custom-date-input" placeholder="ex: 5" />
        </div>
        @if (leaveType2.get('maximum_carryover_days')?.touched &&
        leaveType2.get('maximum_carryover_days')?.errors?.['required']) {
        <p class="error-msg">
          Maximum Carryover Days is required.
        </p>
        }
        @if (leaveType2.get('maximum_carryover_days')?.touched &&
        leaveType2.get('maximum_carryover_days')?.errors?.['pattern']) {
        <p class="error-msg">
          Maximum Carryover Days must be number.
        </p>
        }
      </div>
    </form>
    @if (errMsg) {
    <div class="alert alert-danger mb-0 mt-3" role="alert">
      {{errMsg}}
    </div>
    }
    <!-- prev and confirm buttons -->
    <div class="btn-fixed d-flex align-items-stretch gap-2">
      <button class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
        (click)="goPrev()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M20 12H4m0 0l6-6m-6 6l6 6" />
        </svg>
      </button>

      <!-- next button -->
      <button class="btn btn-lg btn-primary" [disabled]="!leaveType2.valid" (click)="goNext()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M4 12h16m0 0l-6-6m6 6l-6 6" />
        </svg>
        <span>Next (2/3)</span>
      </button>


      <!-- <button class="btn btn-lg btn-success w-auto" [disabled]="!leaveType1.valid || !leaveType2.valid || isLoading"
        (click)="createleaveType()">
        @if (isLoading) {
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        }
        @if (!isLoading) {
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
        <span>Create Leave Type</span>
      </button> -->
    </div>
  </div>
</div>
}

<!-- step 3 -->

@if (currentStep === 3) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Extra Conditions</h2>
    <form [formGroup]="leaveType3" class="w-lg-50 d-flex flex-column gap-2">


      <div class="input">
        <div class="form-check d-flex align-items-end justify-content-start p-0 m-0 my-2 gap-1">
          <input class="form-check-input m-0" type="checkbox" id="extra_with_age" formControlName="extra_with_age">
          <label class="form-check-label m-0" for="extra_with_age">
            Extra limit with Age
          </label>
        </div>
        <div class="form-outline w-100 position-relative custom-date-wrapper">

          <div class="w-100 d-flex align-items-start gap-2">
            <div class="input w-100" [style.opacity]="leaveType3.get('age')?.disabled ? 0.5 : 1">
              <label [for]="'Age' ">Age</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'Age' " class="form-control custom-date-input" formControlName="age" />
              </div>
            </div>
            <div class="input w-100" [style.opacity]="leaveType3.get('extraDays')?.disabled ? 0.5 : 1">
              <label [for]="'ExtraDays'">Extra days</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'ExtraDays' " class="form-control custom-date-input"
                  formControlName="extraDays" />
              </div>
            </div>

          </div>


        </div>
      </div>
      <hr />

      <div class="input">
        <div class="form-check d-flex align-items-end justify-content-start p-0 m-0 my-2 gap-1">
          <input class="form-check-input m-0" type="checkbox" id="allowCarryover" formControlName="extra_with_service">
          <label class="form-check-label m-0" for="allowCarryover">
            Extra limit with years of Service
          </label>
        </div>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <div class="w-100 d-flex align-items-start gap-2">
            <div class="input w-100" [style.opacity]="leaveType3.get('yearsOfService')?.disabled ? 0.5 : 1">
              <label [for]="'YearsOFService' ">Years of Service</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'YearsOFService' " class="form-control custom-date-input"
                  formControlName="yearsOfService" />
              </div>
            </div>
            <div class="input w-100" [style.opacity]="leaveType3.get('extraDaysService')?.disabled ? 0.5 : 1">
              <label [for]="'ExtraDays'">Extra days</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'ExtraDays' " class="form-control custom-date-input"
                  formControlName="extraDaysService" />
              </div>
            </div>

          </div>
        </div>


      </div>
      <hr />

      <div class="input">
        <div class="form-check d-flex align-items-end justify-content-start p-0 m-0 my-2 gap-1">
          <input class="form-check-input m-0" type="checkbox" id="allowCarryover"
            formControlName="extra_with_experience">
          <label class="form-check-label m-0" for="allowCarryover">
            Extra limit with years of Experience
          </label>
        </div>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <div class="w-100 d-flex align-items-start gap-2">
            <div class="input w-100" [style.opacity]="leaveType3.get('yearsOfExperience')?.disabled ? 0.5 : 1">
              <label [for]="'YearsOfExperience' ">Years of Experience</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'YearsOfExperience' " class="form-control custom-date-input"
                  formControlName="yearsOfExperience" />
              </div>
            </div>
            <div class="input w-100" [style.opacity]="leaveType3.get('extraDaysExperience')?.disabled ? 0.5 : 1">
              <label [for]="'ExtraDaysExperience'">Extra days</label>
              <div class="form-outline w-100 position-relative custom-date-wrapper">
                <input type="number" [id]="'ExtraDaysExperience' " class="form-control custom-date-input"
                  formControlName="extraDaysExperience" />
              </div>
            </div>

          </div>
        </div>

      </div>

    </form>
    @if (errMsg) {
    <div class="alert alert-danger mb-0 mt-3" role="alert">
      {{errMsg}}
    </div>
    }
    <!-- prev and confirm buttons -->
    <div class="btn-fixed d-flex align-items-stretch gap-2">
      <button class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
        (click)="goPrev()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M20 12H4m0 0l6-6m-6 6l6 6" />
        </svg>
      </button>
      <button class="btn btn-lg btn-success w-auto"
        [disabled]="!leaveType1.valid || !leaveType2.valid || !leaveType3.valid || isLoading"
        (click)="createleaveType()">
        @if (isLoading) {
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        }
        @if (!isLoading) {
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
        <span>Create Leave Type</span>
      </button>
    </div>
  </div>
</div>
}



<!-- discard -->
<app-popup [title]="'Discard Leave Type'" [paragraph1]="'Are you sure you want to discard creating the new Leave Type?'"
  [paragraph2]="'This action cannot be undone!'" [isOpen]="isModalOpen" (close)="closeModal()">
  <button modal-btn-left class="btn btn-lg btn-dark w-100" (click)="confirmAction()">
    Discard Leave Type
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeModal()">
    Cancel
  </button>
</app-popup>