<!-- Deduction confirmation popup -->
<app-popup [title]="'Confirm Deduction Action'" [paragraph1]="deductionModalLog ?
    (deductionModalLog.hours_object?.total_deduction > 0
      ? 'Are you sure you want to remove the deduction for this log?'
      : 'Are you sure you want to add a deduction for this log?')
    : ''" [paragraph2]="'This action can’t be undone!'" [isOpen]="deductionModalOpen" (close)="closeDeductionModal()">
  <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmDeductionToggle()"
    [disabled]="deductionModalLoading">
    @if (deductionModalLoading) {
    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
    }
    Confirm
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeDeductionModal()">
    Cancel
  </button>
</app-popup>
<!-- Edit Log Modal -->
<app-popup
  [title]="editModalType === 'log' ? 'Edit Log' : (editModalType === 'checkin' ? 'Edit Check In' : (editModalType === 'checkout' ? 'Edit Check Out' : ''))"
  [isOpen]="editModalOpen" (close)="closeEditModal()">
  <form class="d-flex flex-column gap-3 p-2" (submit)="$event.preventDefault(); updateEditModal();">
    @if (editModalType === 'log' || editModalType === 'checkin'){
    <div>
      <label for="edit-checkin-time" class="form-label">Check In Time</label>
      <input id="edit-checkin-time" type="time" class="form-control" [(ngModel)]="editCheckInValue"
        name="editCheckInValue" required />
    </div>
    }
    @if (editModalType === 'log' || editModalType === 'checkout'){
    <div>
      <label for="edit-checkout-time" class="form-label">Check Out Time</label>
      <input id="edit-checkout-time" type="time" class="form-control" [(ngModel)]="editCheckOutValue"
        name="editCheckOutValue" required />
    </div>
    }
    <div class="d-flex gap-2 mt-3">
      <button modal-btn-left type="submit" class="btn btn-lg btn-primary w-100" [disabled]="editModalLoading">
        @if (editModalLoading){
        <span class="spinner-grow spinner-grow-sm me-2" role="status" aria-hidden="true"></span>
        }
        Update
      </button>
      <button modal-btn-right type="button" class="btn btn-lg btn-outline-dark border-0 w-100"
        (click)="closeEditModal()">Cancel</button>
    </div>
  </form>
</app-popup>
<!-- start page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Attendance', link: '/attendance' },
    { label: 'Attendance Log' }
  ]" title="Attendance Log">
</app-page-header>
<!-- end page header -->

<!-- start page content -->
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <!-- start search and filter -->
    <div class="d-flex flex-column flex-lg-row align-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-2 w-100 w-lg-50">
        <!-- Search input -->
        <div class="form-outline w-75">
          <input type="text" class="form-control" placeholder="Search for an employee" [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()" />
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <circle cx="11.5" cy="11.5" r="9.5" />
              <path stroke-linecap="round" d="M18.5 18.5L22 22" />
            </g>
          </svg>
        </div>

        <!-- Filter button -->
        <button class="btn btn-outline-primary custom-btn" (click)="overlay.openOverlay()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path fill="none" stroke-width="1.5"
              d="M19 3H5c-1.414 0-2.121 0-2.56.412S2 4.488 2 5.815v.69c0 1.037 0 1.556.26 1.986s.733.698 1.682 1.232l2.913 1.64c.636.358.955.537 1.183.735c.474.411.766.895.898 1.49c.064.284.064.618.064 1.285v2.67c0 .909 0 1.364.252 1.718c.252.355.7.53 1.594.88c1.879.734 2.818 1.101 3.486.683S15 19.452 15 17.542v-2.67c0-.666 0-1 .064-1.285a2.68 2.68 0 0 1 .899-1.49c.227-.197.546-.376 1.182-.735l2.913-1.64c.948-.533 1.423-.8 1.682-1.23c.26-.43.26-.95.26-1.988v-.69c0-1.326 0-1.99-.44-2.402C21.122 3 20.415 3 19 3Z" />
          </svg>
          <span>Filter</span>
        </button>
      </div>

      <div class="d-flex align-items-center justify-content-end gap-2 w-100 w-lg-50">
        <button class="export-btn" (click)="exportAttendanceLog()" [disabled]="isExporting">
          @if (isExporting) {
          <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
          } @if (!isExporting) {
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M10.8523 5.64775C11.0719 5.86742 11.4281 5.86742 11.6477 5.64775C11.8674 5.42808 11.8674 5.07192 11.6477 4.85225L9.39775 2.60225C9.17808 2.38258 8.82192 2.38258 8.60225 2.60225L6.35225 4.85225C6.13258 5.07192 6.13258 5.42808 6.35225 5.64775C6.57192 5.86742 6.92808 5.86742 7.14775 5.64775L8.4375 4.358V10.5C8.4375 10.8107 8.68934 11.0625 9 11.0625C9.31066 11.0625 9.5625 10.8107 9.5625 10.5V4.358L10.8523 5.64775Z"
              fill="#377AFD" />
            <path
              d="M15.5625 9C15.5625 8.68934 15.3107 8.4375 15 8.4375C14.6893 8.4375 14.4375 8.68934 14.4375 9C14.4375 12.003 12.003 14.4375 9 14.4375C5.99695 14.4375 3.5625 12.003 3.5625 9C3.5625 8.68934 3.31066 8.4375 3 8.4375C2.68934 8.4375 2.4375 8.68934 2.4375 9C2.4375 12.6244 5.37563 15.5625 9 15.5625C12.6244 15.5625 15.5625 12.6244 15.5625 9Z"
              fill="#377AFD" />
          </svg>
          }
          <span>Export</span>
        </button>
        <button class="new-log-btn" (click)="navigateToNewLog()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10" />
              <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
            </g>
          </svg>
          <span>New Log</span>
        </button>
      </div>

      <!-- last days -->
      <!-- <div class="date-slider">
        <button class="btn btn-outline-dark border-0" (click)="prevWeek()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path fill="currentColor" fill-rule="evenodd"
              d="M15.488 4.43a.75.75 0 0 1 .081 1.058L9.988 12l5.581 6.512a.75.75 0 1 1-1.138.976l-6-7a.75.75 0 0 1 0-.976l6-7a.75.75 0 0 1 1.057-.081"
              clip-rule="evenodd" />
            </svg>
          </button>

          <div class="dates">
            @for (day of days; track trackByDate($index, day)) {
              <div class="date-box" [class.today]="day.isToday" [class.selected]="isSelected(day.date)"
                [class.disabled]="day.date > today" (click)="selectDate(day.date)">

                <div class="day-label">{{ day.isToday ? 'Today' : day.label }}</div>
                <div class="day-number">{{ day.date | date: 'd MMM' }}</div>

              </div>
            }
          </div>



          <button class="btn btn-outline-dark border-0" (click)="nextWeek()" [disabled]="!canGoNext()">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="currentColor" fill-rule="evenodd"
                d="M8.512 4.43a.75.75 0 0 1 1.057.082l6 7a.75.75 0 0 1 0 .976l-6 7a.75.75 0 0 1-1.138-.976L14.012 12L8.431 5.488a.75.75 0 0 1 .08-1.057"
                clip-rule="evenodd" />
              </svg>
            </button>
          </div> -->
    </div>

    <!-- last days -->
    <div class="date-slider">
      <button class="btn btn-outline-dark border-0" (click)="prevWeek()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="currentColor" fill-rule="evenodd"
            d="M15.488 4.43a.75.75 0 0 1 .081 1.058L9.988 12l5.581 6.512a.75.75 0 1 1-1.138.976l-6-7a.75.75 0 0 1 0-.976l6-7a.75.75 0 0 1 1.057-.081"
            clip-rule="evenodd" />
        </svg>
      </button>

      <div class="dates">
        @for (day of days; track trackByDate($index, day)) {
        <div class="date-box" [class.today]="day.isToday" [class.selected]="isSelected(day.date)"
          [class.disabled]="day.date > today" (click)="selectDate(day.date)">
          <div class="day-label">{{ day.isToday ? "Today" : day.label }}</div>
          <div class="day-number">{{ day.date | date : "d MMM" }}</div>
        </div>
        }
      </div>

      <button class="btn btn-outline-dark border-0" (click)="nextWeek()" [disabled]="!canGoNext()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="currentColor" fill-rule="evenodd"
            d="M8.512 4.43a.75.75 0 0 1 1.057.082l6 7a.75.75 0 0 1 0 .976l-6 7a.75.75 0 0 1-1.138-.976L14.012 12L8.431 5.488a.75.75 0 0 1 .08-1.057"
            clip-rule="evenodd" />
        </svg>
      </button>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead #tableHeader>
          <tr>
            <th (click)="sortBy()" style="cursor: pointer" class="width-fix" [ngStyle]="{ width: columnWidths[0] }">
              <div class="d-flex align-items-center justify-content-between">
                <span>Employee</span>
                @if (sortDirection === 'desc') {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <g fill="none" stroke="#DDE3EB" stroke-linecap="round" stroke-width="1.5">
                    <path d="M4 8h9m-7 5h7m-5 5h5" />
                    <path stroke-linejoin="round" d="M17 20V4l3 4" />
                  </g>
                </svg>
                } @if (sortDirection === 'asc') {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                  <path fill="#DDE3EB" fill-rule="evenodd"
                    d="M17 3.25a.75.75 0 0 1 .75.75v13.75l1.65-2.2a.75.75 0 1 1 1.2.9l-3 4a.75.75 0 0 1-1.35-.45V4a.75.75 0 0 1 .75-.75M7.25 6A.75.75 0 0 1 8 5.25h5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 6m-2 5a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75m-2 5a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5H4a.75.75 0 0 1-.75-.75"
                    clip-rule="evenodd" />
                </svg>
                }
              </div>
            </th>

            <th>Date</th>
            <th>Day Type</th>
            <th>In</th>
            <th>Out</th>
            <th style="width: 150px">Working</th>
            <th>Status</th>
            <th>Deduction</th>
            <th class="text-end">Actions</th>

        </thead>

        <tbody>
          @if(loadData){ @for (i of skeletonRows; track $index) {
          <tr>
            @for (col of columnWidths; track $index) {
            <td class="px-2 py-2">
              <div class="skeleton-cell w-100" [ngStyle]="{ width: col, height: '30px' }"></div>
              <!-- td closed here for sub row -->
              }
          </tr>
          } } @if(!loadData){ @for (emp of employees | paginate: { id:
          'attendance-pagination', itemsPerPage: itemsPerPage, currentPage:
          currentPage, totalItems: totalItems }; track emp; let i = $index) {
          <tr [ngClass]="{ 'expanded-row': !emp.collapsed }">
            <td colspan="9" class="px-0 td">
              <div class="d-flex align-items-center main-row">
                <!-- Main Employee Info -->
                <div class="d-flex align-items-center name-cell" [ngStyle]="{ width: columnWidths[0] }">
                  @if(emp.list_items?.length > 0){
                  <div style="width: 40px">
                    <button class="btn btn-sm" (click)="toggleCollapse(emp)">
                      @if (emp.collapsed) {
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor"
                          d="M8.512 4.43a.75.75 0 0 1 1.057.082l6 7a.75.75 0 0 1 0 .976l-6 7a.75.75 0 0 1-1.138-.976L14.012 12L8.431 5.488a.75.75 0 0 1 .08-1.057" />
                      </svg>
                      } @if (!emp.collapsed) {
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor"
                          d="M4.43 8.512a.75.75 0 0 1 1.058-.081L12 14.012l6.512-5.581a.75.75 0 0 1 .976 1.138l-7 6a.75.75 0 0 1-.976 0l-7-6a.75.75 0 0 1-.081-1.057" />
                      </svg>
                      }
                    </button>
                  </div>
                  }
                  <div class="d-flex flex-column ps-1">
                    <span class="d-block text-gray-sm">{{
                      emp?.employee?.id?.toString().padStart(4, "0")
                      }}</span>
                    <span class="d-block text-truncate" style="max-width: 220px">
                      {{ emp?.employee?.name }}
                    </span>
                  </div>
                </div>
                <div [ngStyle]="{ width: columnWidths[1] }">
                  {{ emp.date | date : "dd/MM/yyyy" }}
                </div>
                <div [ngStyle]="{ width: columnWidths[2] }">
                  @if (emp.is_working_day) {
                  <span>Working Day</span>
                  }@else{
                  <span>Day Off</span>
                  }
                </div>
                @if (!['Absent', 'On Leave', 'Holiday', 'Weekly
                leave'].includes(getMainRecord(emp.list_items)?.status)){
                <div [ngStyle]="{ width: columnWidths[3] }">
                  <span class="text-nowrap">{{ formatTimeTo12Hour(emp?.scheduled?.check_id) }}</span>
                </div>
                <div [ngStyle]="{ width: columnWidths[4] }">
                  <span class="text-nowrap">{{ formatTimeTo12Hour(emp?.scheduled?.check_out) }}</span>
                </div>
                }
                @if (["Absent", "On Leave", "Holiday", "Weekly leave"].includes(getMainRecord(emp.list_items)?.status))
                {
                <div [ngStyle]="{ width: columnWidths[3] }">--</div>
                <div [ngStyle]="{ width: columnWidths[4] }">--</div>
                }
                <div [ngStyle]="{ width: columnWidths[5] }"
                  class="d-flex align-items-center justify-content-between gap-4">
                  <span>{{ emp?.work_hours }}</span>
                  @if(emp?.missing_hrs) {
                  <div class="d-flex flex-column">
                    <small class="d-block text-sm text-danger text-nowrap">Missing</small>
                    <span class="d-block text-nowrap text-danger">
                      {{ emp?.missing_hrs }}
                    </span>
                  </div>
                  }
                </div>
                <div [ngStyle]="{ width: columnWidths[6] }">
                  <span class="text-nowrap" [ngClass]="
                      getStatusClass(getMainRecord(emp.list_items)?.status)
                    ">
                    {{ getMainRecord(emp.list_items)?.status }}
                  </span>
                </div>
                <div class="text-danger" [ngStyle]="{ width: columnWidths[7] }">
                  {{ emp.deduction }}
                </div>
                <div [ngStyle]="{ width: columnWidths[8] }" class="text-end position-relative">
                  <!-- No actions on main record - all actions are in sub-records -->
                </div>
              </div>
              <!-- Collapsed section -->
              @if (!emp.collapsed) {
              <div>
                @for (log of emp.list_items; track log; let j = $index) {
                <div class="d-flex align-items-center inner-row">
                  <div class="d-flex align-items-center" [style.width]="columnWidths[0]">
                    <div style="width: 40px"></div>
                  </div>
                  <div [style.width]="columnWidths[1]"></div>
                  <div [style.width]="columnWidths[2]"></div>
                  <div class="text-nowrap" [style.width]="columnWidths[3]">{{ getFormattedCheckIn(log) }}</div>
                  <div class="text-nowrap" [style.width]="columnWidths[4]">{{ getFormattedCheckOut(log) }}</div>
                  <div [style.width]="columnWidths[5]" class="d-flex align-items-center justify-content-between gap-4">
                    <span>{{ log?.hours_object?.work_hours }}</span>
                    @if(log?.hours_object?.missing_hrs !== '--') {
                    <div class="d-flex flex-column">
                      <small class="d-block text-sm text-danger text-nowrap">Missing</small>
                      <span class="d-block text-nowrap text-danger">{{ log?.hours_object?.missing_hrs }}</span>
                    </div>
                    }
                  </div>
                  <div [style.width]="columnWidths[6]">
                    <small class="text-nowrap" [ngClass]="getStatusClass(log.status)">{{ log.status }}</small>
                  </div>
                  <div class="text-danger" [style.width]="columnWidths[7]">{{ log?.hours_object?.deduction }}</div>
                  <div [style.width]="columnWidths[8]" class="text-end position-relative">
                    <button class="action-menu-btn" (click)="openSubLogMenu(i, j)" type="button">
                      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                    </button>
                    @if (openSubMenu && openSubMenu.mainIndex === i && openSubMenu.subIndex === j){
                    <div class="action-menu-dropdown" (mouseleave)="closeSubLogMenu()"
                      (click)="$event.stopPropagation()">
                      <!-- Scenario 1: NO check-in AND NO check-out → Show "Add Check In" + "Add Check Out" + "Cancel Log" -->
                      <!-- Show "Add Check In" when check-in doesn't exist or is '00:00' -->
                      @if (!['Absent', 'On Leave', 'Holiday', 'Weekly leave'].includes(log.status) &&
                      (!log?.times_object?.actual_check_in || log?.times_object?.actual_check_in === '00:00')) {
                      <button class="action-menu-item" (click)="openEditCheckInModal(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_257)">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.95697 0.9375L10.125 0.9375C10.4357 0.9375 10.6875 1.18934 10.6875 1.5C10.6875 1.81066 10.4357 2.0625 10.125 2.0625H9C7.21633 2.0625 5.93517 2.06369 4.96018 2.19478C4.00138 2.32369 3.42334 2.56886 2.9961 2.9961C2.56886 3.42334 2.32369 4.00138 2.19478 4.96018C2.06369 5.93517 2.0625 7.21633 2.0625 9C2.0625 10.7837 2.06369 12.0648 2.19478 13.0398C2.32369 13.9986 2.56886 14.5767 2.9961 15.0039C3.42334 15.4311 4.00138 15.6763 4.96018 15.8052C5.93517 15.9363 7.21633 15.9375 9 15.9375C10.7837 15.9375 12.0648 15.9363 13.0398 15.8052C13.9986 15.6763 14.5767 15.4311 15.0039 15.0039C15.4311 14.5767 15.6763 13.9986 15.8052 13.0398C15.9363 12.0648 15.9375 10.7837 15.9375 9V7.875C15.9375 7.56434 16.1893 7.3125 16.5 7.3125C16.8107 7.3125 17.0625 7.56434 17.0625 7.875V9.04303C17.0625 10.7743 17.0625 12.1311 16.9202 13.1897C16.7745 14.2733 16.4705 15.1283 15.7994 15.7994C15.1283 16.4705 14.2733 16.7745 13.1897 16.9202C12.1311 17.0625 10.7743 17.0625 9.04303 17.0625H8.95697C7.22567 17.0625 5.8689 17.0625 4.81028 16.9202C3.72673 16.7745 2.87171 16.4705 2.2006 15.7994C1.5295 15.1283 1.22549 14.2733 1.07981 13.1897C0.937483 12.1311 0.937491 10.7743 0.9375 9.04303V8.95697C0.937491 7.22567 0.937483 5.86889 1.07981 4.81028C1.22549 3.72673 1.5295 2.87171 2.2006 2.2006C2.87171 1.5295 3.72673 1.22549 4.81028 1.07981C5.86889 0.937483 7.22567 0.937491 8.95697 0.9375ZM12.5779 1.70694C13.6038 0.681022 15.2671 0.681022 16.2931 1.70694C17.319 2.73285 17.319 4.39619 16.2931 5.4221L11.307 10.4082C11.0285 10.6867 10.8541 10.8611 10.6594 11.013C10.4302 11.1918 10.1821 11.3451 9.91961 11.4702C9.69676 11.5764 9.46271 11.6544 9.08909 11.7789L6.9107 12.505C6.50851 12.6391 6.0651 12.5344 5.76533 12.2347C5.46556 11.9349 5.36089 11.4915 5.49495 11.0893L6.22108 8.91092C6.34559 8.53729 6.42359 8.30324 6.5298 8.08039C6.65489 7.81791 6.80821 7.56984 6.98703 7.34056C7.13887 7.1459 7.31333 6.97147 7.59183 6.693L12.5779 1.70694ZM15.4976 2.50243C14.911 1.91586 13.96 1.91586 13.3734 2.50243L13.0909 2.7849C13.108 2.85679 13.1318 2.94245 13.1649 3.038C13.2724 3.34779 13.4758 3.75579 13.86 4.13999C14.2442 4.5242 14.6522 4.7276 14.962 4.83508C15.0575 4.86823 15.1432 4.89205 15.2151 4.90907L15.4976 4.62661C16.0841 4.04003 16.0841 3.08901 15.4976 2.50243ZM14.3289 5.79532C13.9419 5.6289 13.4911 5.36209 13.0645 4.93549C12.6379 4.50889 12.3711 4.05812 12.2047 3.67114L8.41313 7.46269C8.10075 7.77508 7.97823 7.89897 7.87411 8.03246C7.74553 8.19731 7.6353 8.37567 7.54536 8.56439C7.47252 8.71722 7.41651 8.8822 7.2768 9.30131L6.95288 10.2731L7.72693 11.0471L8.69869 10.7232C9.1178 10.5835 9.28278 10.5275 9.43561 10.4546C9.62433 10.3647 9.80269 10.2545 9.96754 10.1259C10.101 10.0218 10.2249 9.89926 10.5373 9.58687L14.3289 5.79532Z"
                                fill="#4A6D97" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_257">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Add Check In
                      </button>
                      }
                      <!-- Show "Add Check Out" when check-in EXISTS AND check-out DOESN'T exist -->
                      @if (!['Absent', 'On Leave', 'Holiday', 'Weekly leave'].includes(log.status) &&
                      (log?.times_object?.actual_check_in && log?.times_object?.actual_check_in !== '00:00') &&
                      (!log?.times_object?.actual_check_out || log?.times_object?.actual_check_out === '00:00')) {
                      <button class="action-menu-item" (click)="openEditCheckOutModal(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_257)">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.95697 0.9375L10.125 0.9375C10.4357 0.9375 10.6875 1.18934 10.6875 1.5C10.6875 1.81066 10.4357 2.0625 10.125 2.0625H9C7.21633 2.0625 5.93517 2.06369 4.96018 2.19478C4.00138 2.32369 3.42334 2.56886 2.9961 2.9961C2.56886 3.42334 2.32369 4.00138 2.19478 4.96018C2.06369 5.93517 2.0625 7.21633 2.0625 9C2.0625 10.7837 2.06369 12.0648 2.19478 13.0398C2.32369 13.9986 2.56886 14.5767 2.9961 15.0039C3.42334 15.4311 4.00138 15.6763 4.96018 15.8052C5.93517 15.9363 7.21633 15.9375 9 15.9375C10.7837 15.9375 12.0648 15.9363 13.0398 15.8052C13.9986 15.6763 14.5767 15.4311 15.0039 15.0039C15.4311 14.5767 15.6763 13.9986 15.8052 13.0398C15.9363 12.0648 15.9375 10.7837 15.9375 9V7.875C15.9375 7.56434 16.1893 7.3125 16.5 7.3125C16.8107 7.3125 17.0625 7.56434 17.0625 7.875V9.04303C17.0625 10.7743 17.0625 12.1311 16.9202 13.1897C16.7745 14.2733 16.4705 15.1283 15.7994 15.7994C15.1283 16.4705 14.2733 16.7745 13.1897 16.9202C12.1311 17.0625 10.7743 17.0625 9.04303 17.0625H8.95697C7.22567 17.0625 5.8689 17.0625 4.81028 16.9202C3.72673 16.7745 2.87171 16.4705 2.2006 15.7994C1.5295 15.1283 1.22549 14.2733 1.07981 13.1897C0.937483 12.1311 0.937491 10.7743 0.9375 9.04303V8.95697C0.937491 7.22567 0.937483 5.86889 1.07981 4.81028C1.22549 3.72673 1.5295 2.87171 2.2006 2.2006C2.87171 1.5295 3.72673 1.22549 4.81028 1.07981C5.86889 0.937483 7.22567 0.937491 8.95697 0.9375ZM12.5779 1.70694C13.6038 0.681022 15.2671 0.681022 16.2931 1.70694C17.319 2.73285 17.319 4.39619 16.2931 5.4221L11.307 10.4082C11.0285 10.6867 10.8541 10.8611 10.6594 11.013C10.4302 11.1918 10.1821 11.3451 9.91961 11.4702C9.69676 11.5764 9.46271 11.6544 9.08909 11.7789L6.9107 12.505C6.50851 12.6391 6.0651 12.5344 5.76533 12.2347C5.46556 11.9349 5.36089 11.4915 5.49495 11.0893L6.22108 8.91092C6.34559 8.53729 6.42359 8.30324 6.5298 8.08039C6.65489 7.81791 6.80821 7.56984 6.98703 7.34056C7.13887 7.1459 7.31333 6.97147 7.59183 6.693L12.5779 1.70694ZM15.4976 2.50243C14.911 1.91586 13.96 1.91586 13.3734 2.50243L13.0909 2.7849C13.108 2.85679 13.1318 2.94245 13.1649 3.038C13.2724 3.34779 13.4758 3.75579 13.86 4.13999C14.2442 4.5242 14.6522 4.7276 14.962 4.83508C15.0575 4.86823 15.1432 4.89205 15.2151 4.90907L15.4976 4.62661C16.0841 4.04003 16.0841 3.08901 15.4976 2.50243ZM14.3289 5.79532C13.9419 5.6289 13.4911 5.36209 13.0645 4.93549C12.6379 4.50889 12.3711 4.05812 12.2047 3.67114L8.41313 7.46269C8.10075 7.77508 7.97823 7.89897 7.87411 8.03246C7.74553 8.19731 7.6353 8.37567 7.54536 8.56439C7.47252 8.71722 7.41651 8.8822 7.2768 9.30131L6.95288 10.2731L7.72693 11.0471L8.69869 10.7232C9.1178 10.5835 9.28278 10.5275 9.43561 10.4546C9.62433 10.3647 9.80269 10.2545 9.96754 10.1259C10.101 10.0218 10.2249 9.89926 10.5373 9.58687L14.3289 5.79532Z"
                                fill="#4A6D97" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_257">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Add Check Out
                      </button>
                      }
                      <!-- Show "Edit Check In" when check-in EXISTS AND check-out DOESN'T exist -->
                      @if (!['Absent', 'On Leave', 'Holiday', 'Weekly leave'].includes(log.status) &&
                      (log?.times_object?.actual_check_in && log?.times_object?.actual_check_in !== '00:00') &&
                      (!log?.times_object?.actual_check_out || log?.times_object?.actual_check_out === '00:00')) {
                      <button class="action-menu-item" (click)="openEditCheckInModal(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_257)">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.95697 0.9375L10.125 0.9375C10.4357 0.9375 10.6875 1.18934 10.6875 1.5C10.6875 1.81066 10.4357 2.0625 10.125 2.0625H9C7.21633 2.0625 5.93517 2.06369 4.96018 2.19478C4.00138 2.32369 3.42334 2.56886 2.9961 2.9961C2.56886 3.42334 2.32369 4.00138 2.19478 4.96018C2.06369 5.93517 2.0625 7.21633 2.0625 9C2.0625 10.7837 2.06369 12.0648 2.19478 13.0398C2.32369 13.9986 2.56886 14.5767 2.9961 15.0039C3.42334 15.4311 4.00138 15.6763 4.96018 15.8052C5.93517 15.9363 7.21633 15.9375 9 15.9375C10.7837 15.9375 12.0648 15.9363 13.0398 15.8052C13.9986 15.6763 14.5767 15.4311 15.0039 15.0039C15.4311 14.5767 15.6763 13.9986 15.8052 13.0398C15.9363 12.0648 15.9375 10.7837 15.9375 9V7.875C15.9375 7.56434 16.1893 7.3125 16.5 7.3125C16.8107 7.3125 17.0625 7.56434 17.0625 7.875V9.04303C17.0625 10.7743 17.0625 12.1311 16.9202 13.1897C16.7745 14.2733 16.4705 15.1283 15.7994 15.7994C15.1283 16.4705 14.2733 16.7745 13.1897 16.9202C12.1311 17.0625 10.7743 17.0625 9.04303 17.0625H8.95697C7.22567 17.0625 5.8689 17.0625 4.81028 16.9202C3.72673 16.7745 2.87171 16.4705 2.2006 15.7994C1.5295 15.1283 1.22549 14.2733 1.07981 13.1897C0.937483 12.1311 0.937491 10.7743 0.9375 9.04303V8.95697C0.937491 7.22567 0.937483 5.86889 1.07981 4.81028C1.22549 3.72673 1.5295 2.87171 2.2006 2.2006C2.87171 1.5295 3.72673 1.22549 4.81028 1.07981C5.86889 0.937483 7.22567 0.937491 8.95697 0.9375ZM12.5779 1.70694C13.6038 0.681022 15.2671 0.681022 16.2931 1.70694C17.319 2.73285 17.319 4.39619 16.2931 5.4221L11.307 10.4082C11.0285 10.6867 10.8541 10.8611 10.6594 11.013C10.4302 11.1918 10.1821 11.3451 9.91961 11.4702C9.69676 11.5764 9.46271 11.6544 9.08909 11.7789L6.9107 12.505C6.50851 12.6391 6.0651 12.5344 5.76533 12.2347C5.46556 11.9349 5.36089 11.4915 5.49495 11.0893L6.22108 8.91092C6.34559 8.53729 6.42359 8.30324 6.5298 8.08039C6.65489 7.81791 6.80821 7.56984 6.98703 7.34056C7.13887 7.1459 7.31333 6.97147 7.59183 6.693L12.5779 1.70694ZM15.4976 2.50243C14.911 1.91586 13.96 1.91586 13.3734 2.50243L13.0909 2.7849C13.108 2.85679 13.1318 2.94245 13.1649 3.038C13.2724 3.34779 13.4758 3.75579 13.86 4.13999C14.2442 4.5242 14.6522 4.7276 14.962 4.83508C15.0575 4.86823 15.1432 4.89205 15.2151 4.90907L15.4976 4.62661C16.0841 4.04003 16.0841 3.08901 15.4976 2.50243ZM14.3289 5.79532C13.9419 5.6289 13.4911 5.36209 13.0645 4.93549C12.6379 4.50889 12.3711 4.05812 12.2047 3.67114L8.41313 7.46269C8.10075 7.77508 7.97823 7.89897 7.87411 8.03246C7.74553 8.19731 7.6353 8.37567 7.54536 8.56439C7.47252 8.71722 7.41651 8.8822 7.2768 9.30131L6.95288 10.2731L7.72693 11.0471L8.69869 10.7232C9.1178 10.5835 9.28278 10.5275 9.43561 10.4546C9.62433 10.3647 9.80269 10.2545 9.96754 10.1259C10.101 10.0218 10.2249 9.89926 10.5373 9.58687L14.3289 5.79532Z"
                                fill="#4A6D97" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_257">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Edit Check In
                      </button>
                      }
                      <!-- Show "Edit Log" when BOTH check-in AND check-out exist OR when no check-in/check-out exists -->
                      @if (!['On Leave', 'Holiday', 'Weekly leave'].includes(log.status) &&
                      (hasBothCheckInAndOut(log) || (!hasCheckIn(log) && !hasCheckOut(log)))) {
                      <button class="action-menu-item" (click)="openEditLogModal(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_257)">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.95697 0.9375L10.125 0.9375C10.4357 0.9375 10.6875 1.18934 10.6875 1.5C10.6875 1.81066 10.4357 2.0625 10.125 2.0625H9C7.21633 2.0625 5.93517 2.06369 4.96018 2.19478C4.00138 2.32369 3.42334 2.56886 2.9961 2.9961C2.56886 3.42334 2.32369 4.00138 2.19478 4.96018C2.06369 5.93517 2.0625 7.21633 2.0625 9C2.0625 10.7837 2.06369 12.0648 2.19478 13.0398C2.32369 13.9986 2.56886 14.5767 2.9961 15.0039C3.42334 15.4311 4.00138 15.6763 4.96018 15.8052C5.93517 15.9363 7.21633 15.9375 9 15.9375C10.7837 15.9375 12.0648 15.9363 13.0398 15.8052C13.9986 15.6763 14.5767 15.4311 15.0039 15.0039C15.4311 14.5767 15.6763 13.9986 15.8052 13.0398C15.9363 12.0648 15.9375 10.7837 15.9375 9V7.875C15.9375 7.56434 16.1893 7.3125 16.5 7.3125C16.8107 7.3125 17.0625 7.56434 17.0625 7.875V9.04303C17.0625 10.7743 17.0625 12.1311 16.9202 13.1897C16.7745 14.2733 16.4705 15.1283 15.7994 15.7994C15.1283 16.4705 14.2733 16.7745 13.1897 16.9202C12.1311 17.0625 10.7743 17.0625 9.04303 17.0625H8.95697C7.22567 17.0625 5.8689 17.0625 4.81028 16.9202C3.72673 16.7745 2.87171 16.4705 2.2006 15.7994C1.5295 15.1283 1.22549 14.2733 1.07981 13.1897C0.937483 12.1311 0.937491 10.7743 0.9375 9.04303V8.95697C0.937491 7.22567 0.937483 5.86889 1.07981 4.81028C1.22549 3.72673 1.5295 2.87171 2.2006 2.2006C2.87171 1.5295 3.72673 1.22549 4.81028 1.07981C5.86889 0.937483 7.22567 0.937491 8.95697 0.9375ZM12.5779 1.70694C13.6038 0.681022 15.2671 0.681022 16.2931 1.70694C17.319 2.73285 17.319 4.39619 16.2931 5.4221L11.307 10.4082C11.0285 10.6867 10.8541 10.8611 10.6594 11.013C10.4302 11.1918 10.1821 11.3451 9.91961 11.4702C9.69676 11.5764 9.46271 11.6544 9.08909 11.7789L6.9107 12.505C6.50851 12.6391 6.0651 12.5344 5.76533 12.2347C5.46556 11.9349 5.36089 11.4915 5.49495 11.0893L6.22108 8.91092C6.34559 8.53729 6.42359 8.30324 6.5298 8.08039C6.65489 7.81791 6.80821 7.56984 6.98703 7.34056C7.13887 7.1459 7.31333 6.97147 7.59183 6.693L12.5779 1.70694ZM15.4976 2.50243C14.911 1.91586 13.96 1.91586 13.3734 2.50243L13.0909 2.7849C13.108 2.85679 13.1318 2.94245 13.1649 3.038C13.2724 3.34779 13.4758 3.75579 13.86 4.13999C14.2442 4.5242 14.6522 4.7276 14.962 4.83508C15.0575 4.86823 15.1432 4.89205 15.2151 4.90907L15.4976 4.62661C16.0841 4.04003 16.0841 3.08901 15.4976 2.50243ZM14.3289 5.79532C13.9419 5.6289 13.4911 5.36209 13.0645 4.93549C12.6379 4.50889 12.3711 4.05812 12.2047 3.67114L8.41313 7.46269C8.10075 7.77508 7.97823 7.89897 7.87411 8.03246C7.74553 8.19731 7.6353 8.37567 7.54536 8.56439C7.47252 8.71722 7.41651 8.8822 7.2768 9.30131L6.95288 10.2731L7.72693 11.0471L8.69869 10.7232C9.1178 10.5835 9.28278 10.5275 9.43561 10.4546C9.62433 10.3647 9.80269 10.2545 9.96754 10.1259C10.101 10.0218 10.2249 9.89926 10.5373 9.58687L14.3289 5.79532Z"
                                fill="#4A6D97" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_257">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> @if (hasBothCheckInAndOut(log)) { Edit Log } @else { Add Log }
                      </button>
                      }
                      <!-- Show "Cancel Log" only when at least check-in OR check-out exists -->
                      @if (!['Absent', 'On Leave', 'Holiday', 'Weekly leave'].includes(log.status) && (hasCheckIn(log)
                      || hasCheckOut(log))) {
                      <button class="action-menu-item text-danger" (click)="openModal(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_5957)">
                              <path
                                d="M7.52272 6.72724C7.30306 6.50757 6.9469 6.50757 6.72723 6.72724C6.50756 6.94691 6.50756 7.30307 6.72723 7.52274L8.20449 9L6.72725 10.4772C6.50758 10.6969 6.50758 11.0531 6.72725 11.2727C6.94692 11.4924 7.30307 11.4924 7.52274 11.2727L8.99998 9.79549L10.4772 11.2727C10.6969 11.4924 11.053 11.4924 11.2727 11.2727C11.4924 11.0531 11.4924 10.6969 11.2727 10.4772L9.79548 9L11.2727 7.52275C11.4924 7.30308 11.4924 6.94693 11.2727 6.72726C11.0531 6.50759 10.6969 6.50759 10.4772 6.72726L8.99998 8.2045L7.52272 6.72724Z"
                                fill="#E04F5F" />
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C12.8315 2.0625 15.9375 5.16852 15.9375 9C15.9375 12.8315 12.8315 15.9375 9 15.9375C5.16852 15.9375 2.0625 12.8315 2.0625 9Z"
                                fill="#E04F5F" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_5957">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Cancel Log
                      </button>
                      }
                      <!-- Show Add Deduction when deduction doesn't exist -->
                      <!-- @if (!log?.hours_object?.total_deduction || log?.hours_object?.total_deduction === 0) {
                      <button class="action-menu-item text-danger"
                        (click)="toggleDeduction(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_496)">
                              <path
                                d="M9 6.1875C9.31066 6.1875 9.5625 6.43934 9.5625 6.75V8.4375H11.25C11.5607 8.4375 11.8125 8.68934 11.8125 9C11.8125 9.31066 11.5607 9.5625 11.25 9.5625H9.5625V11.25C9.5625 11.5607 9.31066 11.8125 9 11.8125C8.68934 11.8125 8.4375 11.5607 8.4375 11.25V9.5625H6.75C6.43934 9.5625 6.1875 9.31066 6.1875 9C6.1875 8.68934 6.43934 8.4375 6.75 8.4375H8.4375V6.75C8.4375 6.43934 8.68934 6.1875 9 6.1875Z"
                                fill="#E04F5F" />
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C12.8315 2.0625 15.9375 5.16852 15.9375 9C15.9375 12.8315 12.8315 15.9375 9 15.9375C5.16852 15.9375 2.0625 12.8315 2.0625 9Z"
                                fill="#E04F5F" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_496">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Add Deduction
                      </button>
                      } -->
                      <!-- Show Remove Deduction when deduction exists -->
                      @if (log?.hours_object?.total_deduction > 0) {
                      <button class="action-menu-item" style="color: #22c55e"
                        (click)="toggleDeduction(log, emp); closeSubLogMenu()">
                        <span class="icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4140_496)">
                              <path
                                d="M11.25 9.5625C11.5607 9.5625 11.8125 9.31066 11.8125 9C11.8125 8.68934 11.5607 8.4375 11.25 8.4375H6.75C6.43934 8.4375 6.1875 8.68934 6.1875 9C6.1875 9.31066 6.43934 9.5625 6.75 9.5625H11.25Z"
                                fill="#22c55e" />
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C12.8315 2.0625 15.9375 5.16852 15.9375 9C15.9375 12.8315 12.8315 15.9375 9 15.9375C5.16852 15.9375 2.0625 12.8315 2.0625 9Z"
                                fill="#22c55e" />
                            </g>
                            <defs>
                              <clipPath id="clip0_4140_496">
                                <rect width="18" height="18" fill="white" />
                              </clipPath>
                            </defs>
                          </svg>
                        </span> Remove Deduction
                      </button>
                      }
                    </div>
                    }
                  </div>
                </div>
                }
              </div>
              }
          </tr>
          } @if (employees.length === 0) {
          <tr>
            <td colspan="9" class="py-4">
              @if (searchTerm.trim()) { No Attendance Log match your search and
              filter. } @else { No Attendance Log Added Yet. }
            </td>
          </tr>
          } }
        </tbody>
      </table>
      <!-- Pagination Section -->
      @if (employees.length > 0) {
      <div class="d-flex flex-column flex-lg-row justify-content-between align-items-center mt-3">
        <!-- Left side: text + items per page -->
        <div class="d-flex align-items-center gap-2">
          <div class="text-gray-sm pe-3">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }}–
            {{
            currentPage * itemsPerPage > totalItems
            ? totalItems
            : currentPage * itemsPerPage
            }}
            from {{ totalItems }}
          </div>
          <div class="view-select d-flex align-items-center gap-2 custom-border-padding">
            View
            <select class="form-select form-select-md w-auto" [(ngModel)]="itemsPerPage"
              (ngModelChange)="onItemsPerPageChange($event)">
              @for (option of [5, 10, 25, 50]; track option) {
              <option [value]="option">
                {{ option }}
              </option>
              }
            </select>
          </div>
        </div>
        <!-- Right side: pagination controls -->
        <div class="d-flex align-items-center justify-content-center gap-2 mt-3 mt-lg-0">
          <button class="prev p-0 btn border-0" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="m15 5l-6 7l6 7" />
            </svg>
          </button>
          <pagination-controls id="attendance-pagination" (pageChange)="onPageChange($event)">
          </pagination-controls>
          <button class="next p-0 btn border-0" [disabled]="currentPage * itemsPerPage >= totalItems"
            (click)="onPageChange(currentPage + 1)">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="m9 5l6 7l-6 7" />
            </svg>
          </button>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<!-- filter popup -->
<app-overlay-filter-box #filterBox [title]="'Filters'">
  <form [formGroup]="filterForm" class="w-100 d-flex flex-column gap-3" (ngSubmit)="applyFilters()">
    <div class="input">
      <label for="department">Departments</label>
      <div class="d-flex align-items-center gap-4">
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <select formControlName="department_id" name="department" id="department" class="form-select">
            <option value="" selected disabled hidden>All</option>
            @for (dept of (departmentList$ | async); track dept.id) {
            <option [value]="dept.id">{{ dept.name }}</option>
            }
          </select>
        </div>
        @if (!filterForm.get('department_id')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="#e04f5f"
            d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
          <path fill="#e04f5f" fill-rule="evenodd"
            d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
            clip-rule="evenodd" />
        </svg>
        } @if (filterForm.get('department_id')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke="#3f9870" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
      </div>
    </div>

    <div class="input">
      <label for="Offenses">Offenses</label>
      <div class="d-flex align-items-center gap-4">
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <select formControlName="offenses" name="Offenses" id="Offenses" class="form-select">
            <option value="" selected disabled hidden>Select</option>
            <option value="late_arrive">Late Arrive</option>
            <option value="early_leave">Early Leave</option>
            <option value="no_show">No Show</option>
          </select>
        </div>
        @if (!filterForm.get('offenses')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="#e04f5f"
            d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
          <path fill="#e04f5f" fill-rule="evenodd"
            d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
            clip-rule="evenodd" />
        </svg>
        } @if (filterForm.get('offenses')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke="#3f9870" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
      </div>
    </div>

    <div class="input">
      <label for="dateRange">Specific date range</label>
      <div class="d-flex align-items-center gap-4">
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input ngxDaterangepickerMd formControlName="from_date" class="form-control" placeholder="Select date range"
            [showDropdowns]="true" [autoApply]="true" [linkedCalendars]="false" [locale]="{ format: 'YYYY-MM-DD' }"
            [maxDate]="todayDayjs" />

          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g fill="none" stroke-width="1.5">
              <path stroke-linecap="round"
                d="M22 14v-2c0-3.771 0-5.657-1.172-6.828S17.771 4 14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12v2c0 3.771 0 5.657 1.172 6.828S6.229 22 10 22h4M7 4V2.5M17 4V2.5" />
              <circle cx="18" cy="18" r="3" />
              <path stroke-linecap="round" d="M20.5 20.5L22 22M2.5 9h19" />
            </g>
          </svg>
        </div>
        @if (!hasSelectedDateRange) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="#e04f5f"
            d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
          <path fill="#e04f5f" fill-rule="evenodd"
            d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
            clip-rule="evenodd" />
        </svg>
        } @if (hasSelectedDateRange) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke="#3f9870" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
      </div>
    </div>

    <div class="input">
      <label for="day-type">Day type</label>
      <div class="d-flex align-items-center gap-4">
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <select formControlName="day_type" name="day-type" id="day-type" class="form-select">
            <option value="" selected disabled hidden>Any</option>
            <option value="workday">Workday</option>
            <option value="weekend">Weekend</option>
            <option value="holiday">Holiday</option>
          </select>
        </div>
        @if (!filterForm.get('day_type')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="#e04f5f"
            d="M10.03 8.97a.75.75 0 0 0-1.06 1.06L10.94 12l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 13.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 12l1.97-1.97a.75.75 0 1 0-1.06-1.06L12 10.94z" />
          <path fill="#e04f5f" fill-rule="evenodd"
            d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
            clip-rule="evenodd" />
        </svg>
        } @if (filterForm.get('day_type')?.value) {
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke="#3f9870" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
      </div>
    </div>

    <div class="d-flex align-items-center gap-3">
      <button type="submit" class="btn btn-lg btn-primary w-100">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <g fill="none" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        <span>Apply Filter</span>
      </button>
      <a type="button" class="text-danger-dark fw-bold w-100 text-center" (click)="resetFilterForm()">
        <span>Clear Filters</span>
      </a>
    </div>
  </form>
</app-overlay-filter-box>

<!-- Discard popup  -->
<app-popup [title]="'Cancel Attendance Log'" [paragraph1]="
    attendanceToCancel
      ? 'Are you sure you want to cancel the attendance log for ' +
        attendanceToCancel.employeeName +
        ' on ' +
        (attendanceToCancel.date | date : 'yyyy-MM-dd') +
        ' (Time: ' +
        formatTimeTo12Hour(attendanceToCancel.times_object?.actual_check_in) +
        ' - ' +
        formatTimeTo12Hour(attendanceToCancel.times_object?.actual_check_out) +
        ')?'
      : ''
  " [paragraph2]="'This action can’t be undone!'" [isOpen]="isModalOpen" (close)="closeModal()">
  <button modal-btn-left class="btn btn-lg btn-danger w-100" (click)="confirmAction()">
    @if (isLoading) {
    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
    } Confirm
  </button>

  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeModal()">
    Cancel
  </button>
</app-popup>