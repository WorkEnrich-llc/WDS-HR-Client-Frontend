<!-- start page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Personal', link: '/attendance-log' },
    { label: 'Attendance Log',link:'/attendance/attendance-log' },
    { label: isEditMode ? 'Edit Attendance Log ' : 'Create New Attendance Log'},
  ]" [title]="isEditMode ? 'Edit Attendance Log ' : 'Create New Attendance Log'" [create]="createDate"
  [update]="updatedDate">

  <button class="btn btn-lg btn-success w-auto d-flex align-items-center gap-2" (click)="save()" [disabled]="isSubmitting">
    @if (isSubmitting) {
      <div class="bubble-loader" aria-hidden="true">
        <span class="bubble"></span>
        <span class="bubble"></span>
        <span class="bubble"></span>
      </div>
      <span>{{ isEditMode ? 'Saving...' : 'Creating...' }}</span>
    } @else {
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
        <g fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="10" />
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
        </g>
      </svg>
      <span>{{ isEditMode ? 'Save Changes' : 'Create Attendance Log' }}</span>
    }
  </button>


  <button class="btn btn-lg btn-outline-dark w-auto" (click)="openModal()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
      </g>
    </svg>
    <span>Discard Attendance Log</span>
  </button>
</app-page-header>


<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Main Information</h2>
    <form [formGroup]="newLogForm" class="w-lg-50 d-flex flex-column gap-2">
      <div class="input">
        <label for="employee_id">Employee<span>*</span></label>
        <div class="d-flex align-items-center gap-4">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            @if (employeesLoading) {
              <div class="placeholder-glow w-100">
                <div class="form-select placeholder w-100" style="height: 38px;"></div>
              </div>
            } @else {
              <select id="employee_id" class="form-select" formControlName="employee_id"
                [class.is-invalid]="newLogForm.get('employee_id')?.touched && newLogForm.get('employee_id')?.errors?.['required']">
                <option value="" selected disabled hidden>Select Employee</option>
                @for (emp of employees; track emp.id) {
                  <option [value]="emp.id">{{ emp.name }}</option>
                }
              </select>
            }
          </div>
        </div>
        @if (newLogForm.get('employee_id')?.touched && newLogForm.get('employee_id')?.errors?.['required']) {
          <p class="error-msg">
            Employee is required.
          </p>
        }
      </div>

          <div class="input">
            <app-date-picker
              label="Select a date"
              placeholder="Select a date"
              [required]="true"
              [disableBeforeDate]="false"
              [maxDate]="maxDate"
              [errorMessage]="dateErrorMessage"
              formControlName="date" />
          </div>

              <div class="input gap-3">
                <label for="start">Logged hours<span>*</span></label>
                <div class="d-flex gap-3">
                  <div class="input w-50">
                    <div class="form-outline w-100 position-relative custom-date-wrapper">
                      <input type="text" id="start" class="form-control custom-date-input" placeholder="Start"
                        formControlName="start" appTimeDisplay />
                      </div>
                      @if (newLogForm.get('start')?.touched && newLogForm.get('start')?.errors?.['required']) {
                        <p class="error-msg">
                          Start time is required.
                        </p>
                      }
                    </div>
                    <div class="input w-50">
                      <div class="form-outline w-100 position-relative custom-date-wrapper">
                        <input type="text" id="end" class="form-control custom-date-input" placeholder="End"
                          formControlName="end" appTimeDisplay />
                        </div>
                        @if (newLogForm.get('end')?.touched && newLogForm.get('end')?.errors?.['required']) {
                          <p class="error-msg">
                            End time is required.
                          </p>
                        }
                      </div>
                    </div>
                  </div>

                </form>
              </div>
            </div>



            <!-- Discard popup  -->
            <app-popup [title]="'Discard Changes'"
              [paragraph1]="'Are you sure you want to discard creating the new attendance log?'"
              [paragraph2]="'This action cannot be undone!'" [isOpen]="isModalOpen" (close)="closeModal()">
              <button modal-btn-left class="btn btn-lg btn-dark w-100" (click)="confirmAction()">
                Discard Changes
              </button>
              <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeModal()">
                Cancel
              </button>
            </app-popup>