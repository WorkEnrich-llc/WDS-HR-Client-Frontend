<div class="overflow-auto">

  <table class="min-w-100">
    <thead>
      <tr *ngIf="columns">
        <th></th>
        <th *ngFor="let col of columns">{{ col.label }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let form of rows(); let rowIndex = index">
        <td>{{ rowIndex + 1 }}</td>
        <td *ngFor="let col of columns; let colIndex = index" class="border p-0">
          <div class="position-relative w-100 p-0">
            <select *ngIf="col.type === 'select'; else textInput" [formControl]="getFormControl(form, col)"
              (input)="inputChanged.emit()" class="form-select no-radius no-padding-input"
              [ngClass]="{ 'invalid': isCellInvalid(form, col) }" (focus)="handleFocus(rowIndex, col.name)"
              (blur)="getFormControl(form, col).markAsTouched(); emitUpdatedRows()">
              <option *ngIf="!col?.options?.length" value="0" disabled>Empty</option>
              <option *ngFor="let opt of col.options" [value]="opt.value">{{ opt.label }}</option>
            </select>



            <ng-template #textInput>
              <input [type]="col.type === 'date' ? 'date' : 'text'" [formControl]="getFormControl(form, col)"
                (input)="inputChanged.emit()" class="form-control no-radius no-padding-input ps-4"
                [ngClass]="{ 'is-invalid': isCellInvalid(form, col) }" (paste)="paste($event, rowIndex, col.name)"
                (focus)="handleFocus(rowIndex, col.name)"
                (blur)="getFormControl(form, col).markAsTouched(); emitUpdatedRows()" />
            </ng-template>



            <svg *ngIf="isCellInvalid(form, col)" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
              class="position-absolute" [ngStyle]="{'inset-inline-end': col.type === 'select' ? '30px' : '8px',
    top: '50%',
    transform: 'translateY(-50%)',
    cursor: 'pointer',
    'z-index': 0
  }" (click)="showErrorPopup(form, col)" viewBox="0 0 24 24">
              <g fill="none">
                <circle cx="12" cy="12" r="10" stroke="#e04f5f" stroke-width="1.5" />
                <path stroke="#e04f5f" stroke-linecap="round" stroke-width="1.5" d="M12 17v-6" />
                <circle cx="1" cy="1" r="1" fill="#e04f5f" transform="matrix(1 0 0 -1 11 9)" />
              </g>
            </svg>


          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>




<app-popup [title]="'Invalid Input'" [paragraph1]="errorPopupMessage" [isOpen]="ErrorPopup" (close)="closeErrorPOP()">
  <button modal-btn-left class="btn btn-lg btn-primary w-50" (click)="closeErrorPOP()">
    Ok, Got it!
  </button>
</app-popup>