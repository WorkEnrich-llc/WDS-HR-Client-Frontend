<!-- page header -->
<app-page-header [breadcrumbs]="breadcrumbs" [title]="pageTitle" [create]="todayFormatted">
    <button class="btn btn-lg btn-success w-auto"
        [disabled]="isSubmitting || !bonusDeductionForm.valid || !hasSelectedRecipients()" (click)="onSubmit()">
        @if (isSubmitting) {
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        }
        @if (!isSubmitting) {
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
            </g>
        </svg>
        }
        <span>Save Bonus/Deduction</span>
    </button>
    <button class="btn btn-lg btn-outline-dark w-auto" (click)="onDiscard()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10" />
                <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
            </g>
        </svg>
        <span>Discard Entry</span>
    </button>
</app-page-header>

<!-- steps navigation -->
<ul class="nav d-flex align-items-center nav-tabs bg-white px-3">
    <li class="nav-item" [ngClass]="{ 'active': currentTab === 'main-info' }">
        <span class="nav-link d-flex align-items-center gap-1">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path opacity="0.3"
                    d="M16.5 9C16.5 13.1421 13.1421 16.5 9 16.5C4.85786 16.5 1.5 13.1421 1.5 9C1.5 4.85786 4.85786 1.5 9 1.5C13.1421 1.5 16.5 4.85786 16.5 9Z"
                    fill="#377AFD" />
                <path
                    d="M9 13.3125C9.31066 13.3125 9.5625 13.0607 9.5625 12.75V8.25C9.5625 7.93934 9.31066 7.6875 9 7.6875C8.68934 7.6875 8.4375 7.93934 8.4375 8.25V12.75C8.4375 13.0607 8.68934 13.3125 9 13.3125Z"
                    fill="#4A6D97" />
                <path
                    d="M9 5.25C9.41421 5.25 9.75 5.58579 9.75 6C9.75 6.41421 9.41421 6.75 9 6.75C8.58579 6.75 8.25 6.41421 8.25 6C8.25 5.58579 8.58579 5.25 9 5.25Z"
                    fill="#4A6D97" />
            </svg>

            Main Info
        </span>
    </li>
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
        [style.fill]="currentTab === 'main-info' ? '#DDE3EB' : '#377AFD'">
        <path
            d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
    </svg>
    <li class="nav-item" [ngClass]="{ 'active': currentTab === 'recipients' }">
        <span class="nav-link d-flex align-items-center gap-1">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M11.625 5.625C11.625 7.07475 10.4497 8.25 9 8.25C7.55025 8.25 6.375 7.07475 6.375 5.625C6.375 4.17525 7.55025 3 9 3C10.4497 3 11.625 4.17525 11.625 5.625Z"
                    fill="#4A6D97" />
                <path opacity="0.4"
                    d="M14.625 5.625C14.625 6.66053 13.7855 7.5 12.75 7.5C11.7145 7.5 10.875 6.66053 10.875 5.625C10.875 4.58947 11.7145 3.75 12.75 3.75C13.7855 3.75 14.625 4.58947 14.625 5.625Z"
                    fill="#4A6D97" />
                <path opacity="0.4"
                    d="M3.375 5.625C3.375 6.66053 4.21447 7.5 5.25 7.5C6.28553 7.5 7.125 6.66053 7.125 5.625C7.125 4.58947 6.28553 3.75 5.25 3.75C4.21447 3.75 3.375 4.58947 3.375 5.625Z"
                    fill="#4A6D97" />
                <path
                    d="M13.5 12.375C13.5 13.8247 11.4853 15 9 15C6.51472 15 4.5 13.8247 4.5 12.375C4.5 10.9253 6.51472 9.75 9 9.75C11.4853 9.75 13.5 10.9253 13.5 12.375Z"
                    fill="#4A6D97" />
                <path opacity="0.4"
                    d="M16.5 12.375C16.5 13.4105 15.1569 14.25 13.5 14.25C11.8431 14.25 10.5 13.4105 10.5 12.375C10.5 11.3395 11.8431 10.5 13.5 10.5C15.1569 10.5 16.5 11.3395 16.5 12.375Z"
                    fill="#4A6D97" />
                <path opacity="0.4"
                    d="M1.5 12.375C1.5 13.4105 2.84315 14.25 4.5 14.25C6.15685 14.25 7.5 13.4105 7.5 12.375C7.5 11.3395 6.15685 10.5 4.5 10.5C2.84315 10.5 1.5 11.3395 1.5 12.375Z"
                    fill="#4A6D97" />
            </svg>

            Recipient(s)
        </span>
    </li>
</ul>

<!-- step 1 -->
@if (currentTab === 'main-info') {
<div class="content-hug">
    <div class="content-box d-flex flex-column gap-3">
        <h2>Main Information</h2>

        @if (isLoadingEdit) {
        <!-- Skeleton Loader for Edit Mode -->
        <div class="skeleton-loader-form w-lg-50">
            <div class="skeleton-field-group">
                <div class="skeleton-label"></div>
                <div class="skeleton-input"></div>
            </div>
            <div class="skeleton-field-group">
                <div class="skeleton-label"></div>
                <div class="skeleton-input"></div>
            </div>
            <div class="skeleton-field-group">
                <div class="skeleton-label"></div>
                <div class="skeleton-input"></div>
            </div>
            <div class="skeleton-field-group">
                <div class="skeleton-label"></div>
                <div class="skeleton-input"></div>
            </div>
            <div class="skeleton-field-group">
                <div class="skeleton-label"></div>
                <div class="skeleton-input"></div>
            </div>
        </div>
        } @else {
        <!-- Actual Form -->
        <form [formGroup]="bonusDeductionForm" class="w-lg-50 d-flex flex-column gap-2">
            <div class="input">
                <label for="title">Title <span>*</span></label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <input formControlName="title" type="text" id="title" class="form-control custom-date-input"
                        placeholder="Enter a Title" />
                </div>
                @if (bonusDeductionForm.get('title')?.touched && bonusDeductionForm.get('title')?.errors?.['required'])
                {
                <p class="error-msg">Title is required.</p>
                }
                @if (bonusDeductionForm.get('title')?.touched && bonusDeductionForm.get('title')?.errors?.['minLengthWithoutSpaces'])
                {
                <p class="error-msg">Title must be at least 3 characters long</p>
                }
            </div>
            <div class="input">
                <label for="classification">Classification <span>*</span></label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <select formControlName="classification" id="classification" class="form-control custom-date-input">
                        <option value="" disabled selected>Bonus or Deduction</option>
                        <option value="bonus">Bonus</option>
                        <option value="deduction">Deduction</option>
                    </select>
                </div>
                @if (bonusDeductionForm.get('classification')?.touched &&
                bonusDeductionForm.get('classification')?.errors?.['required']) {
                <p class="error-msg">Classification is required.</p>
                }
            </div>
            <div class="input">
                <label for="date">Date <span>*</span></label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <input formControlName="date" type="date" id="date" class="form-control custom-date-input"
                        placeholder="Select date" />
                </div>
                @if (bonusDeductionForm.get('date')?.touched && bonusDeductionForm.get('date')?.errors?.['required']) {
                <p class="error-msg">Date is required.</p>
                }
                @if (bonusDeductionForm.get('date')?.touched &&
                bonusDeductionForm.get('date')?.errors?.['previousMonth']) {
                <p class="error-msg">Date cannot be from a previous month.</p>
                }
            </div>
            <div class="input">
                <label for="days">Days <span>*</span></label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <input formControlName="days" type="number" id="days" class="form-control custom-date-input"
                        placeholder="Amount of Days" min="1" />
                </div>
                @if (bonusDeductionForm.get('days')?.touched && bonusDeductionForm.get('days')?.errors?.['required']) {
                <p class="error-msg">Days is required.</p>
                }
                @if (bonusDeductionForm.get('days')?.touched && bonusDeductionForm.get('days')?.errors?.['pattern']) {
                <p class="error-msg">Days must be a valid number.</p>
                }
            </div>
            <div class="input">
                <label for="salaryPortion">Salary Portion <span>*</span></label>
                <div class="form-outline w-100 position-relative custom-date-wrapper">
                    <select formControlName="salaryPortion" id="salaryPortion" class="form-control custom-date-input">
                        <option value="" disabled selected>Select Salary Portion</option>
                        @for (sp of salaryPortions.settings; track sp.index) {
                        <option [value]="sp.name">{{ sp.name }} {{ sp.percentage }}{{ sp.percentage !== '' ? ' (%)' : ''
                            }}{{ sp.default ? ' - Default' : ''
                            }}</option>
                        }
                    </select>
                </div>
                @if (bonusDeductionForm.get('salaryPortion')?.touched &&
                bonusDeductionForm.get('salaryPortion')?.errors?.['required']) {
                <p class="error-msg">Salary Portion is required.</p>
                }
            </div>
        </form>
        }

        @if (!isLoadingEdit) {
        <div class="btn-fixed">
            <button class="btn btn-lg btn-primary" [disabled]="!isFormValidForNext()" (click)="goToNextTab()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="1.5" d="M4 12h16m0 0l-6-6m6 6l-6 6" />
                </svg>
                <span>Next</span>
            </button>
        </div>
        }
    </div>
</div>
}


<!-- step 2 (recipients) -->
@if (currentTab === 'recipients') {
<div class="content-hug">
    <div class="content-box d-flex flex-column gap-3">

        <!-- Recipient Type Radios (visible in page) -->
        <div class="d-flex flex-wrap align-items-center recipients-radio-group mb-3">
            <label class="form-check d-inline-flex align-items-center gap-2">
                <input class="form-check-input" type="radio" name="recipientTypeMain" value="department"
                    [checked]="selectedRecipientType==='department'" (change)="setRecipientType('department')">
                <span>Department(s)</span>
            </label>
            <label class="form-check d-inline-flex align-items-center gap-2">
                <input class="form-check-input" type="radio" name="recipientTypeMain" value="section"
                    [checked]="selectedRecipientType==='section'" (change)="setRecipientType('section')">
                <span>Section(s)</span>
            </label>
            <label class="form-check d-inline-flex align-items-center gap-2">
                <input class="form-check-input" type="radio" name="recipientTypeMain" value="employee"
                    [checked]="selectedRecipientType==='employee'" (change)="setRecipientType('employee')">
                <span>Employee(s)</span>
            </label>
            <label class="form-check d-inline-flex align-items-center gap-2">
                <input class="form-check-input" type="radio" name="recipientTypeMain" value="branch"
                    [checked]="selectedRecipientType==='branch'" (change)="setRecipientType('branch')">
                <span>Branch(s)</span>
            </label>
            <label class="form-check d-inline-flex align-items-center gap-2">
                <input class="form-check-input" type="radio" name="recipientTypeMain" value="company"
                    [checked]="selectedRecipientType==='company'" (change)="setRecipientType('company')">
                <span>Company</span>
            </label>
        </div>

        <!-- Company Selection Message -->
        @if (selectedRecipientType === 'company') {
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2">
                <path
                    d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
                    fill="currentColor" />
            </svg>
            <div>
                <strong>Company Selected:</strong> The entry will be sent to <strong>{{ getCompanyName() }}</strong>
                automatically.
            </div>
        </div>
        }

        <!-- Search Bar -->
        @if (selectedRecipientType !== 'company') {
        <div class="search-container">
            <div class="form-outline position-relative w-50">
                <input type="text" class="form-control custom-date-input" placeholder="Search"
                    [(ngModel)]="selectedSearchTerm" (input)="onSelectedSearchInput()">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"
                    class="search-icon">
                    <g clip-path="url(#clip0_620_11014)">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M8.625 2.0625C5.00063 2.0625 2.0625 5.00063 2.0625 8.625C2.0625 12.2494 5.00063 15.1875 8.625 15.1875C12.2494 15.1875 15.1875 12.2494 15.1875 8.625C15.1875 5.00063 12.2494 2.0625 8.625 2.0625ZM0.9375 8.625C0.9375 4.37931 4.37931 0.9375 8.625 0.9375C12.8707 0.9375 16.3125 4.37931 16.3125 8.625C16.3125 10.5454 15.6083 12.3013 14.4441 13.6487L16.8977 16.1023C17.1174 16.3219 17.1174 16.6781 16.8977 16.8977C16.6781 17.1174 16.3219 17.1174 16.1023 16.8977L13.6487 14.4441C12.3013 15.6083 10.5454 16.3125 8.625 16.3125C4.37931 16.3125 0.9375 12.8707 0.9375 8.625Z"
                            fill="#4A6D97" />
                    </g>
                    <defs>
                        <clipPath id="clip0_620_11014">
                            <rect width="18" height="18" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </div>
        </div>
        }

        <!-- Add Recipient Button -->
        @if (selectedRecipientType !== 'company') {
        <div class="d-flex justify-content-between align-items-center mb-3">
            <a class="add-department-link" style="cursor: pointer;" (click)="openDepartmentSelection()">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 1.5V16.5M1.5 9H16.5" stroke="#377AFD" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span>Add {{ getRecipientLabelWithS() }}</span>
            </a>
        </div>
        }

        <!-- Validation message for recipients -->
        @if (!hasSelectedRecipients()) {
        <div class="alert alert-warning d-flex align-items-center" role="alert">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="me-2">
                <path
                    d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
                    fill="currentColor" />
            </svg>
            <div>
                <strong>No recipients selected!</strong> Please select at least one {{
                getRecipientLabelWithS().toLowerCase() }}.
            </div>
        </div>
        }

        <!-- Selected List Table -->
        <app-table [data]="getSelectedDepartmentsPage()" [totalItems]="tableTotalItems"
            [itemsPerPage]="tableItemsPerPage" [currentPage]="tableCurrentPage" [isLoading]="tableIsLoading"
            [columnsCount]="3" [headerTemplate]="selectedDepartmentsHeaderTemplate"
            [rowTemplate]="selectedDepartmentRowTemplate" [emptyTemplate]="selectedDepartmentsEmptyTemplate"
            [disablePagination]="!shouldShowDepartmentsPagination()" (pageChange)="onTablePageChange($event)"
            (itemsPerPageChange)="onTableItemsPerPageChange($event)">
        </app-table>

        <!-- Table Templates -->
        <ng-template #selectedDepartmentsHeaderTemplate>
            <th class="">ID</th>
            <th class="">Name</th>
            <th class=" text-end">Actions</th>
        </ng-template>

        <ng-template #selectedDepartmentRowTemplate let-row>
            <td>{{ row.id }}</td>
            <td>{{ row.name }}</td>
            <td class="text-end">
                <a class="view-link text-danger" (click)="removeDepartment(row)" style="cursor: pointer;">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M2.8125 5.625C2.8125 5.31434 3.06434 5.0625 3.375 5.0625H14.625C14.9357 5.0625 15.1875 5.31434 15.1875 5.625C15.1875 5.93566 14.9357 6.1875 14.625 6.1875H14.0625V13.5C14.0625 14.0967 13.8256 14.669 13.4053 15.0893C12.985 15.5096 12.4127 15.7465 11.8125 15.7465H6.1875C5.58832 15.7465 5.01497 15.5096 4.59467 15.0893C4.17438 14.669 3.9375 14.0967 3.9375 13.5V6.1875H3.375C3.06434 6.1875 2.8125 5.93566 2.8125 5.625ZM5.0625 6.1875V13.5C5.0625 13.7984 5.18103 14.0845 5.39029 14.2937C5.59955 14.503 5.88571 14.6215 6.1875 14.6215H11.8125C12.1143 14.6215 12.4004 14.503 12.6097 14.2937C12.819 14.0845 12.9375 13.7984 12.9375 13.5V6.1875H5.0625Z"
                            fill="#E53E3E" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M7.3125 3.375C7.3125 3.22582 7.37176 3.08274 7.47725 2.97725C7.58274 2.87176 7.72582 2.8125 7.875 2.8125H10.125C10.2742 2.8125 10.4173 2.87176 10.5227 2.97725C10.6282 3.08274 10.6875 3.22582 10.6875 3.375V5.0625H11.8125V3.375C11.8125 2.92745 11.6347 2.49823 11.3182 2.1818C11.0018 1.86538 10.5726 1.6875 10.125 1.6875H7.875C7.42745 1.6875 6.99823 1.86538 6.6818 2.1818C6.36538 2.49823 6.1875 2.92745 6.1875 3.375V5.0625H7.3125V3.375Z"
                            fill="#E53E3E" />
                    </svg>
                    <span>Delete</span>
                </a>
            </td>
        </ng-template>

        <ng-template #selectedDepartmentsEmptyTemplate>
            <tr>
                <td colspan="3" class="no-data py-4 text-center">No {{ getRecipientLabelWithS() }} Selected.</td>
            </tr>
        </ng-template>


        <!-- Overlay for selection (full logic/UI from create-announcement) -->
        <app-overlay-filter-box #departmentFilterBox [title]="'Select ' + getRecipientLabelWithS()"
            [customWidth]="'40%'">
            <div class="w-100 d-flex flex-column gap-3">
                <!-- Department Dropdown for Sections -->
                @if (selectedRecipientType === 'section') {
                <div class="form-outline position-relative">
                    <select class="form-control custom-date-input" [(ngModel)]="selectedDepartmentId"
                        (change)="onDepartmentSelected($any($event.target).value)" [disabled]="isLoadingItems">
                        <option [ngValue]="null" disabled>
                            Select a department to load its sections
                        </option>
                        @for (dept of availableDepartments; track dept.id) {
                        <option [value]="dept.id">{{ dept.name }}</option>
                        }
                    </select>
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="search-icon">
                        <path d="M6 7.5L9 10.5L12 7.5" stroke="#6B7280" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </div>
                }

                <!-- Search bar for modal (not for company) -->
                @if (selectedRecipientType !== 'company') {
                <div class="form-outline position-relative w-100">
                    <input type="text" class="form-control custom-date-input" placeholder="Search"
                        [(ngModel)]="modalSearchTerm" (input)="onModalSearchInput($event)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="search-icon">
                        <g clip-path="url(#clip0_620_11014)">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.625 2.0625C5.00063 2.0625 2.0625 5.00063 2.0625 8.625C2.0625 12.2494 5.00063 15.1875 8.625 15.1875C12.2494 15.1875 15.1875 12.2494 15.1875 8.625C15.1875 5.00063 12.2494 2.0625 8.625 2.0625ZM0.9375 8.625C0.9375 4.37931 4.37931 0.9375 8.625 0.9375C12.8707 0.9375 16.3125 4.37931 16.3125 8.625C16.3125 10.5454 15.6083 12.3013 14.4441 13.6487L16.8977 16.1023C17.1174 16.3219 17.1174 16.6781 16.8977 16.8977C16.6781 17.1174 16.3219 17.1174 16.1023 16.8977L13.6487 14.4441C12.3013 15.6083 10.5454 16.3125 8.625 16.3125C4.37931 16.3125 0.9375 12.8707 0.9375 8.625Z"
                                fill="#4A6D97" />
                        </g>
                        <defs>
                            <clipPath id="clip0_620_11014">
                                <rect width="18" height="18" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                }

                <!-- Table for available items (departments, sections, employees, branches) -->
                <app-table [data]="availableItems" [totalItems]="totalItems" [itemsPerPage]="itemsPerPage"
                    [currentPage]="currentPage" [isLoading]="isLoadingItems" [columnsCount]="1"
                    [headerTemplate]="availableDepartmentsHeaderTemplate" [rowTemplate]="availableDepartmentRowTemplate"
                    [emptyTemplate]="availableDepartmentsEmptyTemplate" (pageChange)="onModalTablePageChange($event)"
                    (itemsPerPageChange)="onModalTableItemsPerPageChange($event)">
                </app-table>

                <!-- Table Templates for modal -->
                <ng-template #availableDepartmentsHeaderTemplate>
                    <th colspan="1" class="department-only-header">
                        <div class="department-only-header-inner">
                            <span>{{ getRecipientLabelWithS() }}</span>
                        </div>
                    </th>
                </ng-template>

                <ng-template #availableDepartmentRowTemplate let-row>
                    <td colspan="1">
                        <div class="department-row d-flex align-items-start gap-3"
                            (click)="toggleDepartmentSelection(row)">
                            <input type="checkbox" class="department-square-checkbox mt-1"
                                [checked]="isDepartmentSelected(row)"
                                (click)="$event.stopPropagation(); toggleDepartmentSelection(row)">
                            <div class="d-flex flex-column">
                                <span class="department-id-label">{{ row.code || row.id }}</span>
                                <span class="department-name-label">{{ row.name }}</span>
                            </div>
                        </div>
                    </td>
                </ng-template>

                <ng-template #availableDepartmentsEmptyTemplate>
                    <tr>
                        <td colspan="1" class="text-center py-4">
                            <div class="empty-state">
                                <p class="text-muted mb-0">No {{ getRecipientLabelWithS() }} found.</p>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <!-- Action Buttons -->
                <div class="d-flex align-items-center gap-3">
                    <button type="button" class="btn btn-lg btn-primary w-100" (click)="saveSelectedDepartments()">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12.0227 7.52275C12.2424 7.30308 12.2424 6.94692 12.0227 6.72725C11.8031 6.50758 11.4469 6.50758 11.2273 6.72725L7.875 10.0795L6.77275 8.97725C6.55308 8.75758 6.19692 8.75758 5.97725 8.97725C5.75758 9.19692 5.75758 9.55308 5.97725 9.77275L7.47725 11.2727C7.69692 11.4924 8.05308 11.4924 8.27275 11.2727L12.0227 7.52275Z"
                                fill="#E0EBFF" />
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M9 0.9375C4.5472 0.9375 0.9375 4.5472 0.9375 9C0.9375 13.4528 4.5472 17.0625 9 17.0625C13.4528 17.0625 17.0625 13.4528 17.0625 9C17.0625 4.5472 13.4528 0.9375 9 0.9375ZM2.0625 9C2.0625 5.16852 5.16852 2.0625 9 2.0625C12.8315 2.0625 15.9375 5.16852 15.9375 9C15.9375 12.8315 12.8315 15.9375 9 15.9375C5.16852 15.9375 2.0625 12.8315 2.0625 9Z"
                                fill="#E0EBFF" />
                        </svg>
                        <span>Confirm</span>
                    </button>
                    <a (click)="closeDepartmentSelection()"
                        class="text-danger-dark fw-bold w-100 text-center cursor-pointer">
                        <span>Discard</span>
                    </a>
                </div>
            </div>
        </app-overlay-filter-box>

        <!-- Actions -->
        <div class="btn-fixed">
            <div class="d-flex align-items-center gap-2">
                <button class="btn back-square-btn" (click)="goToPreviousTab()" title="Back">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                        <path fill="none" stroke="#4A6D97" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5" d="M15 5l-6 7l6 7" />
                    </svg>
                </button>
                <button class="btn btn-lg btn-success" [disabled]="isSubmitting" (click)="onSubmit()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
                        </g>
                    </svg>
                    <span>Save Bonus/Deduction</span>
                </button>
            </div>
        </div>
    </div>
</div>
}