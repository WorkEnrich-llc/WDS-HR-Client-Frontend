<!-- start page header -->
<app-page-header
  [breadcrumbs]="[
    { label: 'Payroll', link: '/payroll-components' },
    { label: 'Taxes', link: '/taxes/all-taxes' },
    { label: 'Tax Details' }
  ]"
  title="Tax Details"
>
  <button
    class="btn btn-lg btn-primary w-auto"
    [routerLink]="['/taxes/manage-taxes', tax?.id]"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="22"
      height="22"
      viewBox="0 0 24 24"
    >
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <path
          stroke-linecap="round"
          d="M22 10.5V12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2h1.5"
        />
        <path
          d="m16.652 3.455l.649-.649A2.753 2.753 0 0 1 21.194 6.7l-.65.649m-3.892-3.893s.081 1.379 1.298 2.595c1.216 1.217 2.595 1.298 2.595 1.298m-3.893-3.893L10.687 9.42c-.404.404-.606.606-.78.829q-.308.395-.524.848c-.121.255-.211.526-.392 1.068L8.412 13.9m12.133-6.552l-5.965 5.965c-.404.404-.606.606-.829.78a4.6 4.6 0 0 1-.848.524c-.255.121-.526.211-1.068.392l-1.735.579m0 0l-1.123.374a.742.742 0 0 1-.939-.94l.374-1.122m1.688 1.688L8.412 13.9"
        />
      </g>
    </svg>
    <span>Edit Tax</span>
  </button>

  @if (tax?.is_active) {
  <button
    class="btn btn-lg btn-outline-danger w-auto"
    (click)="openDeactivate()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="22"
      height="22"
      viewBox="0 0 24 24"
    >
      <path
        fill="none"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-width="1.5"
        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294"
      />
    </svg>
    <span>Deactivate</span>
  </button>
  }
</app-page-header>
<!-- end page header -->

<div class="content-hug">
  @if (isLoading) {
  <!-- Skeleton Loader -->
  <div class="content-box d-flex flex-column gap-3">
    <h2>Main Information</h2>
    @for (i of [1,2,3,4,5]; track i) {
    <div class="info">
      <div class="skeleton-line skeleton-label"></div>
      <div class="skeleton-line skeleton-value"></div>
    </div>
    }
  </div>
  <div class="content-box mt-3">
    <h5 class="mb-4 fw-semibold card-section-header">Tax Brackets</h5>
    <div class="skeleton-line" style="height: 200px"></div>
  </div>
  } @else if (tax) {
  <div class="content-box d-flex flex-column gap-3">
    <h2>Main Information</h2>
    <div class="info">
      <h6>Tax ID</h6>
      <span>{{ tax.id.toString().padStart(4, "0") }}</span>
    </div>
    <div class="info">
      <h6>Tax Name</h6>
      <span>{{ tax.name }}</span>
    </div>
    <div class="info">
      <h6>Minimum Annual Salary</h6>
      <span>{{ tax.minimum | number }}</span>
    </div>
    <div class="info">
      <h6>Maximum Annual Salary</h6>
      <span>{{ tax.maximum | number }}</span>
    </div>
    <div class="info">
      <h6>Exempted Amount</h6>
      <span>{{ tax.exemption | number }}</span>
    </div>
  </div>

  <div class="content-box mt-3">
    <h5 class="mb-4 fw-semibold card-section-header">Tax Brackets</h5>
    <app-table
      [data]="tax.brackets || []"
      [isLoading]="isLoading"
      [columnsCount]="5"
      [totalItems]="(tax.brackets || []).length"
      [itemsPerPage]="(tax.brackets || []).length"
      [currentPage]="1"
      [disablePagination]="true"
      [headerTemplate]="bracketsTableHeader"
      [rowTemplate]="bracketsTableRow"
      [emptyTemplate]="noBrackets"
    ></app-table>

    <ng-template #bracketsTableHeader>
      <th class="w-20">Tax Bracket</th>
      <th class="w-20">Minimum</th>
      <th class="w-20">Maximum</th>
      <th class="w-20">Taxable Amount</th>
      <th class="w-20">Tax Percentage</th>
    </ng-template>

    <ng-template #bracketsTableRow let-bracket>
      <td>
        <span class="d-block text-gray-sm">{{
          bracket.id.toString().padStart(4, "0")
        }}</span>
      </td>
      <td>{{ bracket.minimum | number }}</td>
      <td>{{ bracket.maximum | number }}</td>
      <td>{{ bracket.taxable | number }}</td>
      <td>{{ bracket.percentage }}%</td>
    </ng-template>

    <ng-template #noBrackets>
      <tr>
        <td colspan="5" class="text-center py-4">No tax brackets found</td>
      </tr>
    </ng-template>
  </div>
  } @else {
  <div class="content-box">
    <div class="text-center py-4">
      <p>Tax not found</p>
    </div>
  </div>
  }
</div>

<!-- deactivate popup -->
<app-popup
  [title]="'Deactivate Tax'"
  [paragraph1]="getDeactivateMessage()"
  [paragraph2]="
    'This will only hold any access this tax has to the system. You can activate it at any time later.'
  "
  [isOpen]="deactivateOpen"
  (close)="closeDeactivate()"
>
  <button
    modal-btn-left
    class="btn btn-lg btn-danger w-100"
    (click)="confirmDeactivate()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="22"
      height="22"
      viewBox="0 0 24 24"
    >
      <path
        fill="none"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-width="1.5"
        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294"
      />
    </svg>
    <span>Deactivate</span>
  </button>
  <button
    modal-btn-right
    class="btn btn-lg btn-outline-dark border-0 w-100"
    (click)="closeDeactivate()"
  >
    Cancel
  </button>
</app-popup>

<!-- activate popup -->
<app-popup
  [title]="'Activate Tax'"
  [paragraph1]="getActivateMessage()"
  [paragraph2]="'You can deactivate it at any time later.'"
  [isOpen]="activateOpen"
  (close)="closeActivate()"
>
  <button
    modal-btn-left
    class="btn btn-lg btn-success w-100"
    (click)="confirmActivate()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="22"
      height="22"
      viewBox="0 0 24 24"
    >
      <path
        fill="none"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-width="1.5"
        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294"
      />
    </svg>
    <span>Activate</span>
  </button>
  <button
    modal-btn-right
    class="btn btn-lg btn-outline-dark border-0 w-100"
    (click)="closeActivate()"
  >
    Cancel
  </button>
</app-popup>
