<!-- page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Operational Development', link: '/departments' },
    { label: 'Department Checklist',link:'/dept-check' },
    { label: 'Edit Department Checklist'},
  ]" title="Edit Department Checklist">

</app-page-header>


<!-- page content -->
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Checklist</h2>

    @if (checks.length > 0) {
    <div class="checks pt-1">

      @for (check of checks; track $index; let i = $index) {
      <label class="onecheck d-flex align-items-center justify-content-between" draggable="true"
        (dragstart)="onDragStart(i)" (dragend)="onDragEnd()" (dragover)="allowDrop($event, i)"
        (drop)="onDrop($event, i)" [class.dragging]="draggedIndex === i" [class.drag-over]="dragOverIndex === i">

        <div class="d-flex align-items-center gap-3">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M17 3.25C17.2361 3.25 17.4584 3.36115 17.6 3.55L20.6 7.55C20.8485 7.88137 20.7814 8.35147 20.45 8.6C20.1186 8.84853 19.6485 8.78137 19.4 8.45L17.75 6.25V17.75L19.4 15.55C19.6485 15.2186 20.1186 15.1515 20.45 15.4C20.7814 15.6485 20.8485 16.1186 20.6 16.45L17.6 20.45C17.4584 20.6389 17.2361 20.75 17 20.75C16.7639 20.75 16.5416 20.6389 16.4 20.45L13.4 16.45C13.1515 16.1186 13.2186 15.6485 13.55 15.4C13.8814 15.1515 14.3515 15.2186 14.6 15.55L16.25 17.75V6.25L14.6 8.45C14.3515 8.78137 13.8814 8.84853 13.55 8.6C13.2186 8.35147 13.1515 7.88137 13.4 7.55L16.4 3.55C16.5416 3.36115 16.7639 3.25 17 3.25ZM3.25 7C3.25 6.58579 3.58579 6.25 4 6.25H11C11.4142 6.25 11.75 6.58579 11.75 7C11.75 7.41421 11.4142 7.75 11 7.75H4C3.58579 7.75 3.25 7.41421 3.25 7ZM3.25 12C3.25 11.5858 3.58579 11.25 4 11.25H11C11.4142 11.25 11.75 11.5858 11.75 12C11.75 12.4142 11.4142 12.75 11 12.75H4C3.58579 12.75 3.25 12.4142 3.25 12ZM3.25 17C3.25 16.5858 3.58579 16.25 4 16.25H11C11.4142 16.25 11.75 16.5858 11.75 17C11.75 17.4142 11.4142 17.75 11 17.75H4C3.58579 17.75 3.25 17.4142 3.25 17Z"
              fill="#4A6D97" />
          </svg>

          <span class="number">{{ $index + 1 }}</span>

          <p class="m-0">{{ check.name }}</p>

        </div>
        <div class="d-flex align-items-center gap-4">
          <div>
            <span class="text-muted me-3">|</span>
            <strong><span>{{check.points}}</span> Points</strong>
          </div>
          <button type="button" class="remove-btn" (click)="removeCheck(i)">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M12 2.75a2.25 2.25 0 0 0-2.122 1.5a.75.75 0 0 1-1.414-.5a3.751 3.751 0 0 1 7.073 0a.75.75 0 0 1-1.415.5A2.25 2.25 0 0 0 12 2.75M2.75 6a.75.75 0 0 1 .75-.75h17a.75.75 0 0 1 0 1.5h-17A.75.75 0 0 1 2.75 6m3.165 2.45a.75.75 0 1 0-1.497.1l.464 6.952c.085 1.282.154 2.318.316 3.132c.169.845.455 1.551 1.047 2.104s1.315.793 2.17.904c.822.108 1.86.108 3.146.108h.879c1.285 0 2.324 0 3.146-.108c.854-.111 1.578-.35 2.17-.904c.591-.553.877-1.26 1.046-2.104c.162-.814.23-1.85.316-3.132l.464-6.952a.75.75 0 0 0-1.497-.1l-.46 6.9c-.09 1.347-.154 2.285-.294 2.99c-.137.685-.327 1.047-.6 1.303c-.274.256-.648.422-1.34.512c-.713.093-1.653.095-3.004.095h-.774c-1.35 0-2.29-.002-3.004-.095c-.692-.09-1.066-.256-1.34-.512c-.273-.256-.463-.618-.6-1.303c-.14-.705-.204-1.643-.294-2.99z" />
              <path fill="currentColor"
                d="M9.425 10.254a.75.75 0 0 1 .821.671l.5 5a.75.75 0 0 1-1.492.15l-.5-5a.75.75 0 0 1 .671-.821m5.821.821a.75.75 0 0 0-1.492-.15l-.5 5a.75.75 0 0 0 1.492.15z" />
            </svg>
          </button>
        </div>

      </label>

      }
    </div>
    }


    <form [formGroup]="checkForm" (ngSubmit)="addCheck()" class="d-flex flex-column gap-3">

      @if (!showInput) {
      <button type="button" class="btn btn-lg btn-outline-primary w-auto" (click)="showAddInput()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
          </g>
        </svg>
        <span>Add Checklist Item</span>
      </button>
      }

      @if (showInput) {
      <div class="d-flex align-items-start gap-3">
        <div class="input w-100">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <input type="text" id="checkName" class="form-control custom-date-input" placeholder="Enter Checklist Item"
              formControlName="checkName" />
          </div>
          @if (checkForm.get('checkName')?.touched && checkForm.get('checkName')?.errors?.['required']) {
          <p class="error-msg">
            Checklist Item is required.
          </p>
          }
          @if (checkForm.get('checkName')?.touched && checkForm.get('checkName')?.errors?.['maxlength']) {
          <p class="error-msg">
            Checklist Item maxlength 100 only.
          </p>
          }
        </div>
        <div class="input w-25">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <input type="text" id="checkName" class="form-control custom-date-input"
              placeholder="Enter Checklist Points" formControlName="checkPoint" />
          </div>
          @if (checkForm.get('checkPoint')?.touched && checkForm.get('checkPoint')?.errors?.['required']) {
          <p class="error-msg">
            Points is required.
          </p>
          }
          @if (checkForm.get('checkPoint')?.touched && checkForm.get('checkPoint')?.errors?.['pattern']) {
          <p class="error-msg">
            Numbers only.
          </p>
          }
        </div>
      </div>

      <button type="submit" class="btn btn-lg btn-outline-primary w-auto">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" d="M15 12h-3m0 0H9m3 0V9m0 3v3" />
          </g>
        </svg>
        <span>Save Checklist Item</span>
      </button>
      }

    </form>


  </div>
</div>