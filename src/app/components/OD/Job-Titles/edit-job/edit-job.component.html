<!-- page header -->
<app-page-header [breadcrumbs]="[
    { label: 'Operations Development', link: '/departments' },
    { label: 'Job Titles', link: '/jobs' },
    { label: 'Edit Job '+ jobTitleData?.name }
  ]" [title]="'Edit Job - '+ jobTitleData?.name" [create]="formattedCreatedAt" [update]="formattedUpdatedAt"
  [isLoading]="loadData">
  @if(!loadData){
  @if (jobTitleSub?.update){
  <button class="btn btn-lg btn-success" (click)="updateJobTitle()"
    [disabled]="!jobStep4.valid || requirements.length === 0|| !jobStep1.valid || !jobStep2.valid || !hasChanges || isLoading ||!hasAssignedManager()">
    @if (isLoading) {
    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
    }
    @if (!isLoading) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
      </g>
    </svg>
    }
    <span>Save Changes</span>
  </button>
  }


  <button class="btn btn-lg btn-outline-dark w-auto" (click)="openModal()">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <g fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10" />
        <path stroke-linecap="round" d="m14.5 9.5l-5 5m0-5l5 5" />
      </g>
    </svg>
    <span>Discard Changes</span>
  </button>
  }

</app-page-header>



<!-- steps navigation -->
<ul class="nav d-flex align-items-center nav-tabs bg-white px-3">
  <li class="nav-item" [ngClass]="{
        'active': currentStep === 1,
        'text-success': currentStep > 1, 
        'bg-light-success': currentStep > 1  
    }" (click)="goToStep(1)" style="cursor: pointer;">
    @if (currentStep == 1) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
      <path
        d="M12 17.75a.75.75 0 0 0 .75-.75v-6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75M12 7a1 1 0 1 1 0 2a1 1 0 0 1 0-2" />
    </svg>
    }
    @if (currentStep > 1) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
      [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
      <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
      <path
        d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
    </svg>
    }
    <span class="nav-link">Main Information</span>
  </li>

  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" [style.fill]="
    currentStep === 1 ? '#DDE3EB' :
    currentStep === 2 ? '#377AFD' :
    currentStep > 2 ? '#4CA883' :
    '#DDE3EB'
  ">
    <path
      d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
  </svg>


  <li class="nav-item" [ngClass]="{
        'active': currentStep === 2,
        'text-success': currentStep > 2, 
        'bg-light-success': currentStep > 2  
    }" (click)="goToStep(2)" style="cursor: pointer;">
    @if (currentStep <= 2) { <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      d="M8.506 10.714c0-.92.755-1.666 1.686-1.666c.932 0 1.687.746 1.687 1.666s-.755 1.667-1.687 1.667a1.677
      1.677 0 0 1-1.686-1.667" />
      <path [style.fill]="currentStep === 2 ? '#007bff' : '#4A6D97'" fill-rule="evenodd"
        d="M2 10.714c0-2.693 0-4.04.847-4.877S5.057 5 7.783 5h4.82c2.725 0 4.088 0 4.935.837s.847 2.184.847 4.877c0 2.694 0 4.041-.847 4.878s-2.21.837-4.936.837H7.783c-2.726 0-4.09 0-4.936-.837S2 13.408 2 10.714m5.06 0c0-1.71 1.402-3.095 3.132-3.095s3.133 1.386 3.133 3.095s-1.402 3.096-3.133 3.096c-1.73 0-3.132-1.386-3.132-3.096M4.168 12.62a.72.72 0 0 0 .723.715c.4 0 .723-.32.723-.715V8.81a.72.72 0 0 0-.723-.714a.72.72 0 0 0-.723.715zm11.326.715c-.4 0-.723-.32-.723-.715V8.81c0-.394.323-.714.723-.714s.722.32.722.715v3.81a.72.72 0 0 1-.722.714"
        clip-rule="evenodd" />
      <path [style.fill]="currentStep === 2 ? '#007bff' : '#4A6D97'"
        d="M4.065 16.225q.02.225.048.434c.117.857.366 1.579.946 2.152q.124.123.257.226c.566.514 1.266.742 2.09.851c.836.111 1.898.111 3.216.111h4.925c1.318 0 2.38 0 3.217-.111c.867-.115 1.598-.362 2.178-.935s.83-1.295.946-2.152c.112-.826.112-1.876.112-3.178v-.105c0-1.302 0-2.352-.112-3.178c-.117-.857-.366-1.579-.946-2.152a3 3 0 0 0-.257-.226c-.566-.514-1.266-.742-2.09-.851a9 9 0 0 0-.41-.045c.2.834.2 1.984.2 3.648c0 2.694 0 4.04-.847 4.878c-.846.836-2.21.836-4.936.836H7.783c-1.702 0-2.872 0-3.718-.203"
        opacity=".5" />
      </svg>
      }
      @if (currentStep > 2) {
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
        [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
        <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
        <path
          d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
      </svg>
      }
      <span class="nav-link">Salary Ranges</span>
  </li>

  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" [style.fill]="
    currentStep === 2 ? '#DDE3EB' :
    currentStep === 3 ? '#377AFD' :
    currentStep > 3 ? '#4CA883' :
    '#DDE3EB'
  ">
    <path
      d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
  </svg>


  <li class="nav-item" [ngClass]="{
        'active': currentStep === 3,
        'text-success': currentStep > 3, 
        'bg-light-success': currentStep > 3  
    }" (click)="goToStep(3)" style="cursor: pointer;">
    @if (currentStep <= 3) { <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path [style.fill]="currentStep === 3 ? '#007bff' : '#4A6D97'"
        d="M14 4h-4C6.229 4 4.343 4 3.172 5.172S2 8.229 2 12s0 5.657 1.172 6.828S6.229 20 10 20h4c3.771 0 5.657 0 6.828-1.172S22 15.771 22 12s0-5.657-1.172-6.828S17.771 4 14 4"
        opacity=".5" />
      <path [style.fill]="currentStep === 3 ? '#007bff' : '#4A6D97'"
        d="M13.25 9a.75.75 0 0 1 .75-.75h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75m1 3a.75.75 0 0 1 .75-.75h4a.75.75 0 0 1 0 1.5h-4a.75.75 0 0 1-.75-.75m1 3a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75M9 11a2 2 0 1 0 0-4a2 2 0 0 0 0 4m0 6c4 0 4-.895 4-2s-1.79-2-4-2s-4 .895-4 2s0 2 4 2" />
      </svg>
      }
      @if (currentStep > 3) {
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
        [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
        <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
        <path
          d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
      </svg>
      }
      <span class="nav-link">Direct Manager</span>
  </li>

  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" [style.fill]="
    currentStep === 3 ? '#DDE3EB' :
    currentStep === 4 ? '#377AFD' :
    currentStep > 4 ? '#4CA883' :
    '#DDE3EB'
  ">
    <path
      d="M15.835 11.63L9.205 5.2C8.79 4.799 8 5.042 8 5.57v12.86c0 .528.79.771 1.205.37l6.63-6.43a.5.5 0 0 0 0-.74" />
  </svg>

  <li class="nav-item" [ngClass]="{
        'active': currentStep === 4,
        'text-success': currentStep > 4, 
        'bg-light-success': currentStep > 4  
    }" (click)="goToStep(4)" style="cursor: pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
      <path [style.fill]="currentStep === 4 ? '#007bff' : '#4A6D97'"
        d="M21 15.998v-6c0-2.828 0-4.242-.879-5.121C19.353 4.109 18.175 4.012 16 4H8c-2.175.012-3.353.109-4.121.877C3 5.756 3 7.17 3 9.998v6c0 2.829 0 4.243.879 5.122c.878.878 2.293.878 5.121.878h6c2.828 0 4.243 0 5.121-.878c.879-.88.879-2.293.879-5.122"
        opacity=".5" />
      <path [style.fill]="currentStep === 4 ? '#007bff' : '#4A6D97'"
        d="M8 3.5A1.5 1.5 0 0 1 9.5 2h5A1.5 1.5 0 0 1 16 3.5v1A1.5 1.5 0 0 1 14.5 6h-5A1.5 1.5 0 0 1 8 4.5z" />
      <path [style.fill]="currentStep === 4 ? '#007bff' : '#4A6D97'" fill-rule="evenodd"
        d="M6.25 10.5A.75.75 0 0 1 7 9.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75M6.25 14a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75m-3.5 3.5a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5H7a.75.75 0 0 1-.75-.75m3.5 0a.75.75 0 0 1 .75-.75H17a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75"
        clip-rule="evenodd" />
    </svg>
    @if (currentStep > 4) {
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
      [style.fill]="currentStep > 1 ? 'currentColor' : 'black'">
      <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10" opacity=".5" />
      <path
        d="M16.03 8.97a.75.75 0 0 1 0 1.06l-5 5a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 1 1 1.06-1.06l1.47 1.47l2.235-2.235L14.97 8.97a.75.75 0 0 1 1.06 0" />
    </svg>
    }
    <span class="nav-link">Job Details</span>
  </li>
</ul>


<!-- step 1 -->
@if (currentStep === 1) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Main Information</h2>
    <form [formGroup]="jobStep1" class="w-lg-50 d-flex flex-column gap-2">
      @if (loadData) {
      <app-skelaton-loading [rows]="4" [hasLabel]="true" [labelHeight]="20" [valueHeight]="40">
      </app-skelaton-loading>
      }@else {
      <div class="input">
        <label for="jobCode">Job Title Code (Optional)</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="text" id="jobCode" formControlName="code" class="form-control custom-date-input"
            placeholder="0050" />
        </div>
        @if (jobStep1.get('code')?.touched && jobStep1.get('code')?.errors?.['maxlength']) {
        <p class="error-msg">
          Job Title Code max lengh 26.
        </p>
        }
      </div>
      <div class="input">
        <label for="jobTitle">Job Title <span>*</span></label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <input type="text" id="jobTitle" formControlName="jobName" class="form-control custom-date-input"
            placeholder="Enter Job Title" />
        </div>
        @if (jobStep1.get('jobName')?.touched && jobStep1.get('jobName')?.errors?.['required']) {
        <p class="error-msg">
          Job Title is required.
        </p>
        }
        @if (jobStep1.get('jobName')?.touched && jobStep1.get('jobName')?.errors?.['maxlength']) {
        <p class="error-msg">
          Job Title max lengh 80.
        </p>
        }
      </div>
      <div class="input">
        <label for="level">Management Level <span>*</span></label>
        <div class="d-flex align-items-center gap-4">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <select name="level" formControlName="managementLevel" id="level" class="form-select"
              (change)="onLevelChange()">
              <option value="" disabled hidden>Select Level</option>
              <option value="1">Company</option>
              <option value="2">Branch</option>
              <option value="3">Department</option>
              <option value="4">Section</option>
              <option value="5">None</option>
            </select>
          </div>
          @if (jobStep1.get('managementLevel')?.touched && jobStep1.get('managementLevel')?.errors?.['required']) {
          <p class="error-msg">
            Management Level is required.
          </p>
          }
        </div>
      </div>
      @if (showJobLevel) {
      <div class="input">
        <label for="jobLevel">Job Level <span>*</span></label>
        <div class="d-flex align-items-center gap-4">
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <select name="jobLevel" formControlName="jobLevel" id="jobLevel" class="form-select">
              <option value="" disabled hidden>Select Level</option>
              <option value="0">Not Selected</option>
              <option value="1">Intern</option>
              <option value="2">Junior</option>
              <option value="3">Mid Level</option>
              <option value="4">Senior</option>
              <option value="5">Team Leader</option>
              <option value="6">Expert</option>
              <option value="7">Consultant</option>
            </select>
          </div>
        </div>
        @if (jobStep1.get('jobLevel')?.touched && jobStep1.get('jobLevel')?.errors?.['required']) {
        <p class="error-msg">
          Job Level is required.
        </p>
        }
      </div>
      }
      }


      <div class="d-flex justify-content-between gap-3">
        @if (loadData) {
        <app-skelaton-loading style="margin-top: 1rem;" [rows]="1" [hasLabel]="true" [labelHeight]="20"
          [valueHeight]="40" class="w-100"></app-skelaton-loading>
        <app-skelaton-loading style="margin-top: 1rem;" [rows]="1" [hasLabel]="true" [labelHeight]="20"
          [valueHeight]="40" class="w-100"></app-skelaton-loading>
        } @else {
        <div class="input w-100" [ngClass]="{'opacity-50': !isDepartmentSelected}">
          <label for="depart">Assign Department</label>
          @if (departmentsLoading && isDepartmentSelected) {
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <div class="form-select placeholder-glow">
              <span class="placeholder col-12"></span>
            </div>
          </div>
          } @else {
          <div class="d-flex align-items-center gap-4">
            <div class="form-outline w-100 position-relative custom-date-wrapper">
              <select #select name="depart" formControlName="department" id="depart" class="form-select"
                (change)="onDepartmentChange(+select.value)">
                <option value="" selected disabled hidden>Select Department</option>
                @if (departments.length === 0) {
                <option value="" selected disabled>
                  No active departments to select
                </option>
                }

                @for (department of departments; track department) {
                <option [value]="department.id">{{ department.name }}</option>
                }
              </select>

            </div>
          </div>
          }
          @if (jobStep1.get('department')?.touched && jobStep1.get('department')?.errors?.['required']) {
          <p class="error-msg">Department is required.</p>
          }

        </div>

        <div class="input w-100" [ngClass]="{'opacity-50': !isSectionSelected}">
          <label for="section">Assign Section</label>
          @if (sectionsLoading && isSectionSelected) {
          <div class="form-outline w-100 position-relative custom-date-wrapper">
            <div class="form-select placeholder-glow">
              <span class="placeholder col-12"></span>
            </div>
          </div>
          } @else {
          <div class="d-flex align-items-center gap-4">
            <div class="form-outline w-100 position-relative custom-date-wrapper">
              <select name="section" formControlName="section" id="section" class="form-select">
                <option value="" selected disabled hidden>Select Section</option>
                @if (sections.length === 0) {
                <option value="" selected disabled>
                  No active sections to select
                </option>
                }
                @for (section of sections; track section) {
                <option [value]="section.id">{{section.name}}</option>
                }
              </select>
            </div>
          </div>
          }
          @if (
          jobStep1.get('section')?.touched &&
          jobStep1.get('section')?.errors?.['required'] &&
          !jobStep1.get('department')?.value
          ) {
          <p class="error-msg">
            Department is required first.
          </p>
          }

          @if (
          jobStep1.get('section')?.touched &&
          jobStep1.get('section')?.errors?.['required'] &&
          jobStep1.get('department')?.value
          ) {
          <p class="error-msg">
            Section is required.
          </p>
          }
        </div>
        }
      </div>

      @if (errMsg) {
      <div class="alert alert-danger mb-0 mt-3" role="alert">
        {{errMsg}}
      </div>
      }
    </form>
    <!-- next button -->
    <div class="btn-fixed">
      <button class="btn btn-lg btn-primary" [disabled]="!jobStep1.valid" (click)="nextGetJobs()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M4 12h16m0 0l-6-6m6 6l-6 6" />
        </svg>
        <span>Next (1/4)</span>
      </button>
    </div>
  </div>
</div>
}




<!-- step 2 -->
@if (currentStep === 2) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Salary Ranges</h2>
    <p>
      If you don’t restrict a salary range in an employment type, recruiters and personnel users will be able to add
      an
      employee with a salary outside of this range. They’ll be warned if they do so
    </p>
    <form [formGroup]="jobStep2">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th class="w-15">Employment Type</th>
              <th class="w-10">Restrict</th>
              <th class="w-25">Salary Minimum</th>
              <th class="w-25">Salary Maximum</th>
              <th class="w-10">Currency</th>
              <th class="w-15">Actions</th>
            </tr>
          </thead>
          <tbody [formGroup]="jobStep2">
            <!-- Full-time -->
            <tr>
              <td>Full-time</td>
              <td>
                <input formControlName="fullTime_restrict" class="form-check-input m-0" type="checkbox" id="restrict">
              </td>
              <td>
                <input type="text" formControlName="fullTime_minimum" class="form-control table-input"
                  placeholder="Per Month">
                @if (jobStep2.get('fullTime_minimum')?.touched &&
                jobStep2.get('fullTime_minimum')?.errors?.['required']) {
                <p class="error-msg">
                  Minimum salary is required.
                </p>
                }
                @if (jobStep2.get('fullTime_minimum')?.touched && jobStep2.get('fullTime_minimum')?.errors?.['pattern'])
                {
                <p class="error-msg">
                  Salary must be numeric.
                </p>
                }
              </td>
              <td>
                <input type="text" formControlName="fullTime_maximum" class="form-control table-input"
                  placeholder="Per Month">
                @if (jobStep2.get('fullTime_maximum')?.touched &&
                jobStep2.get('fullTime_maximum')?.errors?.['required']) {
                <p class="error-msg">
                  Maximun salary is required.
                </p>
                }
                @if (jobStep2.get('fullTime_maximum')?.touched && jobStep2.get('fullTime_maximum')?.errors?.['pattern'])
                {
                <p class="error-msg">
                  Salary must be numeric.
                </p>
                }
                @if (jobStep2.errors?.['fullTime'] && (jobStep2.get('fullTime_maximum')?.touched ||
                jobStep2.get('fullTime_minimum')?.touched)) {
                <p class="error-msg text-wrap">
                  Maximum salary must be more than or equal to minimum.
                </p>
                }
              </td>
              <td>
                <select formControlName="fullTime_currency" class="form-control table-input" style="appearance: auto;">
                  <option value="EGP">E£ EGP</option>
                  <option value="USD">$ USD</option>
                  <option value="EUR">€ EUR</option>
                </select>
              </td>
              <td>
                <div class="d-flex align-items-center justify-content-start w-100 gap-3">
                  <a type="button" class="d-flex align-items-center gap-1"
                    [ngClass]="jobStep2.get('fullTime_status')?.value ?  'remove-btn' : 'view-btn' "
                    (click)="toggleStatus('fullTime_status')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
                    </svg>
                    <span>{{ jobStep2.get('fullTime_status')?.value ? 'Deactivate' : 'Activate' }}</span>
                  </a>
                </div>
              </td>
            </tr>
            <!-- Part-time -->
            <tr>
              <td>Part-time</td>
              <td>
                <input formControlName="partTime_restrict" class="form-check-input m-0" type="checkbox" id="restrict">
              </td>
              <td>
                <input type="text" formControlName="partTime_minimum" class="form-control table-input"
                  placeholder="Per Month">
                @if (jobStep2.get('partTime_minimum')?.touched &&
                jobStep2.get('partTime_minimum')?.errors?.['required']) {
                <p class="error-msg">
                  Minimum salary is required.
                </p>
                }
                @if (jobStep2.get('partTime_minimum')?.touched && jobStep2.get('partTime_minimum')?.errors?.['pattern'])
                {
                <p class="error-msg">
                  Salary must be numeric.
                </p>
                }
              </td>
              <td>
                <input type="text" formControlName="partTime_maximum" class="form-control table-input"
                  placeholder="Per Month">
                @if (jobStep2.get('partTime_maximum')?.touched &&
                jobStep2.get('partTime_maximum')?.errors?.['required']) {
                <p class="error-msg">
                  Maximun salary is required.
                </p>
                }
                @if (jobStep2.get('partTime_maximum')?.touched && jobStep2.get('partTime_maximum')?.errors?.['pattern'])
                {
                <p class="error-msg">
                  Salary must be numeric
                </p>
                }
                @if (jobStep2.errors?.['partTime'] && (jobStep2.get('partTime_maximum')?.touched ||
                jobStep2.get('partTime_minimum')?.touched)) {
                <p class="error-msg text-wrap">
                  Maximum salary must be more than or equal to minimum.
                </p>
                }
              </td>
              <td>
                <select formControlName="partTime_currency" class="form-control table-input" style="appearance: auto;">
                  <option value="EGP">E£ EGP</option>
                  <option value="USD">$ USD</option>
                  <option value="EUR">€ EUR</option>
                </select>
              </td>
              <td>
                <div class="d-flex align-items-center justify-content-start w-100 gap-3">
                  <a type="button" class="d-flex align-items-center gap-1"
                    [ngClass]="jobStep2.get('partTime_status')?.value ? 'remove-btn' : 'view-btn'"
                    (click)="toggleStatus('partTime_status')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
                    </svg>
                    <span>{{ jobStep2.get('partTime_status')?.value ? 'Deactivate' : 'Activate'
                      }}</span>
                  </a>
                </div>
              </td>
            </tr>
            <!-- Per Hour -->
            <tr>
              <td>Per Hour</td>
              <td>
                <input formControlName="hourly_restrict" class="form-check-input m-0" type="checkbox" id="restrict">
              </td>
              <td>
                <input type="text" formControlName="hourly_minimum" class="form-control table-input"
                  placeholder="Per Hour">
                @if (jobStep2.get('hourly_minimum')?.touched && jobStep2.get('hourly_minimum')?.errors?.['required']) {
                <p class="error-msg">
                  Minimum salary is required.
                </p>
                }
                @if (jobStep2.get('hourly_minimum')?.touched && jobStep2.get('hourly_minimum')?.errors?.['pattern']) {
                <p class="error-msg">
                  Salary must be numeric
                </p>
                }
              </td>
              <td>
                <input type="text" formControlName="hourly_maximum" class="form-control table-input"
                  placeholder="Per Hour">
                @if (jobStep2.get('hourly_maximum')?.touched && jobStep2.get('hourly_maximum')?.errors?.['required']) {
                <p class="error-msg">
                  Maximun salary is required.
                </p>
                }
                @if (jobStep2.get('hourly_maximum')?.touched && jobStep2.get('hourly_maximum')?.errors?.['pattern']) {
                <p class="error-msg">
                  Salary must be numeric
                </p>
                }
                @if (jobStep2.errors?.['hourly'] && (jobStep2.get('hourly_maximum')?.touched ||
                jobStep2.get('hourly_minimum')?.touched)) {
                <p class="error-msg text-wrap">
                  Maximum salary must be more than or equal to minimum.
                </p>
                }
              </td>
              <td>
                <select formControlName="hourly_currency" class="form-control table-input" style="appearance: auto;">
                  <option value="EGP">E£ EGP</option>
                  <option value="USD">$ USD</option>
                  <option value="EUR">€ EUR</option>
                </select>
              </td>
              <td>
                <div class="d-flex align-items-center justify-content-start w-100 gap-3">
                  <a type="button" class="d-flex align-items-center gap-1"
                    [ngClass]="jobStep2.get('hourly_status')?.value ? 'remove-btn' : 'view-btn'"
                    (click)="toggleStatus('hourly_status')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                        d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
                    </svg>
                    <span>{{ jobStep2.get('hourly_status')?.value ? 'Deactivate' : 'Activate'
                      }}</span>
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      @if (errMsg) {
      <div class="alert alert-danger mb-0 mt-3" role="alert">
        <!-- {{errMsg}} -->
        {{'please fill empty fields or deactivate it'}}
      </div>
      }
    </form>
    <!-- prev and confirm buttons -->
    <div class="btn-fixed d-flex align-items-stretch gap-2">
      <button class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
        (click)="goPrev()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M20 12H4m0 0l6-6m-6 6l6 6" />
        </svg>
      </button>
      <button class="btn btn-lg btn-primary" [disabled]="!jobStep1.valid || !jobStep2.valid" (click)="goNext()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M4 12h16m0 0l-6-6m6 6l-6 6" />
        </svg>
        <span>Next (2/4)</span>
      </button>
    </div>
  </div>
</div>
}




<!-- step 3 -->
@if (currentStep === 3) {
<div class="content-hug">
  <div class="d-flex flex-column gap-4">
    @if (currentManager) {
    <div class="content-box d-flex flex-column gap-3 w-100">
      <h2>Direct Manager</h2>

      <div class="info">
        <h6>Job Title ID</h6>
        <span>{{ currentManager?.id?.toString().padStart(4, '0') }}</span>
      </div>

      @if (currentManager?.code) {
      <div class="info">
        <h6>Job Title Code</h6>
        <span>{{ currentManager?.code }}</span>
      </div>
      }

      <div class="info">
        <h6>Job Title</h6>
        <span>{{ currentManager?.name }}</span>
      </div>

      <!-- <div>
        <button class="btn btn-lg w-auto"
          [ngClass]="removedManagerId !== null || managerRemoved || newManagerSelected ? 'btn-danger' : 'btn-outline-danger'"
          [disabled]="!selectedManagerExists()" (click)="removeCurrentManager()">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round"
                d="M20.5 6h-17m15.333 2.5l-.46 6.9c-.177 2.654-.265 3.981-1.13 4.79s-2.196.81-4.856.81h-.774c-2.66 0-3.991 0-4.856-.81c-.865-.809-.954-2.136-1.13-4.79l-.46-6.9M9.5 11l.5 5m4.5-5l-.5 5" />
              <path
                d="M6.5 6h.11a2 2 0 0 0 1.83-1.32l.034-.103l.097-.291c.083-.249.125-.373.18-.479a1.5 1.5 0 0 1 1.094-.788C9.962 3 10.093 3 10.355 3h3.29c.262 0 .393 0 .51.019a1.5 1.5 0 0 1 1.094.788c.055.106.097.23.18.479l.097.291A2 2 0 0 0 17.5 6" />
            </g>
          </svg>

          @if (removedManagerId !== null || managerRemoved || newManagerSelected) {
          <span>Manager removed</span>
          } @else if (selectedManagerExists()) {
          <span>Remove as Manager</span>
          }
        </button>

      </div> -->
    </div>
    }

    <div class="content-box d-flex flex-column gap-3">
      <h2>Assign a Job Title as Direct Manager</h2>
      <div data-mdb-input-init class="form-outline w-25">
        <input type="text" class="form-control" [value]="searchTerm" (input)="onSearchChange($event)"
          placeholder="Search for a Job Title" />
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <g fill="none" stroke-width="1.5">
            <circle cx="11.5" cy="11.5" r="9.5" />
            <path stroke-linecap="round" d="M18.5 18.5L22 22" />
          </g>
        </svg>
      </div>
      @if (selectJobError) {
      <p class="error-msg">
        Please select a Job Title before continuing.
      </p>
      }
      <!-- start table -->
      <div>
        <app-table [data]="filteredJobTitles" [isLoading]="loadJobs" [columnsCount]="2" [totalItems]="ManageTotalItems"
          [headerTemplate]="jobsTableHeader" [rowTemplate]="jobsTableRow" [emptyTemplate]="jobsTableEmptyRow"
          [itemsPerPage]="manageItemsPerPage" [currentPage]="ManageCurrentPage" (pageChange)="onPageChange($event)"
          (itemsPerPageChange)="onItemsPerPageChange($event)">
        </app-table>

        <ng-template #jobsTableHeader>
          <th (click)="sortBy()" style="cursor: pointer;">
            <div class="d-flex align-items-center justify-content-between">
              <span>Job Title</span>
              @if (sortDirection === 'desc') {
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <g fill="none" stroke="#DDE3EB" stroke-linecap="round" stroke-width="1.5">
                  <path d="M4 8h9m-7 5h7m-5 5h5" />
                  <path stroke-linejoin="round" d="M17 20V4l3 4" />
                </g>
              </svg>
              }
              @if (sortDirection === 'asc') {
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="#DDE3EB" fill-rule="evenodd"
                  d="M17 3.25a.75.75 0 0 1 .75.75v13.75l1.65-2.2a.75.75 0 1 1 1.2.9l-3 4a.75.75 0 0 1-1.35-.45V4a.75.75 0 0 1 .75-.75M7.25 6A.75.75 0 0 1 8 5.25h5a.75.75 0 0 1 0 1.5H8A.75.75 0 0 1 7.25 6m-2 5a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75m-2 5a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5H4a.75.75 0 0 1-.75-.75"
                  clip-rule="evenodd" />
              </svg>
              }
            </div>
          </th>
          <th class="w-15">Action</th>
        </ng-template>
        <ng-template #jobsTableRow let-job let-i="index">
          <td>
            <span class="d-block text-gray-sm">{{ job.id.toString().padStart(4, '0') }}</span>
            <span class="d-block text-truncate" style="max-width: 300px;">
              {{ job.name }}
            </span>
          </td>
          <td>
            <div class="d-flex align-items-center justify-content-start w-100 gap-3">
              @if (numericJobId !== null && job.id !== numericJobId) {
              <a type="button" class="d-flex align-items-center gap-1"
                [ngClass]="job.assigned ? 'success-btn' : 'view-btn'" (click)="toggleAssignStatus(job)">
                @if (!job.assigned) {
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                  <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"
                    d="M12 2v4M8.5 3.706A9.003 9.003 0 0 0 12 21a9 9 0 0 0 3.5-17.294" />
                </svg>
                }
                @if (job.assigned) {
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                  <path fill="currentColor" fill-rule="evenodd"
                    d="M16.03 10.03a.75.75 0 1 0-1.06-1.06l-4.47 4.47l-1.47-1.47a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0z" />
                  <path fill="currentColor" fill-rule="evenodd"
                    d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                    clip-rule="evenodd" />
                </svg>
                }
                <span>{{ job.assigned ? 'Selected' : 'Assigned' }}</span>
              </a>
              }
            </div>
          </td>
        </ng-template>
        <ng-template #jobsTableEmptyRow>
          <tr>
            <td colspan="2" class="no-data py-4">
              @if (searchTerm.trim()) {
              No Job Titles match your search.
              } @else {
              No Job Titles Can Manage this job.
              }
            </td>
          </tr>
        </ng-template>
      </div>
      <!-- prev and confirm buttons -->
      <div class="btn-fixed d-flex align-items-stretch gap-2">
        <button class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
          (click)="goPrev()">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M20 12H4m0 0l6-6m-6 6l6 6" />
          </svg>
        </button>
        <button class="btn btn-lg btn-primary" (click)="goNext()" [disabled]="!hasAssignedManager()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M4 12h16m0 0l-6-6m6 6l-6 6" />
          </svg>
          <span>Next (3/4)</span>
        </button>
      </div>
    </div>
  </div>
</div>
}



<!-- step 4 -->
@if (currentStep === 4) {
<div class="content-hug">
  <div class="content-box d-flex flex-column gap-3">
    <h2>Job Details</h2>
    <form [formGroup]="jobStep4" class="w-lg-50 d-flex flex-column gap-2">
      <div class="input">
        <label for="jobDesc">Job Description</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <textarea type="text" formControlName="jobDescription" id="jobDesc" class="form-control"
            placeholder="Enter the Job Description"></textarea>
        </div>
        @if (jobStep4.get('jobDescription')?.touched && jobStep4.get('jobDescription')?.errors?.['required']) {
        <p class="error-msg">
          Job Description is required.
        </p>
        }
        @if (jobStep4.get('jobDescription')?.touched && jobStep4.get('jobDescription')?.errors?.['minlength']) {
        <p class="error-msg">
          Job Description must be at least 10 characters long.
        </p>
        }
      </div>
      <div class="input">
        <label for="jobReq">Job Requirements</label>
        <div class="input-box">
          @for (requirement of requirements; track requirement; let i = $index) {
          <div class="record d-flex align-items-center">
            <button class="btn" (click)="deleteRequirement(i)">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
                <path fill="#377AFD" d="M15 12.75a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5z" />
                <path fill="#377AFD" fill-rule="evenodd"
                  d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                  clip-rule="evenodd" />
              </svg>
            </button>
            <div>{{ requirement }}</div>
          </div>
          }
          @if (showInput) {
          <div class="position-relative mt-2">
            <input type="text" class="form-control w-100 mb-3" placeholder="Write Requirement"
              [(ngModel)]="newRequirement" [ngModelOptions]="{standalone: true}" (keydown.enter)="confirmRequirement()"
              (blur)="onInputBlur()" #requirementInput autofocus>
          </div>
          }
          @if (inputTouched && requirements.length === 0) {
          <p class="error-msg">
            At least one requirement is required.
          </p>
          }
          <button class="btn add-btn" type="button" (click)="showInputField()">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25z" />
              <path fill="currentColor" fill-rule="evenodd"
                d="M12 1.25C6.063 1.25 1.25 6.063 1.25 12S6.063 22.75 12 22.75S22.75 17.937 22.75 12S17.937 1.25 12 1.25M2.75 12a9.25 9.25 0 1 1 18.5 0a9.25 9.25 0 0 1-18.5 0"
                clip-rule="evenodd" />
            </svg>
            <span>Add Requirement</span>
          </button>
        </div>
      </div>
      <div class="input">
        <label for="jobDesc">Job Analysis</label>
        <div class="form-outline w-100 position-relative custom-date-wrapper">
          <textarea type="text" formControlName="jobAnalysis" id="jobDesc" class="form-control"
            placeholder="Enter the Job Analysis"></textarea>
        </div>
        @if (jobStep4.get('jobAnalysis')?.touched && jobStep4.get('jobAnalysis')?.errors?.['required']) {
        <p class="error-msg">
          Job Analysis is required.
        </p>
        }
        @if (jobStep4.get('jobAnalysis')?.touched && jobStep4.get('jobAnalysis')?.errors?.['minlength']) {
        <p class="error-msg">
          Job Analysis must be at least 10 characters long.
        </p>
        }
      </div>
    </form>
    <!-- prev and confirm buttons -->
    <div class="btn-fixed d-flex align-items-stretch gap-2">
      <button class="btn btn-outline-success bg-white d-flex justify-content-center align-items-center"
        (click)="goPrev()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M20 12H4m0 0l6-6m-6 6l6 6" />
        </svg>
      </button>
      @if (jobTitleSub?.update){
      <button class="btn btn-lg btn-success" (click)="updateJobTitle()"
        [disabled]="!jobStep4.valid || requirements.length === 0|| !jobStep1.valid || !jobStep2.valid || !hasChanges || isLoading || !hasAssignedManager()">
        @if (isLoading) {
        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
        }
        @if (!isLoading) {
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24">
          <g fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
          </g>
        </svg>
        }
        <span>Save Changes</span>
      </button>
      }

    </div>
  </div>
</div>
}



<!-- Discard popup  -->
<app-popup [title]="'Discard Changes'"
  [paragraph1]="'Are you sure you want to discard all changes done to the Job Title “Chief Operating Officer (COO)”?'"
  [paragraph2]="'This action cannot be undone!'" [isOpen]="isModalOpen" (close)="closeModal()">
  <button modal-btn-left class="btn btn-lg btn-dark w-100" (click)="confirmAction()">
    Discard Changes
  </button>
  <button modal-btn-right class="btn btn-lg btn-outline-dark border-0 w-100" (click)="closeModal()">
    Keep Editing
  </button>
</app-popup>