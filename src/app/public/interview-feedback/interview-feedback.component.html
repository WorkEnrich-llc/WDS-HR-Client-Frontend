<div class="interview-action-container">
    <!-- Error Banner - If API Error -->
    @if (errorMessage && !isSubmitted) {
    <div class="error-banner" role="alert">
        <svg class="error-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
        </svg>
        <span>{{ errorMessage }}</span>
    </div>
    }

    <!-- Form State - Before Submission -->
    @if (!isSubmitted) {
    <div class="content-wrapper" role="main">
        <div class="card-container">
            <!-- Feedback SVG Illustration -->
            <div class="illustration-wrapper">
                <svg class="illustration" viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"
                    role="img" aria-label="Interview feedback">
                    <!-- Primary Circle Background -->
                    <circle cx="200" cy="150" r="100" fill="#EFF6FF" opacity="0.5" />
                    <circle cx="200" cy="150" r="80" fill="#3B82F6" />

                    <!-- Feedback/Review Icon -->
                    <rect x="170" y="110" width="60" height="50" rx="4" fill="white" opacity="0.9" />
                    <line x1="180" y1="125" x2="220" y2="125" stroke="#3B82F6" stroke-width="2.5"
                        stroke-linecap="round" />
                    <line x1="180" y1="135" x2="210" y2="135" stroke="#3B82F6" stroke-width="2.5"
                        stroke-linecap="round" />
                    <line x1="180" y1="145" x2="200" y2="145" stroke="#3B82F6" stroke-width="2.5"
                        stroke-linecap="round" />

                    <!-- Star Rating Icon -->
                    <circle cx="160" cy="180" r="15" fill="#FCD34D" />
                    <path
                        d="M 160 175 L 162 181 L 168 181 L 163 185 L 165 191 L 160 187 L 155 191 L 157 185 L 152 181 L 158 181 Z"
                        fill="white" />

                    <!-- Chat/Message Bubbles -->
                    <circle cx="250" cy="175" r="12" fill="#60A5FA" opacity="0.8" />
                    <circle cx="260" cy="165" r="8" fill="#93C5FD" opacity="0.7" />

                    <!-- Decorative elements -->
                    <circle cx="120" cy="80" r="8" fill="#3B82F6" opacity="0.4" />
                    <circle cx="280" cy="100" r="12" fill="#3B82F6" opacity="0.3" />
                    <circle cx="100" cy="200" r="10" fill="#3B82F6" opacity="0.4" />
                    <circle cx="290" cy="220" r="8" fill="#3B82F6" opacity="0.3" />
                </svg>
            </div>

            <!-- Title and Description -->
            <div class="text-content">
                <h1 class="main-title">Share Your Feedback</h1>
                <p class="description">
                    Hello <strong>{{ applicantName }}</strong>, thank you for participating in the interview!
                </p>
                <p class="description-secondary">
                    We value your feedback and would appreciate if you could share your experience. Your input helps us
                    improve our interview process.
                </p>
            </div>

            <!-- Feedback Form -->
            <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()" class="feedback-form">
                <!-- Interview Attendance Toggle -->
                <div class="form-group interview-toggle-group">
                    <label class="form-label">
                        Did you attend the interview? <span class="required">*</span>
                    </label>
                    <div class="toggle-container">
                        <div class="toggle-wrapper">
                            <input type="checkbox" id="interviewToggle" class="toggle-input"
                                [checked]="didAttendInterview" (change)="toggleInterviewAttendance()"
                                aria-label="Did you attend the interview">
                            <label for="interviewToggle" class="toggle-label">
                                <span class="toggle-switch"></span>
                                <span class="toggle-text">{{ didAttendInterview ? 'Yes, I attended' : 'No, I missed it'
                                    }}</span>
                            </label>
                        </div>
                        @if (!didAttendInterview) {
                        <div class="missed-interview-notice">
                            <svg class="notice-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M12 6v6l4 2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span>We've noted that you missed the interview.</span>
                        </div>
                        }
                    </div>
                </div>

                <!-- Rating Field -->
                <div class="form-group" [class.disabled-group]="!didAttendInterview">
                    <label for="rating" class="form-label" [class.disabled-label]="!didAttendInterview">
                        Overall Rating <span class="required">*</span>
                    </label>
                    <div class="rating-container" [class.disabled-rating]="!didAttendInterview">
                        <!-- Star Rating Visual -->
                        <div class="star-rating" role="radiogroup" aria-label="Rating" (mouseleave)="onStarLeave()">
                            @for (star of getStars(); track star) {
                            <button type="button" class="star-btn" (click)="setRating(star, $event)"
                                (mouseenter)="onStarHover(star, $event)" (mousemove)="onStarHover(star, $event)"
                                [disabled]="!didAttendInterview" [class.filled]="getStarState(star) === 'filled'"
                                [class.half]="getStarState(star) === 'half'"
                                [class.hover]="getStarState(star) === 'hover'"
                                [class.half-hover]="getStarState(star) === 'half-hover'"
                                [attr.aria-label]="'Rate ' + star + ' out of 10'">
                                <svg class="star-icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg>
                            </button>
                            }
                        </div>
                        <!-- Hidden input for form control -->
                        <input type="hidden" formControlName="rating" />
                    </div>

                    @if (rating?.invalid && rating?.touched && didAttendInterview) {
                    <div class="error-message">
                        @if (rating?.errors?.['required']) {
                        <small>Rating is required</small>
                        }
                        @if (rating?.errors?.['min'] || rating?.errors?.['max']) {
                        <small>Please enter a rating between 0 and 10</small>
                        }
                    </div>
                    }
                </div>

                <!-- Comment Field -->
                <div class="form-group" [class.disabled-group]="!didAttendInterview">
                    <label for="comment" class="form-label" [class.disabled-label]="!didAttendInterview">
                        Your Feedback <span class="required">*</span>
                    </label>
                    <textarea id="comment" formControlName="comment" class="form-textarea"
                        placeholder="Please share your thoughts about the interview experience (minimum 10 characters)..."
                        rows="6" [disabled]="!didAttendInterview"
                        [class.error]="comment?.invalid && comment?.touched && didAttendInterview"
                        aria-required="true"></textarea>

                    @if (comment?.invalid && comment?.touched && didAttendInterview) {
                    <div class="error-message">
                        @if (comment?.errors?.['required']) {
                        <small>Feedback is required</small>
                        }
                        @if (comment?.errors?.['minlength']) {
                        <small>Please provide at least 10 characters
                            ({{ comment?.value?.length || 0 }}/10)</small>
                        }
                    </div>
                    }
                </div>

                <button type="submit" class="btn btn-submit" [disabled]="isSubmitting" aria-label="Send feedback">
                    @if (isSubmitting) {
                    <div class="bubble-loader">
                        <span class="bubble"></span>
                        <span class="bubble"></span>
                        <span class="bubble"></span>
                    </div>
                    <span>Sending...</span>
                    } @else {
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>Send Feedback</span>
                    }
                </button>
            </form>
        </div>
    </div>
    }

    <!-- Success State - After Submission -->
    @if (isSubmitted) {
    <div class="content-wrapper success-state" role="main">
        <div class="card-container">
            <!-- Enhanced Success SVG Illustration -->
            <div class="illustration-wrapper">
                <svg class="illustration success-illustration" viewBox="0 0 400 350" fill="none"
                    xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Feedback submitted successfully">
                    <!-- Animated Success Circle Background -->
                    <circle cx="200" cy="160" r="110" fill="#D1FAE5" opacity="0.6" />
                    <circle cx="200" cy="160" r="90" fill="#A7F3D0" opacity="0.8" />
                    <circle cx="200" cy="160" r="70" fill="#10B981" />

                    <!-- Main Checkmark Icon -->
                    <path d="M 165 160 L 188 183 L 235 136" stroke="white" stroke-width="14" stroke-linecap="round"
                        stroke-linejoin="round" fill="none" />

                    <!-- Message/Feedback Icon -->
                    <circle cx="260" cy="120" r="25" fill="#34D399" opacity="0.9" />
                    <rect x="245" y="115" width="30" height="20" rx="3" fill="white" opacity="0.9" />
                    <line x1="250" y1="120" x2="270" y2="120" stroke="#34D399" stroke-width="2"
                        stroke-linecap="round" />
                    <line x1="250" y1="125" x2="265" y2="125" stroke="#34D399" stroke-width="2"
                        stroke-linecap="round" />
                    <line x1="250" y1="130" x2="260" y2="130" stroke="#34D399" stroke-width="2"
                        stroke-linecap="round" />

                    <!-- Star Rating Icon -->
                    <circle cx="140" cy="120" r="20" fill="#FCD34D" />
                    <path
                        d="M 140 115 L 142 120 L 147 120 L 143 123 L 145 128 L 140 125 L 135 128 L 137 123 L 133 120 L 138 120 Z"
                        fill="white" />

                    <!-- Decorative Floating Elements -->
                    <circle cx="100" cy="80" r="10" fill="#10B981" opacity="0.5" />
                    <circle cx="300" cy="90" r="14" fill="#10B981" opacity="0.4" />
                    <circle cx="90" cy="220" r="12" fill="#10B981" opacity="0.5" />
                    <circle cx="310" cy="240" r="10" fill="#10B981" opacity="0.4" />

                    <!-- Celebration Stars -->
                    <path
                        d="M 120 50 L 123 58 L 131 58 L 125 63 L 128 71 L 120 66 L 112 71 L 115 63 L 109 58 L 117 58 Z"
                        fill="#10B981" opacity="0.6" />
                    <path
                        d="M 280 60 L 283 68 L 291 68 L 285 73 L 288 81 L 280 76 L 272 81 L 275 73 L 269 68 L 277 68 Z"
                        fill="#10B981" opacity="0.6" />
                    <path
                        d="M 320 250 L 323 258 L 331 258 L 325 263 L 328 271 L 320 266 L 312 271 L 315 263 L 309 258 L 317 258 Z"
                        fill="#10B981" opacity="0.6" />

                    <!-- Sparkles -->
                    <circle cx="150" cy="280" r="3" fill="#34D399" opacity="0.8" />
                    <circle cx="250" cy="280" r="3" fill="#34D399" opacity="0.8" />
                    <circle cx="180" cy="290" r="2.5" fill="#10B981" opacity="0.7" />
                    <circle cx="220" cy="290" r="2.5" fill="#10B981" opacity="0.7" />
                </svg>
            </div>

            <!-- Success Message -->
            <div class="text-content">
                <h1 class="main-title success-title">Feedback Submitted Successfully! ðŸŽ‰</h1>
                <p class="description">
                    Thank you <strong>{{ applicantName }}</strong> for taking the time to share your valuable feedback
                    with us!
                </p>
                <p class="description-secondary">
                    Your insights help us continuously improve our interview process and create a better experience for
                    future candidates.
                    We truly appreciate your thoughtful input and hope to have the opportunity to work with you in the
                    future!
                </p>
            </div>

            <!-- Success Badge -->
            <div class="success-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span>Successfully Submitted</span>
            </div>
        </div>
    </div>
    }
</div>